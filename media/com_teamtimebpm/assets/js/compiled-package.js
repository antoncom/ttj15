var draw2d={bpmn:{assetsUrl:"",SwimlanePanelInstance:null,strReplaceNamed:function(a,b){var c=a,d;for(d in b)c=c.replace("{"+d+"}",b[d]);return c},getCssImage:function(a,b){if(""==a)return"none";var c=this.assetsUrl+"js/draw2d/bpmn/resources/"+a;b||(c="url("+c+")");return c},setSwimlanePanel:function(a){draw2d.bpmn.SwimlanePanelInstance=a},getSwimlanePanel:function(){return draw2d.bpmn.SwimlanePanelInstance},getWorkflow:function(){return draw2d.bpmn.SwimlanePanelInstance.workflow},getBlocksMenu:function(){return draw2d.bpmn.SwimlanePanelInstance.blocksMenu},
initInstance:function(a){a.parentRow=null;a.parentCol=null;a.oldX=0;a.oldY=0;a.oldParentRow=null;a.oldParentCol=null;a.paramsData=null},onDragstart:function(a){a.oldX=a.getX();a.oldY=a.getY();a.oldParentRow=a.parentRow;a.oldParentCol=a.parentCol},onDragend:function(a){var b=TeamTime.jQuery,c={x:a.getX(),y:a.getY()};if(c.x==a.oldX&&c.y==a.oldY)console.log("coord not changed");else{var d=draw2d.bpmn.getSwimlanePanel();d.hideActiveCell();a.parentCol=d.getColumn(c);a.parentRow=d.getRow(c);b(a.parentCol).attr("id")!=
b(a.oldParentCol).attr("id")&&d.setColumnMinWidth(a.oldParentCol);b(a.parentRow).attr("id")!=b(a.oldParentRow).attr("id")&&d.setRowMinHeight(a.oldParentRow);d.setMinBounds(a)}},onDrag:function(a){var b={x:a.getX(),y:a.getY()};if(!(b.x==a.oldX&&b.y==a.oldY)){var c=draw2d.bpmn.getSwimlanePanel();a.parentCol=c.getColumn(b);a.parentRow=c.getRow(b);c.showActiveCell(a)}},onResize:function(a){draw2d.bpmn.getSwimlanePanel().setMinBounds(a)},getVisibility:function(a){return"none"!=a.html.style.display},setVisibility:function(a,
b){a.html.style.display=b?"":"none";if(a.getPorts)for(var c=0;c<a.getPorts().getSize();c++)for(var d=a.getPorts().get(c).getConnections(),e=0;e<d.getSize();e++)b?d.get(e).html.style.display="":d.get(e).html.style.display="none"},addConextMenu:function(a){var b=TeamTime.jQuery;b(a.html).addClass("with-context-menu");b.contextMenu({selector:".with-context-menu",ignoreRightClick:!1,build:function(a){var b=a.attr("id"),e=draw2d.bpmn.getWorkflow().getDocument().getFigure(b);return{events:{show:function(){draw2d.bpmn.getSwimlanePanel().blocksMenu.hide()}},
callback:function(a,c){e.onContextMenuCmd({id:b,figure:e,key:a,options:c})},items:e.getContextMenuItems()}}})},addConnectionConextMenu:function(a){var b=TeamTime.jQuery;b(a.html).addClass("with-context-menu-connection");b.contextMenu({selector:".with-context-menu-connection",ignoreRightClick:!1,build:function(a){var b=a.attr("id"),e=draw2d.bpmn.getWorkflow().getDocument().getLine(b);return{events:{show:function(){draw2d.bpmn.getSwimlanePanel().blocksMenu.hide()}},callback:function(a,c){e.onContextMenuCmd({id:b,
figure:e,key:a,options:c})},items:e.getContextMenuItems()}}})},addWorkflowConextMenu:function(a){var b=TeamTime.jQuery,c=draw2d.bpmn.getSwimlanePanel();b(a.html).addClass("with-context-menu-workflow").click(function(a){b(a.target).hasClass("with-context-menu-workflow")&&c.blocksMenu.hide()});b.contextMenu({selector:".with-context-menu-workflow",ignoreRightClick:!1,events:{show:function(a,b,f){c.blocksMenu.show(null,{x:b,y:f});return!1}},callback:function(){},items:{"default":{name:"default"}}})},
selectText:function(a){var b=a.getContentElement();b&&(a=document.createRange(),a.selectNodeContents(b[0]),b=window.getSelection(),b.removeAllRanges(),b.addRange(a))}}},jg_ok,jg_ie,jg_fast,jg_dom,jg_moz;
function _chkDHTM(a,b,c){jg_ie=(b=a.document.body||null)&&"undefined"!=typeof b.insertAdjacentHTML&&a.document.createElement;jg_dom=b&&!jg_ie&&"undefined"!=typeof b.appendChild&&"undefined"!=typeof a.document.createRange&&"undefined"!=typeof(c=a.document.createRange()).setStartBefore&&"undefined"!=typeof c.createContextualFragment;jg_fast=jg_ie&&a.document.all&&!a.opera;jg_moz=jg_dom&&"undefined"!=typeof b.style.MozOpacity;jg_ok=!(!jg_ie&&!jg_dom)}
function _pntCnvDom(){var a=this.wnd.document.createRange();a.setStartBefore(this.cnv);a=a.createContextualFragment(jg_fast?this._htmRpc():this.htm);this.cnv&&this.cnv.appendChild(a);this.htm=""}function _pntCnvIe(){this.cnv&&this.cnv.insertAdjacentHTML("BeforeEnd",jg_fast?this._htmRpc():this.htm);this.htm=""}function _pntDoc(){this.wnd.document.write(jg_fast?this._htmRpc():this.htm);this.htm=""}function _pntN(){}
function _mkDiv(a,b,c,d){this.htm+='<div style="position:absolute;left:'+a+"px;top:"+b+"px;width:"+c+"px;height:"+d+"px;clip:rect(0,"+c+"px,"+d+"px,0);background-color:"+this.color+(!jg_moz?";overflow:hidden":"")+';"></div>'}function _mkDivIe(a,b,c,d){this.htm+="%%"+this.color+";"+a+";"+b+";"+c+";"+d+";"}
function _mkDivPrt(a,b,c,d){this.htm+='<div style="position:absolute;border-left:'+c+"px solid "+this.color+";left:"+a+"px;top:"+b+"px;width:0px;height:"+d+"px;clip:rect(0,"+c+"px,"+d+"px,0);background-color:"+this.color+(!jg_moz?";overflow:hidden":"")+';"></div>'}var _regex=/%%([^;]+);([^;]+);([^;]+);([^;]+);([^;]+);/g;function _htmRpc(){return this.htm.replace(_regex,'<div style="overflow:hidden;position:absolute;background-color:$1;left:$2px;top:$3px;width:$4px;height:$5px"></div>\n')}
function _htmPrtRpc(){return this.htm.replace(_regex,'<div style="overflow:hidden;position:absolute;background-color:$1;left:$2px;top:$3px;width:$4px;height:$5px;border-left:$4px solid $1"></div>\n')}
function _mkLin(a,b,c,d){if(a>c)var e=c,f=d,c=a,d=b,a=e,b=f;var e=c-a,f=Math.abs(d-b),g=b,h=b>d?-1:1;if(e>=f){for(var i=f<<1,k=i-(e<<1),j=i-e,b=a;0<e;)--e,++a,0<j?(this._mkDiv(b,g,a-b,1),g+=h,j+=k,b=a):j+=i;this._mkDiv(b,g,c-b+1,1)}else if(i=e<<1,k=i-(f<<1),j=i-f,e=g,d<=b){for(;0<f;)--f,0<j?(this._mkDiv(a++,g,1,e-g+1),g+=h,j+=k,e=g):(g+=h,j+=i);this._mkDiv(c,d,1,e-d+1)}else{for(;0<f;)--f,g+=h,0<j?(this._mkDiv(a++,e,1,g-e),j+=k,e=g):j+=i;this._mkDiv(c,e,1,d-e+1)}}
function _mkLin2D(a,b,c,d){if(a>c)var e=c,f=d,c=a,d=b,a=e,b=f;var e=c-a,f=Math.abs(d-b),g=b,h=b>d?-1:1,i=this.stroke;if(e>=f){if(0<e&&0<i-3)var k=(i*e*Math.sqrt(1+f*f/(e*e))-e-(i>>1)*f)/e,k=(!(i-4)?Math.ceil(k):Math.round(k))+1;else k=i;for(var i=Math.ceil(i/2),j=f<<1,m=j-(e<<1),l=j-e,b=a;0<e;)--e,++a,0<l?(this._mkDiv(b,g,a-b+i,k),g+=h,l+=m,b=a):l+=j;this._mkDiv(b,g,c-b+i+1,k)}else if(0<i-3?(k=(i*f*Math.sqrt(1+e*e/(f*f))-(i>>1)*e-f)/f,k=(!(i-4)?Math.ceil(k):Math.round(k))+1):k=i,i=Math.round(i/2),
j=e<<1,m=j-(f<<1),l=j-f,e=g,d<=b){for(++i;0<f;)--f,0<l?(this._mkDiv(a++,g,k,e-g+i),g+=h,l+=m,e=g):(g+=h,l+=j);this._mkDiv(c,d,k,e-d+i)}else{for(;0<f;)--f,g+=h,0<l?(this._mkDiv(a++,e,k,g-e+i),l+=m,e=g):l+=j;this._mkDiv(c,e,k,d-e+i+1)}}
function _mkLinDott(a,b,c,d){if(a>c)var e=c,f=d,c=a,d=b,a=e,b=f;c-=a;e=Math.abs(d-b);f=b;b=b>d?-1:1;d=!0;if(c>=e)for(var g=e<<1,h=g-(c<<1),i=g-c;0<c;)--c,d&&this._mkDiv(a,f,1,1),d=!d,0<i?(f+=b,i+=h):i+=g,++a;else{g=c<<1;h=g-(e<<1);for(i=g-e;0<e;)--e,d&&this._mkDiv(a,f,1,1),d=!d,f+=b,0<i?(++a,i+=h):i+=g}d&&this._mkDiv(a,f,1,1)}
function _mkOv(a,b,c,d){for(var e=++c>>1,f=++d>>1,c=c&1,d=d&1,a=a+e,b=b+f,g=0,h=f,i=0,k=f,j=e*e<<1,m=j<<1,l=f*f<<1,n=l<<1,r=(j>>1)*(1-(f<<1))+l,f=(l>>1)-j*((f<<1)-1),p,o;0<h;)0>r?(r+=l*((g<<1)+3),f+=n*++g):0>f?(r+=l*((g<<1)+3)-m*(h-1),f+=n*++g-j*((h--<<1)-3),p=g-i,o=k-h,p&2&&o&2?(this._mkOvQds(a,b,g-2,h+2,1,1,c,d),this._mkOvQds(a,b,g-1,h+1,1,1,c,d)):this._mkOvQds(a,b,g-1,k,p,o,c,d),i=g,k=h):(f-=j*((h<<1)-3),r-=m*--h);p=e-i+1;o=(k<<1)+d;h=b-k;this._mkDiv(a-e,h,p,o);this._mkDiv(a+i+c-1,h,p,o)}
function _mkOv2D(a,b,c,d){var e=this.stroke,c=c+(e+1),d=d+(e+1),f=c>>1,g=d>>1,h=c&1,i=d&1,a=a+f,b=b+g,k=0,j=g,m=f*f<<1,l=m<<1,n=g*g<<1,r=n<<1,p=(m>>1)*(1-(g<<1))+n,o=(n>>1)-m*((g<<1)-1);if(0>e-4&&(!(e-2)||0<c-51&&0<d-51)){for(var q=0;0<j;)0>p?(p+=n*((k<<1)+3),o+=r*++k):0>o?(p+=n*((k<<1)+3)-l*(j-1),o+=r*++k-m*((j--<<1)-3),c=k-q,d=g-j,c-1?(c=c+1+(e&1),d=e):d-1?(c=e,d+=1+(e&1)):c=d=e,this._mkOvQds(a,b,k-1,g,c,d,h,i),q=k,g=j):(o-=m*((j<<1)-3),p-=l*--j);this._mkDiv(a-f,b-g,e,(g<<1)+i);this._mkDiv(a+f+
h-e,b-g,e,(g<<1)+i)}else{var c=c-(e<<1)>>1,q=d-(e<<1)>>1,s=0,t=q,u=c*c<<1,v=u<<1,z=q*q<<1,B=z<<1,x=(u>>1)*(1-(q<<1))+z,y=(z>>1)-u*((q<<1)-1),e=[],d=[],c=[];e[0]=0;d[0]=g;for(c[0]=q-1;0<j;)if(0>p?(e[e.length]=k,d[d.length]=j,p+=n*((k<<1)+3),o+=r*++k):0>o?(e[e.length]=k,p+=n*((k<<1)+3)-l*(j-1),o+=r*++k-m*((j--<<1)-3),d[d.length]=j):(o-=m*((j<<1)-3),p-=l*--j),0<t)0>x?(x+=z*((s<<1)+3),y+=B*++s,c[c.length]=t-1):0>y?(x+=z*((s<<1)+3)-v*(t-1),y+=B*++s-u*((t--<<1)-3),c[c.length]=t-1):(y-=u*((t<<1)-3),x-=v*
--t,c[c.length-1]--);q=-h;j=c[0];m=e.length;for(l=0;l<m;l++)if("undefined"!=typeof c[l]){if(c[l]<j||d[l]<g)k=e[l],this._mkOvQds(a,b,k,g,k-q,g-j,h,i),q=k,g=d[l],j=c[l]}else k=e[l],this._mkDiv(a-k,b-g,1,(g<<1)+i),this._mkDiv(a+q+h,b-g,1,(g<<1)+i),q=k,g=d[l];this._mkDiv(a-f,b-g,1,(g<<1)+i);this._mkDiv(a+q+h,b-g,1,(g<<1)+i)}}
function _mkOvDott(a,b,c,d){for(var e=++c>>1,f=++d>>1,c=c&1,d=d&1,g=d^1,a=a+e,b=b+f,h=0,i=f,e=e*e<<1,k=e<<1,j=f*f<<1,m=j<<1,l=(e>>1)*(1-(f<<1))+j,f=(j>>1)-e*((f<<1)-1),n=!0;0<i;)0>l?(l+=j*((h<<1)+3),f+=m*++h):0>f?(l+=j*((h<<1)+3)-k*(i-1),f+=m*++h-e*((i--<<1)-3)):(f-=e*((i<<1)-3),l-=k*--i),n&&i>=g&&this._mkOvQds(a,b,h,i,1,1,c,d),n=!n}function _mkRect(a,b,c,d){var e=this.stroke;this._mkDiv(a,b,c,e);this._mkDiv(a+c,b,e,d);this._mkDiv(a,b+d,c+e,e);this._mkDiv(a,b+e,e,d-e)}
function _mkRectDott(a,b,c,d){this.drawLine(a,b,a+c,b);this.drawLine(a+c,b,a+c,b+d);this.drawLine(a,b+d,a+c,b+d);this.drawLine(a,b,a,b+d)}function jsgFont(){this.PLAIN="font-weight:normal;";this.BOLD="font-weight:bold;";this.ITALIC="font-style:italic;";this.BOLD_ITALIC=this.ITALIC_BOLD=this.ITALIC+this.BOLD}var Font=new jsgFont;function jsgStroke(){this.DOTTED=-1}var Stroke=new jsgStroke;
function jsGraphics(a,b){this.setColor=function(a){this.color=a.toLowerCase()};this.setStroke=function(a){this.stroke=a;a+1?(0<a-1?(this.drawLine=_mkLin2D,this._mkOv=_mkOv2D):(this.drawLine=_mkLin,this._mkOv=_mkOv),this.drawRect=_mkRect):(this.drawLine=_mkLinDott,this._mkOv=_mkOvDott,this.drawRect=_mkRectDott)};this.setPrintable=function(a){this.printable=a;jg_fast?(this._mkDiv=_mkDivIe,this._htmRpc=a?_htmPrtRpc:_htmRpc):this._mkDiv=a?_mkDivPrt:_mkDiv};this.setFont=function(a,b,e){this.ftFam=a;this.ftSz=
b;this.ftSty=e||Font.PLAIN};this.drawPolyline=this.drawPolyLine=function(a,b){for(var e=a.length-1;e;)--e,this.drawLine(a[e],b[e],a[e+1],b[e+1])};this.fillRect=function(a,b,e,f){this._mkDiv(a,b,e,f)};this.drawPolygon=function(a,b){this.drawPolyline(a,b);this.drawLine(a[a.length-1],b[a.length-1],a[0],b[0])};this.drawEllipse=this.drawOval=function(a,b,e,f){this._mkOv(a,b,e,f)};this.fillEllipse=this.fillOval=function(a,b,e,f){var g=e>>1,h=f>>1,i=e&1,f=f&1,a=a+g,b=b+h,k=0,j=h,m=h,l=g*g<<1,n=l<<1,r=h*
h<<1,p=r<<1,o=(l>>1)*(1-(h<<1))+r,h=(r>>1)-l*((h<<1)-1),q,s,t;if(e)for(;0<j;)0>o?(o+=r*((k<<1)+3),h+=p*++k):0>h?(o+=r*((k<<1)+3)-n*(j-1),q=a-k,s=(k<<1)+i,h+=p*++k-l*((j--<<1)-3),t=m-j,this._mkDiv(q,b-m,s,t),this._mkDiv(q,b+j+f,s,t),m=j):(h-=l*((j<<1)-3),o-=n*--j);this._mkDiv(a-g,b-m,e,(m<<1)+f)};this.fillArc=function(a,b,e,f,g,h){var i=e>>1,k=f>>1,e=e&1|(f&1)<<16,a=a+i,b=b+k,f=0,j=k,m=f,l=j,n=i*i<<1,r=n<<1,p=k*k<<1,o=p<<1,q=(n>>1)*(1-(k<<1))+p,s=(p>>1)-n*((k<<1)-1),t=1<<(Math.floor((g%=360)/180)<<
3)|2<<(Math.floor((h%=360)/180)<<3)|(g>=h)<<16,u=Array(k+1),v=Array(k+1),g=g*(Math.PI/180),h=h*(Math.PI/180),m=a+Math.round(i*Math.cos(g)),g=b+Math.round(-k*Math.sin(g));_mkLinVirt(u,a,b,m,g);i=a+Math.round(i*Math.cos(h));h=b+Math.round(-k*Math.sin(h));for(_mkLinVirt(v,a,b,i,h);0<j;)if(0>q)q+=p*((f<<1)+3),s+=o*++f;else if(0>s)q+=p*((f<<1)+3)-r*(j-1),m=f,s+=o*++f-n*((j--<<1)-3),this._mkArcDiv(m,j,l,a,b,e,u,v,t),l=j;else if(s-=n*((j<<1)-3),q-=r*--j,j&&(u[j]!=u[j-1]||v[j]!=v[j-1]))this._mkArcDiv(f,j,
l,a,b,e,u,v,t),l=j;this._mkArcDiv(f,0,l,a,b,e,u,v,t);e>>16&&(t>>16?(h=g<=b||h>b?a-f:a,this._mkDiv(h,b,f+a-h+(e&65535),1)):t&1&&h>b&&this._mkDiv(a-f,b,f,1))};this.fillPolygon=function(a,b){var e,f,g,h,i,k,j,m,l,n=a.length;if(n){f=b[0];g=b[0];for(e=1;e<n;e++)b[e]<f&&(f=b[e]),b[e]>g&&(g=b[e]);for(;f<=g;f++){var r=[];for(e=l=0;e<n;e++){e?(h=e-1,m=e):(h=n-1,m=0);i=b[h];j=b[m];if(i<j)h=a[h],k=a[m];else if(i>j)j=b[h],i=b[m],k=a[h],h=a[m];else continue;f>=i&&f<j?r[l++]=Math.round((f-i)*(k-h)/(j-i)+h):f==
g&&(f>i&&f<=j)&&(r[l++]=Math.round((f-i)*(k-h)/(j-i)+h))}r.sort(_CompInt);for(e=0;e<l;e+=2)this._mkDiv(r[e],f,r[e+1]-r[e]+1,1)}}};this.drawString=function(a,b,e){this.htm+='<div style="position:absolute;white-space:nowrap;left:'+b+"px;top:"+e+"px;font-family:"+this.ftFam+";font-size:"+this.ftSz+";color:"+this.color+";"+this.ftSty+'">'+a+"</div>"};this.drawStringRect=function(a,b,e,f,g){this.htm+='<div style="position:absolute;overflow:hidden;left:'+b+"px;top:"+e+"px;width:"+f+"px;text-align:"+g+";font-family:"+
this.ftFam+";font-size:"+this.ftSz+";color:"+this.color+";"+this.ftSty+'">'+a+"</div>"};this.drawImage=function(a,b,e,f,g,h){this.htm+='<div style="position:absolute;left:'+b+"px;top:"+e+"px;"+(f?"width:"+f+"px;":"")+(g?"height:"+g+"px;":"")+'"><img src="'+a+'"'+(f?' width="'+f+'"':"")+(g?' height="'+g+'"':"")+(h?" "+h:"")+"></div>"};this.clear=function(){this.htm="";this.cnv&&(this.cnv.innerHTML="")};this._mkOvQds=function(a,b,e,f,g,h,i,k){var j=a-e,a=a+e+i-g,e=b-f,b=b+f+k-h;a>j+g?(this._mkDiv(a,
e,g,h),this._mkDiv(a,b,g,h)):g=a-j+g;this._mkDiv(j,e,g,h);this._mkDiv(j,b,g,h)};this._mkArcDiv=function(a,b,e,f,g,h,i,k,j){var m=f+a+(h&65535),e=e-b,l,n;e||(e=1);a=f-a;if(j&16711680){f=g-b-e;if(j&255){if(j&2&&(l=Math.max(a,k[b]),n=m-l,0<n&&this._mkDiv(l,f,n,e)),j&1)n=Math.min(m,i[b]),n-=a,0<n&&this._mkDiv(a,f,n,e)}else this._mkDiv(a,f,m-a,e);f=g+b+(h>>16);if(j&65280){if(j&256&&(l=Math.max(a,i[b]),n=m-l,0<n&&this._mkDiv(l,f,n,e)),j&512)n=Math.min(m,k[b]),n-=a,0<n&&this._mkDiv(a,f,n,e)}else this._mkDiv(a,
f,m-a,e)}else if(j&255&&(l=j&2?Math.max(a,k[b]):a,n=j&1?Math.min(m,i[b]):m,n-=l,0<n&&this._mkDiv(l,g-b-e,n,e)),j&65280)l=j&256?Math.max(a,i[b]):a,n=j&512?Math.min(m,k[b]):m,n-=l,0<n&&this._mkDiv(l,g+b+(h>>16),n,e)};this.setStroke(1);this.setFont("verdana,geneva,helvetica,sans-serif","12px",Font.PLAIN);this.color="#000000";this.htm="";this.wnd=b||window;jg_ok||_chkDHTM(this.wnd);jg_ok?a?(this.cont="string"==typeof a?document.all?this.wnd.document.all[a]||null:document.getElementById?this.wnd.document.getElementById(a)||
null:null:a==window.document?document.getElementsByTagName("body")[0]:a,this.cnv=this.wnd.document.createElement("div"),this.cnv.style.fontSize=0,this.cont.appendChild(this.cnv),this.paint=jg_dom?_pntCnvDom:_pntCnvIe):this.paint=_pntDoc:this.paint=_pntN;this.setPrintable(!1)}
function _mkLinVirt(a,b,c,d,e){var f=Math.abs(d-b),e=Math.abs(e-c),c=b,d=b>d?-1:1,g,b=0;if(f>=e){var h=e<<1,i=h-(f<<1);for(g=h-f;0<f;)--f,0<g?(a[b++]=c,g+=i):g+=h,c+=d}else{h=f<<1;i=h-(e<<1);for(g=h-e;0<e;)--e,a[b++]=c,0<g?(c+=d,g+=i):g+=h}f=a.length;for(b=f-b;b;)a[f-b--]=c}function _CompInt(a,b){return a-b}draw2d.UUID=function(){};draw2d.UUID.prototype.type="draw2d.UUID";
draw2d.UUID.create=function(){var a=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()};draw2d.PositionConstants=function(){};draw2d.PositionConstants.NORTH=1;draw2d.PositionConstants.SOUTH=4;draw2d.PositionConstants.WEST=8;draw2d.PositionConstants.EAST=16;draw2d.SnapToGeometryEntry=function(a,b){this.type=a;this.location=b};draw2d.SnapToGeometryEntry.prototype.getLocation=function(){return this.location};
draw2d.SnapToGeometryEntry.prototype.getType=function(){return this.type};draw2d.ToolGeneric=function(a){this.y=this.x=0;this.enabled=!0;this.tooltip=null;this.palette=a;this.html=this.createHTMLElement();this.setDimension(10,10)};draw2d.ToolGeneric.prototype.type="draw2d.ToolGeneric";draw2d.ToolGeneric.prototype.dispose=function(){};draw2d.ToolGeneric.prototype.getImageUrl=function(){return this.type+".png"};draw2d.ToolGeneric.prototype.getWorkflow=function(){return this.getToolPalette().getWorkflow()};
draw2d.ToolGeneric.prototype.getToolPalette=function(){return this.palette};
draw2d.ToolGeneric.prototype.createHTMLElement=function(){var a=document.createElement("div");a.id=this.id;a.style.position="absolute";a.style.left=this.x+"px";a.style.top=this.y+"px";a.style.height="24px";a.style.width="24px";a.style.margin="0px";a.style.padding="0px";a.style.backgroundImage=null!==this.getImageUrl()?"url("+this.getImageUrl()+")":"";var b=this;this.click=function(a){b.enabled&&b.palette.setActiveTool(b);a.cancelBubble=!0;a.returnValue=!1};a.addEventListener?a.addEventListener("click",
this.click,!1):a.attachEvent&&a.attachEvent("onclick",this.click);a.title=null!==this.tooltip?this.tooltip:"";return a};draw2d.ToolGeneric.prototype.getHTMLElement=function(){null===this.html&&(this.html=this.createHTMLElement());return this.html};draw2d.ToolGeneric.prototype.execute=function(){this.enabled&&this.palette.setActiveTool(null)};draw2d.ToolGeneric.prototype.setTooltip=function(a){this.tooltip=a;this.html.title=null!==this.tooltip?this.tooltip:""};
draw2d.ToolGeneric.prototype.setActive=function(a){this.enabled&&(this.html.style.border=!0===a?"1px inset":"0px")};draw2d.ToolGeneric.prototype.setEnabled=function(a){(this.enabled=a)?(this.html.style.filter="alpha(opacity=100)",this.html.style.opacity="1.0"):(this.html.style.filter="alpha(opacity=30)",this.html.style.opacity="0.3")};
draw2d.ToolGeneric.prototype.setDimension=function(a,b){this.width=a;this.height=b;null!==this.html&&(this.html.style.width=this.width+"px",this.html.style.height=this.height+"px")};draw2d.ToolGeneric.prototype.setPosition=function(a,b){this.x=Math.max(0,a);this.y=Math.max(0,b);null!==this.html&&(this.html.style.left=this.x+"px",this.html.style.top=this.y+"px")};draw2d.ToolGeneric.prototype.getWidth=function(){return this.width};draw2d.ToolGeneric.prototype.getHeight=function(){return this.height};
draw2d.ToolGeneric.prototype.getY=function(){return this.y};draw2d.ToolGeneric.prototype.getX=function(){return this.x};draw2d.ToolGeneric.prototype.getPosition=function(){return new draw2d.Point(this.x,this.y)};draw2d.CanvasDocument=function(a){this.canvas=a};draw2d.CanvasDocument.prototype.type="draw2d.CanvasDocument";
draw2d.CanvasDocument.prototype.getFigures=function(){for(var a=new draw2d.ArrayList,b=this.canvas.figures,c=this.canvas.dialogs,d=0;d<b.getSize();d++){var e=b.get(d);-1==c.indexOf(e)&&(null===e.getParent()&&!(e instanceof draw2d.WindowFigure))&&a.add(e)}return a};draw2d.CanvasDocument.prototype.getFigure=function(a){return this.canvas.getFigure(a)};draw2d.CanvasDocument.prototype.getLines=function(){return this.canvas.getLines()};draw2d.CanvasDocument.prototype.getLine=function(a){return this.canvas.getLine(a)};
draw2d.CommandStackEvent=function(a,b){this.command=a;this.details=b};draw2d.CommandStackEvent.prototype.type="draw2d.CommandStackEvent";draw2d.CommandStackEvent.prototype.getCommand=function(){return this.command};draw2d.CommandStackEvent.prototype.getDetails=function(){return this.details};draw2d.CommandStackEvent.prototype.isPostChangeEvent=function(){return 0!=(this.getDetails()&draw2d.CommandStack.POST_MASK)};
draw2d.CommandStackEvent.prototype.isPreChangeEvent=function(){return 0!=(this.getDetails()&draw2d.CommandStack.PRE_MASK)};draw2d.MenuItem=function(a,b,c){this.label=a;this.iconUrl=b;this.parentMenu=null;this.action=c};draw2d.MenuItem.prototype.type="draw2d.MenuItem";draw2d.MenuItem.prototype.isEnabled=function(){return!0};draw2d.MenuItem.prototype.getLabel=function(){return this.label};draw2d.MenuItem.prototype.execute=function(a,b){this.parentMenu.workflow.showMenu(null);this.action(a,b)};
draw2d.bpmn.JsonSerializer=function(){};draw2d.bpmn.JsonSerializer.prototype.getChildren=function(a){var b=[],a=a.getChildren();a.getSize();for(var c=0;c<a.getSize();c++)b.push(this.getData(a.get(c)));return b};
draw2d.bpmn.JsonSerializer.prototype.getData=function(a){var b=TeamTime.jQuery,c={};c.id=a.getId();c.type=a.type;c.x=a.getX();c.y=a.getY();c.width=a.getWidth();c.height=a.getHeight();!(a instanceof draw2d.bpmn.Start)&&!(a instanceof draw2d.bpmn.End)&&(c.text=a.getText());null!=a.parentRow&&(c.parentRow=b(a.parentRow).attr("id"));null!=a.parentCol&&(c.parentCol=b(a.parentCol).attr("id"));a instanceof draw2d.bpmn.Activity&&(c.viewState=a.viewState,c.originalWidth=a.originalWidth,c.originalHeight=a.originalHeight,
c.children=this.getChildren(a),a.paramsData&&(c.paramsData=a.paramsData));return c};
draw2d.bpmn.JsonSerializer.prototype.initData=function(a,b){var c=TeamTime.jQuery,d=a.type.replace("bpmn.",""),d=new draw2d.bpmn[d];d.setId(a.id);b.workflow.addFigure(d,a.x,a.y);d.setDimension(a.width,a.height);d.parentRow=c(b.rows).children("li#"+a.parentRow);d.parentCol=c(b.columns).children("li#"+a.parentCol);!(d instanceof draw2d.bpmn.Start)&&!(d instanceof draw2d.bpmn.End)&&"text"in a&&d.setText(a.text);if(d instanceof draw2d.bpmn.Activity){"expanded"==a.viewState?(d.originalWidth=a.width,d.originalHeight=
a.height):"collapsed"==a.viewState&&d.setDimension(a.originalWidth,a.originalHeight);if(a.children&&0<a.children.length)for(c=0;c<a.children.length;c++){var e=this.initData(a.children[c],b);e&&d.addChild(e)}"linked"==a.viewState?d.setViewState(a.viewState):d.setViewMode(d,a.viewState);a.paramsData&&(d.paramsData=a.paramsData)}return d};
draw2d.bpmn.JsonSerializer.prototype.serialize=function(a){var b=TeamTime.jQuery,c={rows:[]};b(a.rows).children("li").each(function(d,e){c.rows.push({id:b(e).attr("id"),size:b(e).height(),title:a.getTitle(b(e),"row")})});c.columns=[];b(a.columns).children("li").each(function(d,e){c.columns.push({id:b(e).attr("id"),size:b(e).width(),title:a.getTitle(b(e),"column")})});c.figures=[];var d=a.workflow.getFigures(),e,f;f=d.getSize();for(e=0;e<f;e++){var g=d.get(e);"draw2d.ToolPalette"!=g.type&&null==g.getParent()&&
c.figures.push(this.getData(d.get(e)))}c.connections=[];d=a.workflow.getLines();f=d.getSize();for(e=0;e<f;e++)g=d.get(e),c.connections.push({label:g.label.getText(),source:{figureId:g.sourcePort.getParent().getId(),name:g.sourcePort.getName()},target:{figureId:g.targetPort.getParent().getId(),name:g.targetPort.getName()}});c.changed=a.changedFigures.getItems();return JSON.stringify(c,null,"\t")};
draw2d.bpmn.JsonSerializer.prototype.unserialize=function(a,b){var c=JSON.parse(b),d;for(d=0;d<c.rows.length;d++){var e=c.rows[d];a.appendRow(e.title,e.id,e.size)}for(d=0;d<c.columns.length;d++)e=c.columns[d],a.appendColumn(e.title,e.id,e.size);for(d=0;d<c.figures.length;d++)this.initData(c.figures[d],a);for(d=0;d<c.connections.length;d++){var e=c.connections[d],f=new draw2d.bpmn.Connection,g=a.workflow.getFigure(e.source.figureId),h=a.workflow.getFigure(e.target.figureId);g&&h&&(f.setSource(g.getPort(e.source.name)),
f.setTarget(h.getPort(e.target.name)),a.workflow.addFigure(f))}c=a.workflow.getFigures();e=a.workflow.getFigures().getSize();for(d=0;d<e;d++)if(c.get(d)instanceof draw2d.bpmn.Activity&&"collapsed"==c.get(d).viewState){f=c.get(d).getChildren();g=f.getSize();for(h=0;h<g;h++)f.get(h).setVisibility(!1)}};draw2d.bpmn.SelectionChangeListener=function(){this.currentFigure=null};
draw2d.bpmn.SelectionChangeListener.prototype.onSelectionChanged=function(a){if(a!=this.currentFigure&&!(a instanceof draw2d.Line)){var b=TeamTime.jQuery;if(this.currentFigure){var c=this.currentFigure.getContentElement();c&&b(c).blur()}this.currentFigure=a}};draw2d.ExternalPalette=function(a,b){this.html=document.getElementById(b);this.workflow=a;this.parts=new draw2d.ArrayList};draw2d.ExternalPalette.prototype.type="draw2d.ExternalPalette";draw2d.ExternalPalette.prototype.getHTMLElement=function(){return this.html};
draw2d.ExternalPalette.prototype.addPalettePart=function(a){if(!(a instanceof draw2d.AbstractPalettePart))throw"parameter is not instanceof [draw2d.AbstractPalettePart]";this.parts.add(a);this.html.appendChild(a.getHTMLElement());a.setEnviroment(this.workflow,this)};
var MooCanvas=new Class({initialize:function(a,b){var c;"string"==$type(a)&&(b=$merge({width:300,height:150},b,{id:a}),c=new Element("canvas",b),c.getContext||(CanvasRenderingContext2D.cssFixed||(document.createStyleSheet().cssText="canvas{display:inline-block;overflow:hidden;text-align:left;cursor:default;}v\\:*{behavior:url(#default#VML)}o\\:*{behavior:url(#default#VML)}",CanvasRenderingContext2D.cssFixed=!0),c.set({styles:{width:b.width,height:b.height,display:"inline-block",overflow:"hidden"},
getContext:function(){return this.context=this.context||new CanvasRenderingContext2D(c)}})));return c}}),CanvasRenderingContext2D=new Class({initialize:function(a){this.parent=a;this.fragment=document.createDocumentFragment();this.element=new Element("div",{styles:{width:a.clientWidth||a.width,height:a.clientHeight||a.height,overflow:"hidden",position:"absolute"}});this.fragment.appendChild(this.element);this.m=[[1,0,0],[0,1,0],[0,0,1]];this.rot=0;this.state=[];this.path=[];this.delay=30;this.max=
10;this.i=0;this.Z=10;this.Z2=this.Z/2;this.arcScaleY=this.arcScaleX=1;this.currentY=this.currentX=0;this.miterLimit=1*this.Z},lineWidth:1,strokeStyle:"#000",fillStyle:"#fff",globalAlpha:1,globalCompositeOperation:"source-over",lineCap:"butt",lineJoin:"miter",shadowBlur:0,shadowColor:"#000",shadowOffsetX:0,shadowOffsetY:0});
CanvasRenderingContext2D.implement({beginPath:function(){this.path=[];this.moved=!1},moveTo:function(a,b){this.path.push("m",this.coord(a,b));this.currentX=a;this.currentY=b;this.moved=!0},closePath:function(){this.path.push("x")},lineTo:function(a,b){this.path.push(this.moved?"l":",",this.coord(a,b));this.currentX=a;this.currentY=b;this.moved=!1},quadraticCurveTo:function(a,b,c,d){a*=2;b*=2;this.bezierCurveTo((a+this.currentX)/3,(b+this.currentY)/3,(a+c)/3,(b+d)/3,c,d)},bezierCurveTo:function(a,
b,c,d,e,f){this.path.push(" c ",this.coord(a,b),",",this.coord(c,d),",",this.coord(e,f));this.currentX=e;this.currentY=f},arcTo:function(){},arc:function(a,b,c,d,e,f){0===this.rot&&(c*=this.Z);var g=Math.cos(d)*c,h=Math.sin(d)*c,i=Math.cos(e)*c,k=Math.sin(e)*c;if(0!==this.rot){var j=Math.PI/24;this.lineTo(g+a,h+b);if(f)for(d<e&&(d+=2*Math.PI);d-j>e;)this.lineTo(a+Math.cos(d-=j)*c,b+Math.sin(d)*c);else for(e<d&&(e+=2*Math.PI);d+j<e;)this.lineTo(a+Math.cos(d+=j)*c,b+Math.sin(d)*c);this.lineTo(i+a,k+
b)}else g==i&&!f&&(g+=0.125),d=this.getCoords(a,b),this.path.push(f?"at ":"wa ",Math.round(d.x-this.arcScaleX*c)+","+Math.round(d.y-this.arcScaleY*c)," ",Math.round(d.x+this.arcScaleX*c)+","+Math.round(d.y+this.arcScaleY*c)," ",this.coord(g+a-this.Z2,h+b-this.Z2)," ",this.coord(i+a-this.Z2,k+b-this.Z2))},rect:function(a,b,c,d){this.moveTo(a,b);this.lineTo(a+c,b);this.lineTo(a+c,b+d);this.lineTo(a,b+d);this.closePath()},fill:function(){this.stroke(!0)},stroke:function(a){if(this.path.length){var b;
a?b=[1E3,"<v:fill "+this.processColorObject(this.fillStyle)+"></v:fill>"]:(b=this.processColor(this.strokeStyle),b=[10,'<v:stroke endcap="'+("butt"==this.lineCap?"flat":this.lineCap)+'" joinstyle="'+this.lineJoin+'" color="'+b.color+'" opacity="'+b.opacity+'"/>']);this.element.insertAdjacentHTML("beforeEnd",'<v:shape path="'+this.path.join("")+'e" stroked="'+!a+'" '+(!a?'strokeweight="'+0.8*this.lineWidth*this.m[0][0]+'" ':"")+'filled="'+!!a+'" coordsize="'+this.Z*b[0]+","+this.Z*b[0]+'" style="width:'+
b[0]+"px; height:"+b[0]+'px; position: absolute;">'+b[1]+"</v:shape>");this.parent.appendChild(this.fragment);a&&this.fillStyle.img&&(this.element.getLast().fill.alignshape=!1);this.path=[]}},clip:function(){},isPointInPath:function(){},processColor:function(a){var b=this.globalAlpha;"rgb"==a.substr(0,3)&&("a"==a.charAt(3)&&(b*=a.match(/([\d.]*)\)$/)[1]),a=a.rgbToHex());return{color:a,opacity:b}},processColorObject:function(a){var b="";if(a.addColorStop){b+=(a.r0?'type="gradientradial" focusposition="0.2, 0.2" focussize="0.2, 0.2" ':
'type="gradient" focus="0" angle="'+(180+180*a.angle(a.x0,a.y0,a.x1,a.y1)/Math.PI)+'" ')+'color="'+a.col0.color+'" opacity="'+100*a.col0.opacity+'%" color2="'+a.col1.color+'" o:opacity2="'+100*a.col1.opacity+'%" colors="';if(a.stops)for(var c=0,d=a.stops.length;c<d;c++)b+=Math.round(100*a.stops[c][0])+"% "+a.stops[c][1];b+='" '}else a.img?b+='type="tile" src="'+a.img.src+'" ':(a=this.processColor(a),b+='color="'+a.color+'" opacity="'+a.opacity+'" ');return b},getCoords:function(a,b){var c=this.m;
return{x:this.Z*(a*c[0][0]+b*c[1][0]+c[2][0])-this.Z2,y:this.Z*(a*c[0][1]+b*c[1][1]+c[2][1])-this.Z2}},coord:function(a,b){var c=this.m;return[Math.round(this.Z*(a*c[0][0]+b*c[1][0]+c[2][0])-this.Z2),",",Math.round(this.Z*(a*c[0][1]+b*c[1][1]+c[2][1])-this.Z2)].join("")}});CanvasRenderingContext2D.implement({clearRect:function(){this.element.innerHTML=""},fillRect:function(a,b,c,d){this.rect(a,b,c,d);this.fill()},strokeRect:function(a,b,c,d){this.rect(a,b,c,d);this.stroke()}});
CanvasRenderingContext2D.implement({scale:function(a,b){this.arcScaleX*=a;this.arcScaleY*=b;this.matMult([[a,0,0],[0,b,0],[0,0,1]])},rotate:function(a){this.rot+=a;var b=Math.cos(a),a=Math.sin(a);this.matMult([[b,a,0],[-a,b,0],[0,0,1]])},translate:function(a,b){this.matMult([[1,0,0],[0,1,0],[a,b,1]])},transform:function(a,b,c,d,e,f){this.matMult([[a,c,e],[b,d,f],[0,0,1]])},setTransform:function(a,b,c,d,e,f){this.m=[[1,0,0],[0,1,0],[0,0,1]];this.transform(a,b,c,d,e,f)},matMult:function(a){for(var b=
this.m,c=[[0,0,0],[0,0,0],[0,0,0]],d=0;3>d;d++)0!==a[0][d]&&this.sum(c[0],this.mult(a[0][d],b[d])),0!==a[1][d]&&this.sum(c[1],this.mult(a[1][d],b[d])),0!==a[2][d]&&this.sum(c[2],this.mult(a[2][d],b[d]));this.m=[c[0],c[1],c[2]]},mult:function(a,b){return[a*b[0],a*b[1],a*b[2]]},sum:function(a,b){a[0]+=b[0];a[1]+=b[1];a[2]+=b[2]}});
CanvasRenderingContext2D.implement({drawImage:function(a,b){var c=arguments,d=c.length,e=9==d?4:0;if(!(d+"").test(/3|5|9/))throw"Wrong number of arguments";var f=a.runtimeStyle.width,g=a.runtimeStyle.height;a.runtimeStyle.width="auto";a.runtimeStyle.height="auto";var h=a.width,i=a.height;a.runtimeStyle.width=f;a.runtimeStyle.height=g;var g=f=0,k=h,j=i,m=c[1+e],l=c[2+e],n=c[3+e]||h,e=c[4+e]||i;9==d&&(f=c[1],g=c[2],k=c[3],j=c[4]);c=this.getCoords(m,l);d='<v:group coordsize="'+10*this.Z+","+10*this.Z+
'" coordorigin="0,0" style="width:10;height:10;position:absolute;';1!=this.m[0][0]||this.m[0][1]?(m=Math.max(this.getCoords(m+n,l),this.getCoords(m,l+e),this.getCoords(m+n,l+e)),d+="padding:0;padding-right:"+Math.round(Math.max(c.x,m)/this.Z)+"px;padding-bottom:"+Math.round(Math.max(c.y,m)/this.Z)+"px;filter:progid:DXImageTransform.Microsoft.Matrix(M11='"+this.m[0][0]+"', M12='"+this.m[1][0]+"', M21='"+this.m[0][1]+"', M22='"+this.m[1][1]+"', Dx='"+Math.round(c.x/this.Z)+"', Dy='"+Math.round(c.y/
this.Z)+"', sizingmethod='clip');"):d+="top:"+Math.round(c.y/this.Z)+"px;left:"+Math.round(c.x/this.Z)+"px;";this.element.insertAdjacentHTML("BeforeEnd",d+'"><v:image src="'+a.src+'" style="width:'+this.Z*n+";height:"+this.Z*e+';" cropleft="'+f/h+'" croptop="'+g/i+'" cropright="'+(h-f-k)/h+'" cropbottom="'+(i-g-j)/i+'" /></v:group>');this.parent.appendChild(this.fragment)},drawImageFromRect:Function.empty,getImageData:function(){},putImageData:function(){},getCoords:function(a,b){var c=this.m;return{x:this.Z*
(a*c[0][0]+b*c[1][0]+c[2][0])-this.Z2,y:this.Z*(a*c[0][1]+b*c[1][1]+c[2][1])-this.Z2}}});draw2d.EditPolicy=function(a){this.policy=a};draw2d.EditPolicy.DELETE="DELETE";draw2d.EditPolicy.MOVE="MOVE";draw2d.EditPolicy.CONNECT="CONNECT";draw2d.EditPolicy.RESIZE="RESIZE";draw2d.EditPolicy.prototype.type="draw2d.EditPolicy";draw2d.EditPolicy.prototype.getPolicy=function(){return this.policy};function addClass(a,b){a?0>a.indexOf("|"+b+"|")&&(a+=b+"|"):a="|"+b+"|";return a}
DOMException=function(a){this._class=addClass(this._class,"DOMException");this.code=a};DOMException.INDEX_SIZE_ERR=1;DOMException.DOMSTRING_SIZE_ERR=2;DOMException.HIERARCHY_REQUEST_ERR=3;DOMException.WRONG_DOCUMENT_ERR=4;DOMException.INVALID_CHARACTER_ERR=5;DOMException.NO_DATA_ALLOWED_ERR=6;DOMException.NO_MODIFICATION_ALLOWED_ERR=7;DOMException.NOT_FOUND_ERR=8;DOMException.NOT_SUPPORTED_ERR=9;DOMException.INUSE_ATTRIBUTE_ERR=10;DOMException.INVALID_STATE_ERR=11;DOMException.SYNTAX_ERR=12;
DOMException.INVALID_MODIFICATION_ERR=13;DOMException.NAMESPACE_ERR=14;DOMException.INVALID_ACCESS_ERR=15;DOMImplementation=function(){this._class=addClass(this._class,"DOMImplementation");this._p=null;this.preserveWhiteSpace=!1;this.errorChecking=this.namespaceAware=!0};DOMImplementation.prototype.escapeString=function(a){return __escapeString(a)};DOMImplementation.prototype.unescapeString=function(a){return __unescapeString(a)};
DOMImplementation.prototype.hasFeature=function(a,b){var c=!1;"xml"==a.toLowerCase()?c=!b||"1.0"==b||"2.0"==b:"core"==a.toLowerCase()&&(c=!b||"2.0"==b);return c};DOMImplementation.prototype.loadXML=function(a){var b;try{b=new XMLP(a)}catch(c){alert("Error Creating the SAX Parser. Did you include xmlsax.js or tinyxmlsax.js in your web page?\nThe SAX parser is needed to populate XML for <SCRIPT>'s W3C DOM Parser with data.")}a=new DOMDocument(this);this._parseLoop(a,b);a._parseComplete=!0;return a};
DOMImplementation.prototype.translateErrCode=function(a){var b="";switch(a){case DOMException.INDEX_SIZE_ERR:b="INDEX_SIZE_ERR: Index out of bounds";break;case DOMException.DOMSTRING_SIZE_ERR:b="DOMSTRING_SIZE_ERR: The resulting string is too long to fit in a DOMString";break;case DOMException.HIERARCHY_REQUEST_ERR:b="HIERARCHY_REQUEST_ERR: The Node can not be inserted at this location";break;case DOMException.WRONG_DOCUMENT_ERR:b="WRONG_DOCUMENT_ERR: The source and the destination Documents are not the same";
break;case DOMException.INVALID_CHARACTER_ERR:b="INVALID_CHARACTER_ERR: The string contains an invalid character";break;case DOMException.NO_DATA_ALLOWED_ERR:b="NO_DATA_ALLOWED_ERR: This Node / NodeList does not support data";break;case DOMException.NO_MODIFICATION_ALLOWED_ERR:b="NO_MODIFICATION_ALLOWED_ERR: This object cannot be modified";break;case DOMException.NOT_FOUND_ERR:b="NOT_FOUND_ERR: The item cannot be found";break;case DOMException.NOT_SUPPORTED_ERR:b="NOT_SUPPORTED_ERR: This implementation does not support function";
break;case DOMException.INUSE_ATTRIBUTE_ERR:b="INUSE_ATTRIBUTE_ERR: The Attribute has already been assigned to another Element";break;case DOMException.INVALID_STATE_ERR:b="INVALID_STATE_ERR: The object is no longer usable";break;case DOMException.SYNTAX_ERR:b="SYNTAX_ERR: Syntax error";break;case DOMException.INVALID_MODIFICATION_ERR:b="INVALID_MODIFICATION_ERR: Cannot change the type of the object";break;case DOMException.NAMESPACE_ERR:b="NAMESPACE_ERR: The namespace declaration is incorrect";break;
case DOMException.INVALID_ACCESS_ERR:b="INVALID_ACCESS_ERR: The object does not support this function";break;default:b="UNKNOWN: Unknown Exception Code ("+a+")"}return b};
DOMImplementation.prototype._parseLoop=function(a,b){var c,d,e;iNodeParent=a;var f=[],g=[];this.namespaceAware&&(d=a.createNamespace(""),d.setValue("http://www.w3.org/2000/xmlns/"),a._namespaces.setNamedItem(d));for(;;)if(c=b.next(),c==XMLP._ELM_B){c=b.getName();trim(c,!0,!0);if(this.namespaceAware){c=a.createElementNS("",b.getName());c._namespaces=iNodeParent._namespaces._cloneNodes(c);for(h=0;h<b.getAttributeCount();h++)e=b.getAttributeName(h),this._isNamespaceDeclaration(e)?(this._parseNSName(e),
d="xmlns"!=e?a.createNamespace(e):a.createNamespace(""),d.setValue(b.getAttributeValue(h)),c._namespaces.setNamedItem(d)):((d=c.getAttributeNode(e))||(d=a.createAttributeNS("",e)),d.setValue(b.getAttributeValue(h)),c.setAttributeNodeNS(d),this._isIdDeclaration(e)&&(c.id=b.getAttributeValue(h)));c._namespaces.getNamedItem(c.prefix)&&(c.namespaceURI=c._namespaces.getNamedItem(c.prefix).value);for(h=0;h<c.attributes.length;h++)""!=c.attributes.item(h).prefix&&c._namespaces.getNamedItem(c.attributes.item(h).prefix)&&
(c.attributes.item(h).namespaceURI=c._namespaces.getNamedItem(c.attributes.item(h).prefix).value)}else{c=a.createElement(b.getName());for(var h=0;h<b.getAttributeCount();h++)e=b.getAttributeName(h),(d=c.getAttributeNode(e))||(d=a.createAttribute(e)),d.setValue(b.getAttributeValue(h)),c.setAttributeNode(d)}iNodeParent.nodeType==DOMNode.DOCUMENT_NODE&&(iNodeParent.documentElement=c);iNodeParent.appendChild(c);iNodeParent=c}else if(c==XMLP._ELM_E)iNodeParent=iNodeParent.parentNode;else if(c==XMLP._ELM_EMP){c=
b.getName();c=trim(c,!0,!0);if(this.namespaceAware){c=a.createElementNS("",b.getName());c._namespaces=iNodeParent._namespaces._cloneNodes(c);for(h=0;h<b.getAttributeCount();h++)e=b.getAttributeName(h),this._isNamespaceDeclaration(e)?(this._parseNSName(e),d="xmlns"!=e?a.createNamespace(e):a.createNamespace(""),d.setValue(b.getAttributeValue(h)),c._namespaces.setNamedItem(d)):((d=c.getAttributeNode(e))||(d=a.createAttributeNS("",e)),d.setValue(b.getAttributeValue(h)),c.setAttributeNodeNS(d),this._isIdDeclaration(e)&&
(c.id=b.getAttributeValue(h)));c._namespaces.getNamedItem(c.prefix)&&(c.namespaceURI=c._namespaces.getNamedItem(c.prefix).value);for(h=0;h<c.attributes.length;h++)""!=c.attributes.item(h).prefix&&c._namespaces.getNamedItem(c.attributes.item(h).prefix)&&(c.attributes.item(h).namespaceURI=c._namespaces.getNamedItem(c.attributes.item(h).prefix).value)}else{c=a.createElement(c);for(h=0;h<b.getAttributeCount();h++)e=b.getAttributeName(h),(d=c.getAttributeNode(e))||(d=a.createAttribute(e)),d.setValue(b.getAttributeValue(h)),
c.setAttributeNode(d)}iNodeParent.nodeType==DOMNode.DOCUMENT_NODE&&(iNodeParent.documentElement=c);iNodeParent.appendChild(c)}else if(c==XMLP._TEXT||c==XMLP._ENTITY)h=b.getContent().substring(b.getContentBegin(),b.getContentEnd()),this.preserveWhiteSpace||""==trim(h,!0,!0)&&(h=""),0<h.length&&(h=a.createTextNode(h),iNodeParent.appendChild(h),c==XMLP._ENTITY?f[f.length]=h:g[g.length]=h);else if(c==XMLP._PI)iNodeParent.appendChild(a.createProcessingInstruction(b.getName(),b.getContent().substring(b.getContentBegin(),
b.getContentEnd())));else if(c==XMLP._CDATA)h=b.getContent().substring(b.getContentBegin(),b.getContentEnd()),this.preserveWhiteSpace||(h=trim(h,!0,!0),h.replace(/ +/g," ")),0<h.length&&iNodeParent.appendChild(a.createCDATASection(h));else if(c==XMLP._COMMENT)h=b.getContent().substring(b.getContentBegin(),b.getContentEnd()),this.preserveWhiteSpace||(h=trim(h,!0,!0),h.replace(/ +/g," ")),0<h.length&&iNodeParent.appendChild(a.createComment(h));else if(c!=XMLP._DTD){if(c==XMLP._ERROR)throw new DOMException(DOMException.SYNTAX_ERR);
if(c==XMLP._NONE)if(iNodeParent==a)break;else throw new DOMException(DOMException.SYNTAX_ERR);}c=f.length;for(intLoop=0;intLoop<c;intLoop++)if(h=f[intLoop].getParentNode())if(h.normalize(),!this.preserveWhiteSpace){h=h.getChildNodes();d=h.getLength();for(intLoop2=0;intLoop2<d;intLoop2++)if(e=h.item(intLoop2),e.getNodeType()==DOMNode.TEXT_NODE){var i=e.getData(),i=trim(i,!0,!0);i.replace(/ +/g," ");e.setData(i)}}if(!this.preserveWhiteSpace){c=g.length;for(intLoop=0;intLoop<c;intLoop++)f=g[intLoop],
null!==f.getParentNode()&&(h=f.getData(),h=trim(h,!0,!0),h.replace(/ +/g," "),f.setData(h))}};DOMImplementation.prototype._isNamespaceDeclaration=function(a){return-1<a.indexOf("xmlns")};DOMImplementation.prototype._isIdDeclaration=function(a){return"id"==a.toLowerCase()};DOMImplementation.prototype._isValidName=function(a){return a.match(re_validName)};re_validName=/^[a-zA-Z_:][a-zA-Z0-9\.\-_:]*$/;DOMImplementation.prototype._isValidString=function(a){return 0>a.search(re_invalidStringChars)};
re_invalidStringChars=/\x01|\x02|\x03|\x04|\x05|\x06|\x07|\x08|\x0B|\x0C|\x0E|\x0F|\x10|\x11|\x12|\x13|\x14|\x15|\x16|\x17|\x18|\x19|\x1A|\x1B|\x1C|\x1D|\x1E|\x1F|\x7F/;DOMImplementation.prototype._parseNSName=function(a){var b={};b.prefix=a;b.namespaceName="";delimPos=a.indexOf(":");-1<delimPos&&(b.prefix=a.substring(0,delimPos),b.namespaceName=a.substring(delimPos+1,a.length));return b};
DOMImplementation.prototype._parseQName=function(a){var b={};b.localName=a;b.prefix="";delimPos=a.indexOf(":");-1<delimPos&&(b.prefix=a.substring(0,delimPos),b.localName=a.substring(delimPos+1,a.length));return b};DOMNodeList=function(a,b){this._class=addClass(this._class,"DOMNodeList");this._nodes=[];this.length=0;this.parentNode=b;this.ownerDocument=a;this._readonly=!1};DOMNodeList.prototype.getLength=function(){return this.length};
DOMNodeList.prototype.item=function(a){var b=null;0<=a&&a<this._nodes.length&&(b=this._nodes[a]);return b};DOMNodeList.prototype._findItemIndex=function(a){var b=-1;if(-1<a)for(var c=0;c<this._nodes.length;c++)if(this._nodes[c]._id==a){b=c;break}return b};
DOMNodeList.prototype._insertBefore=function(a,b){if(0<=b&&b<this._nodes.length){var c=[],c=this._nodes.slice(0,b);a.nodeType==DOMNode.DOCUMENT_FRAGMENT_NODE?c=c.concat(a.childNodes._nodes):c[c.length]=a;this._nodes=c.concat(this._nodes.slice(b));this.length=this._nodes.length}};
DOMNodeList.prototype._replaceChild=function(a,b){var c=null;if(0<=b&&b<this._nodes.length)if(c=this._nodes[b],a.nodeType==DOMNode.DOCUMENT_FRAGMENT_NODE){var d=[],d=this._nodes.slice(0,b),d=d.concat(a.childNodes._nodes);this._nodes=d.concat(this._nodes.slice(b+1))}else this._nodes[b]=a;return c};DOMNodeList.prototype._removeChild=function(a){var b=null;if(-1<a){var b=this._nodes[a],c=[],c=this._nodes.slice(0,a);this._nodes=c.concat(this._nodes.slice(a+1));this.length=this._nodes.length}return b};
DOMNodeList.prototype._appendChild=function(a){a.nodeType==DOMNode.DOCUMENT_FRAGMENT_NODE?this._nodes=this._nodes.concat(a.childNodes._nodes):this._nodes[this._nodes.length]=a;this.length=this._nodes.length};DOMNodeList.prototype._cloneNodes=function(a,b){for(var c=new DOMNodeList(this.ownerDocument,b),d=0;d<this._nodes.length;d++)c._appendChild(this._nodes[d].cloneNode(a));return c};DOMNodeList.prototype.toString=function(){for(var a="",b=0;b<this.length;b++)a+=this._nodes[b].toString();return a};
DOMNamedNodeMap=function(a,b){this._class=addClass(this._class,"DOMNamedNodeMap");this.DOMNodeList=DOMNodeList;this.DOMNodeList(a,b)};DOMNamedNodeMap.prototype=new DOMNodeList;DOMNamedNodeMap.prototype.getNamedItem=function(a){var b=null,a=this._findNamedItemIndex(a);-1<a&&(b=this._nodes[a]);return b};
DOMNamedNodeMap.prototype.setNamedItem=function(a){if(this.ownerDocument.implementation.errorChecking){if(this.ownerDocument!=a.ownerDocument)throw new DOMException(DOMException.WRONG_DOCUMENT_ERR);if(this._readonly||this.parentNode&&this.parentNode._readonly)throw new DOMException(DOMException.NO_MODIFICATION_ALLOWED_ERR);if(a.ownerElement&&a.ownerElement!=this.parentNode)throw new DOMException(DOMException.INUSE_ATTRIBUTE_ERR);}var b=this._findNamedItemIndex(a.name),c=null;if(-1<b){c=this._nodes[b];
if(this.ownerDocument.implementation.errorChecking&&c._readonly)throw new DOMException(DOMException.NO_MODIFICATION_ALLOWED_ERR);this._nodes[b]=a}else this._nodes[this.length]=a;this.length=this._nodes.length;a.ownerElement=this.parentNode;return c};
DOMNamedNodeMap.prototype.removeNamedItem=function(a){if(this.ownerDocument.implementation.errorChecking&&(this._readonly||this.parentNode&&this.parentNode._readonly))throw new DOMException(DOMException.NO_MODIFICATION_ALLOWED_ERR);a=this._findNamedItemIndex(a);if(this.ownerDocument.implementation.errorChecking&&0>a)throw new DOMException(DOMException.NOT_FOUND_ERR);var b=this._nodes[a];if(this.ownerDocument.implementation.errorChecking&&b._readonly)throw new DOMException(DOMException.NO_MODIFICATION_ALLOWED_ERR);
return this._removeChild(a)};DOMNamedNodeMap.prototype.getNamedItemNS=function(a,b){var c=null,d=this._findNamedItemNSIndex(a,b);-1<d&&(c=this._nodes[d]);return c};
DOMNamedNodeMap.prototype.setNamedItemNS=function(a){if(this.ownerDocument.implementation.errorChecking){if(this._readonly||this.parentNode&&this.parentNode._readonly)throw new DOMException(DOMException.NO_MODIFICATION_ALLOWED_ERR);if(this.ownerDocument!=a.ownerDocument)throw new DOMException(DOMException.WRONG_DOCUMENT_ERR);if(a.ownerElement&&a.ownerElement!=this.parentNode)throw new DOMException(DOMException.INUSE_ATTRIBUTE_ERR);}var b=this._findNamedItemNSIndex(a.namespaceURI,a.localName),c=null;
if(-1<b){c=this._nodes[b];if(this.ownerDocument.implementation.errorChecking&&c._readonly)throw new DOMException(DOMException.NO_MODIFICATION_ALLOWED_ERR);this._nodes[b]=a}else this._nodes[this.length]=a;this.length=this._nodes.length;a.ownerElement=this.parentNode;return c};
DOMNamedNodeMap.prototype.removeNamedItemNS=function(a,b){if(this.ownerDocument.implementation.errorChecking&&(this._readonly||this.parentNode&&this.parentNode._readonly))throw new DOMException(DOMException.NO_MODIFICATION_ALLOWED_ERR);var c=this._findNamedItemNSIndex(a,b);if(this.ownerDocument.implementation.errorChecking&&0>c)throw new DOMException(DOMException.NOT_FOUND_ERR);var d=this._nodes[c];if(this.ownerDocument.implementation.errorChecking&&d._readonly)throw new DOMException(DOMException.NO_MODIFICATION_ALLOWED_ERR);
return this._removeChild(c)};DOMNamedNodeMap.prototype._findNamedItemIndex=function(a){for(var b=-1,c=0;c<this._nodes.length;c++)if(this._nodes[c].name==a){b=c;break}return b};DOMNamedNodeMap.prototype._findNamedItemNSIndex=function(a,b){var c=-1;if(b)for(var d=0;d<this._nodes.length;d++)if(this._nodes[d].namespaceURI==a&&this._nodes[d].localName==b){c=d;break}return c};DOMNamedNodeMap.prototype._hasAttribute=function(a){var b=!1;-1<this._findNamedItemIndex(a)&&(b=!0);return b};
DOMNamedNodeMap.prototype._hasAttributeNS=function(a,b){var c=!1;-1<this._findNamedItemNSIndex(a,b)&&(c=!0);return c};DOMNamedNodeMap.prototype._cloneNodes=function(a){for(var a=new DOMNamedNodeMap(this.ownerDocument,a),b=0;b<this._nodes.length;b++)a._appendChild(this._nodes[b].cloneNode(!1));return a};DOMNamedNodeMap.prototype.toString=function(){for(var a="",b=0;b<this.length-1;b++)a+=this._nodes[b].toString()+" ";0<this.length&&(a+=this._nodes[this.length-1].toString());return a};
DOMNamespaceNodeMap=function(a,b){this._class=addClass(this._class,"DOMNamespaceNodeMap");this.DOMNamedNodeMap=DOMNamedNodeMap;this.DOMNamedNodeMap(a,b)};DOMNamespaceNodeMap.prototype=new DOMNamedNodeMap;DOMNamespaceNodeMap.prototype._findNamedItemIndex=function(a){for(var b=-1,c=0;c<this._nodes.length;c++)if(this._nodes[c].localName==a){b=c;break}return b};
DOMNamespaceNodeMap.prototype._cloneNodes=function(a){for(var a=new DOMNamespaceNodeMap(this.ownerDocument,a),b=0;b<this._nodes.length;b++)a._appendChild(this._nodes[b].cloneNode(!1));return a};DOMNamespaceNodeMap.prototype.toString=function(){for(var a="",b=0;b<this._nodes.length;b++){var c=null;try{c=this.parentNode.parentNode._namespaces.getNamedItem(this._nodes[b].localName)}catch(d){break}c&&""+c.nodeValue==""+this._nodes[b].nodeValue||(a+=this._nodes[b].toString()+" ")}return a};
DOMNode=function(a){this._class=addClass(this._class,"DOMNode");a&&(this._id=a._genId());this.nodeValue=this.nodeName=this.localName=this.prefix=this.namespaceURI="";this.nodeType=0;this.parentNode=null;this.childNodes=new DOMNodeList(a,this);this.nextSibling=this.previousSibling=this.lastChild=this.firstChild=null;this.attributes=new DOMNamedNodeMap(a,this);this.ownerDocument=a;this._namespaces=new DOMNamespaceNodeMap(a,this);this._readonly=!1};DOMNode.ELEMENT_NODE=1;DOMNode.ATTRIBUTE_NODE=2;
DOMNode.TEXT_NODE=3;DOMNode.CDATA_SECTION_NODE=4;DOMNode.ENTITY_REFERENCE_NODE=5;DOMNode.ENTITY_NODE=6;DOMNode.PROCESSING_INSTRUCTION_NODE=7;DOMNode.COMMENT_NODE=8;DOMNode.DOCUMENT_NODE=9;DOMNode.DOCUMENT_TYPE_NODE=10;DOMNode.DOCUMENT_FRAGMENT_NODE=11;DOMNode.NOTATION_NODE=12;DOMNode.NAMESPACE_NODE=13;DOMNode.prototype.hasAttributes=function(){return 0===this.attributes.length?!1:!0};DOMNode.prototype.getNodeName=function(){return this.nodeName};DOMNode.prototype.getNodeValue=function(){return this.nodeValue};
DOMNode.prototype.setNodeValue=function(a){if(this.ownerDocument.implementation.errorChecking&&this._readonly)throw new DOMException(DOMException.NO_MODIFICATION_ALLOWED_ERR);this.nodeValue=a};DOMNode.prototype.getNodeType=function(){return this.nodeType};DOMNode.prototype.getParentNode=function(){return this.parentNode};DOMNode.prototype.getChildNodes=function(){return this.childNodes};DOMNode.prototype.getFirstChild=function(){return this.firstChild};DOMNode.prototype.getLastChild=function(){return this.lastChild};
DOMNode.prototype.getPreviousSibling=function(){return this.previousSibling};DOMNode.prototype.getNextSibling=function(){return this.nextSibling};DOMNode.prototype.getAttributes=function(){return this.attributes};DOMNode.prototype.getOwnerDocument=function(){return this.ownerDocument};DOMNode.prototype.getNamespaceURI=function(){return this.namespaceURI};DOMNode.prototype.getPrefix=function(){return this.prefix};
DOMNode.prototype.setPrefix=function(a){if(this.ownerDocument.implementation.errorChecking){if(this._readonly)throw new DOMException(DOMException.NO_MODIFICATION_ALLOWED_ERR);if(!this.ownerDocument.implementation._isValidName(a))throw new DOMException(DOMException.INVALID_CHARACTER_ERR);if(!this.ownerDocument._isValidNamespace(this.namespaceURI,a+":"+this.localName))throw new DOMException(DOMException.NAMESPACE_ERR);if("xmlns"==a&&"http://www.w3.org/2000/xmlns/"!=this.namespaceURI)throw new DOMException(DOMException.NAMESPACE_ERR);
if(""==a&&"xmlns"==this.localName)throw new DOMException(DOMException.NAMESPACE_ERR);}this.prefix=a;this.nodeName=""!=this.prefix?this.prefix+":"+this.localName:this.localName};DOMNode.prototype.getLocalName=function(){return this.localName};
DOMNode.prototype.insertBefore=function(a,b){var c;if(this.ownerDocument.implementation.errorChecking){if(this._readonly)throw new DOMException(DOMException.NO_MODIFICATION_ALLOWED_ERR);if(this.ownerDocument!=a.ownerDocument)throw new DOMException(DOMException.WRONG_DOCUMENT_ERR);if(this._isAncestor(a))throw new DOMException(DOMException.HIERARCHY_REQUEST_ERR);}if(b){c=this.childNodes._findItemIndex(b._id);if(this.ownerDocument.implementation.errorChecking&&0>c)throw new DOMException(DOMException.NOT_FOUND_ERR);
(c=a.parentNode)&&c.removeChild(a);this.childNodes._insertBefore(a,this.childNodes._findItemIndex(b._id));c=b.previousSibling;if(a.nodeType==DOMNode.DOCUMENT_FRAGMENT_NODE){if(0<a.childNodes._nodes.length){for(var d=0;d<a.childNodes._nodes.length;d++)a.childNodes._nodes[d].parentNode=this;b.previousSibling=a.childNodes._nodes[a.childNodes._nodes.length-1]}}else a.parentNode=this,b.previousSibling=a}else c=this.lastChild,this.appendChild(a);a.nodeType==DOMNode.DOCUMENT_FRAGMENT_NODE?0<a.childNodes._nodes.length&&
(c?c.nextSibling=a.childNodes._nodes[0]:this.firstChild=a.childNodes._nodes[0],a.childNodes._nodes[0].previousSibling=c,a.childNodes._nodes[a.childNodes._nodes.length-1].nextSibling=b):(c?c.nextSibling=a:this.firstChild=a,a.previousSibling=c,a.nextSibling=b);return a};
DOMNode.prototype.replaceChild=function(a,b){var c=null;if(this.ownerDocument.implementation.errorChecking){if(this._readonly)throw new DOMException(DOMException.NO_MODIFICATION_ALLOWED_ERR);if(this.ownerDocument!=a.ownerDocument)throw new DOMException(DOMException.WRONG_DOCUMENT_ERR);if(this._isAncestor(a))throw new DOMException(DOMException.HIERARCHY_REQUEST_ERR);}c=this.childNodes._findItemIndex(b._id);if(this.ownerDocument.implementation.errorChecking&&0>c)throw new DOMException(DOMException.NOT_FOUND_ERR);
var d=a.parentNode;d&&d.removeChild(a);c=this.childNodes._replaceChild(a,c);if(a.nodeType==DOMNode.DOCUMENT_FRAGMENT_NODE){if(0<a.childNodes._nodes.length){for(d=0;d<a.childNodes._nodes.length;d++)a.childNodes._nodes[d].parentNode=this;b.previousSibling?b.previousSibling.nextSibling=a.childNodes._nodes[0]:this.firstChild=a.childNodes._nodes[0];b.nextSibling?b.nextSibling.previousSibling=a:this.lastChild=a.childNodes._nodes[a.childNodes._nodes.length-1];a.childNodes._nodes[0].previousSibling=b.previousSibling;
a.childNodes._nodes[a.childNodes._nodes.length-1].nextSibling=b.nextSibling}}else a.parentNode=this,b.previousSibling?b.previousSibling.nextSibling=a:this.firstChild=a,b.nextSibling?b.nextSibling.previousSibling=a:this.lastChild=a,a.previousSibling=b.previousSibling,a.nextSibling=b.nextSibling;return c};
DOMNode.prototype.removeChild=function(a){if(this.ownerDocument.implementation.errorChecking&&(this._readonly||a._readonly))throw new DOMException(DOMException.NO_MODIFICATION_ALLOWED_ERR);var b=this.childNodes._findItemIndex(a._id);if(this.ownerDocument.implementation.errorChecking&&0>b)throw new DOMException(DOMException.NOT_FOUND_ERR);this.childNodes._removeChild(b);a.parentNode=null;a.previousSibling?a.previousSibling.nextSibling=a.nextSibling:this.firstChild=a.nextSibling;a.nextSibling?a.nextSibling.previousSibling=
a.previousSibling:this.lastChild=a.previousSibling;a.previousSibling=null;a.nextSibling=null;return a};
DOMNode.prototype.appendChild=function(a){if(this.ownerDocument.implementation.errorChecking){if(this._readonly)throw new DOMException(DOMException.NO_MODIFICATION_ALLOWED_ERR);if(this.ownerDocument!=a.ownerDocument)throw new DOMException(DOMException.WRONG_DOCUMENT_ERR);if(this._isAncestor(a))throw new DOMException(DOMException.HIERARCHY_REQUEST_ERR);}var b=a.parentNode;b&&b.removeChild(a);this.childNodes._appendChild(a);if(a.nodeType==DOMNode.DOCUMENT_FRAGMENT_NODE){if(0<a.childNodes._nodes.length){for(b=
0;b<a.childNodes._nodes.length;b++)a.childNodes._nodes[b].parentNode=this;this.lastChild?(this.lastChild.nextSibling=a.childNodes._nodes[0],a.childNodes._nodes[0].previousSibling=this.lastChild,this.lastChild=a.childNodes._nodes[a.childNodes._nodes.length-1]):(this.lastChild=a.childNodes._nodes[a.childNodes._nodes.length-1],this.firstChild=a.childNodes._nodes[0])}}else a.parentNode=this,this.lastChild?(this.lastChild.nextSibling=a,a.previousSibling=this.lastChild,this.lastChild=a):this.firstChild=
this.lastChild=a;return a};DOMNode.prototype.hasChildNodes=function(){return 0<this.childNodes.length};DOMNode.prototype.cloneNode=function(a){try{return this.ownerDocument.importNode(this,a)}catch(b){return null}};
DOMNode.prototype.normalize=function(){var a,b=new DOMNodeList;if(this.nodeType==DOMNode.ELEMENT_NODE||this.nodeType==DOMNode.DOCUMENT_NODE){for(var c=null,d=0;d<this.childNodes.length;d++)a=this.childNodes.item(d),a.nodeType==DOMNode.TEXT_NODE?1>a.length?b._appendChild(a):c?(c.appendData(a.data),b._appendChild(a)):c=a:(c=null,a.normalize());for(d=0;d<b.length;d++)a=b.item(d),a.parentNode.removeChild(a)}};
DOMNode.prototype.isSupported=function(a,b){return this.ownerDocument.implementation.hasFeature(a,b)};DOMNode.prototype.getElementsByTagName=function(a){return this._getElementsByTagNameRecursive(a,new DOMNodeList(this.ownerDocument))};
DOMNode.prototype._getElementsByTagNameRecursive=function(a,b){if(this.nodeType==DOMNode.ELEMENT_NODE||this.nodeType==DOMNode.DOCUMENT_NODE){(this.nodeName==a||"*"==a)&&b._appendChild(this);for(var c=0;c<this.childNodes.length;c++)b=this.childNodes.item(c)._getElementsByTagNameRecursive(a,b)}return b};DOMNode.prototype.getXML=function(){return this.toString()};DOMNode.prototype.getElementsByTagNameNS=function(a,b){return this._getElementsByTagNameNSRecursive(a,b,new DOMNodeList(this.ownerDocument))};
DOMNode.prototype._getElementsByTagNameNSRecursive=function(a,b,c){if(this.nodeType==DOMNode.ELEMENT_NODE||this.nodeType==DOMNode.DOCUMENT_NODE){(this.namespaceURI==a||"*"==a)&&(this.localName==b||"*"==b)&&c._appendChild(this);for(var d=0;d<this.childNodes.length;d++)c=this.childNodes.item(d)._getElementsByTagNameNSRecursive(a,b,c)}return c};DOMNode.prototype._isAncestor=function(a){return this==a||this.parentNode&&this.parentNode._isAncestor(a)};
DOMNode.prototype.importNode=function(a,b){var c;this.getOwnerDocument()._performingImportNodeOperation=!0;try{if(a.nodeType==DOMNode.ELEMENT_NODE)if(this.ownerDocument.implementation.namespaceAware){c=this.ownerDocument.createElementNS(a.namespaceURI,a.nodeName);for(d=0;d<a.attributes.length;d++)c.setAttributeNS(a.attributes.item(d).namespaceURI,a.attributes.item(d).name,a.attributes.item(d).value);for(d=0;d<a._namespaces.length;d++)c._namespaces._nodes[d]=this.ownerDocument.createNamespace(a._namespaces.item(d).localName),
c._namespaces._nodes[d].setValue(a._namespaces.item(d).value)}else{c=this.ownerDocument.createElement(a.tagName);for(var d=0;d<a.attributes.length;d++)c.setAttribute(a.attributes.item(d).name,a.attributes.item(d).value)}else if(a.nodeType==DOMNode.ATTRIBUTE_NODE){if(this.ownerDocument.implementation.namespaceAware){c=this.ownerDocument.createAttributeNS(a.namespaceURI,a.nodeName);for(d=0;d<a._namespaces.length;d++)c._namespaces._nodes[d]=this.ownerDocument.createNamespace(a._namespaces.item(d).localName),
c._namespaces._nodes[d].setValue(a._namespaces.item(d).value)}else c=this.ownerDocument.createAttribute(a.name);c.setValue(a.value)}else if(a.nodeType==DOMNode.DOCUMENT_FRAGMENT)c=this.ownerDocument.createDocumentFragment();else if(a.nodeType==DOMNode.NAMESPACE_NODE)c=this.ownerDocument.createNamespace(a.nodeName),c.setValue(a.value);else if(a.nodeType==DOMNode.TEXT_NODE)c=this.ownerDocument.createTextNode(a.data);else if(a.nodeType==DOMNode.CDATA_SECTION_NODE)c=this.ownerDocument.createCDATASection(a.data);
else if(a.nodeType==DOMNode.PROCESSING_INSTRUCTION_NODE)c=this.ownerDocument.createProcessingInstruction(a.target,a.data);else if(a.nodeType==DOMNode.COMMENT_NODE)c=this.ownerDocument.createComment(a.data);else throw new DOMException(DOMException.NOT_SUPPORTED_ERR);if(b)for(d=0;d<a.childNodes.length;d++)c.appendChild(this.ownerDocument.importNode(a.childNodes.item(d),!0));this.getOwnerDocument()._performingImportNodeOperation=!1;return c}catch(e){throw this.getOwnerDocument()._performingImportNodeOperation=
!1,e;}};DOMNode.prototype.__escapeString=function(a){return __escapeString(a)};DOMNode.prototype.__unescapeString=function(a){return __unescapeString(a)};
DOMDocument=function(a){this._class=addClass(this._class,"DOMDocument");this.DOMNode=DOMNode;this.DOMNode(this);this.doctype=null;this.implementation=a;this.documentElement=null;this.all=[];this.nodeName="#document";this.nodeType=DOMNode.DOCUMENT_NODE;this._lastId=this._id=0;this._parseComplete=!1;this.ownerDocument=this;this._performingImportNodeOperation=!1};DOMDocument.prototype=new DOMNode;DOMDocument.prototype.getDoctype=function(){return this.doctype};
DOMDocument.prototype.getImplementation=function(){return this.implementation};DOMDocument.prototype.getDocumentElement=function(){return this.documentElement};DOMDocument.prototype.createElement=function(a){if(this.ownerDocument.implementation.errorChecking&&!this.ownerDocument.implementation._isValidName(a))throw new DOMException(DOMException.INVALID_CHARACTER_ERR);var b=new DOMElement(this);b.tagName=a;b.nodeName=a;return this.all[this.all.length]=b};
DOMDocument.prototype.createDocumentFragment=function(){return new DOMDocumentFragment(this)};DOMDocument.prototype.createTextNode=function(a){var b=new DOMText(this);b.data=a;b.nodeValue=a;b.length=a.length;return b};DOMDocument.prototype.createComment=function(a){var b=new DOMComment(this);b.data=a;b.nodeValue=a;b.length=a.length;return b};DOMDocument.prototype.createCDATASection=function(a){var b=new DOMCDATASection(this);b.data=a;b.nodeValue=a;b.length=a.length;return b};
DOMDocument.prototype.createProcessingInstruction=function(a,b){if(this.ownerDocument.implementation.errorChecking&&!this.implementation._isValidName(a))throw new DOMException(DOMException.INVALID_CHARACTER_ERR);var c=new DOMProcessingInstruction(this);c.target=a;c.nodeName=a;c.data=b;c.nodeValue=b;c.length=b.length;return c};
DOMDocument.prototype.createAttribute=function(a){if(this.ownerDocument.implementation.errorChecking&&!this.ownerDocument.implementation._isValidName(a))throw new DOMException(DOMException.INVALID_CHARACTER_ERR);var b=new DOMAttr(this);b.name=a;b.nodeName=a;return b};
DOMDocument.prototype.createElementNS=function(a,b){if(this.ownerDocument.implementation.errorChecking){if(!this.ownerDocument._isValidNamespace(a,b))throw new DOMException(DOMException.NAMESPACE_ERR);if(!this.ownerDocument.implementation._isValidName(b))throw new DOMException(DOMException.INVALID_CHARACTER_ERR);}var c=new DOMElement(this),d=this.implementation._parseQName(b);c.nodeName=b;c.namespaceURI=a;c.prefix=d.prefix;c.localName=d.localName;c.tagName=b;return this.all[this.all.length]=c};
DOMDocument.prototype.createAttributeNS=function(a,b){if(this.ownerDocument.implementation.errorChecking){if(!this.ownerDocument._isValidNamespace(a,b,!0))throw new DOMException(DOMException.NAMESPACE_ERR);if(!this.ownerDocument.implementation._isValidName(b))throw new DOMException(DOMException.INVALID_CHARACTER_ERR);}var c=new DOMAttr(this),d=this.implementation._parseQName(b);c.nodeName=b;c.namespaceURI=a;c.prefix=d.prefix;c.localName=d.localName;c.name=b;c.nodeValue="";return c};
DOMDocument.prototype.createNamespace=function(a){var b=new DOMNamespace(this),c=this.implementation._parseQName(a);b.nodeName=a;b.prefix=c.prefix;b.localName=c.localName;b.name=a;b.nodeValue="";return b};DOMDocument.prototype.getElementById=function(a){retNode=null;for(var b=0;b<this.all.length;b++){var c=this.all[b];if(c.id==a&&c._isAncestor(c.ownerDocument.documentElement)){retNode=c;break}}return retNode};DOMDocument.prototype._genId=function(){return this._lastId+=1};
DOMDocument.prototype._isValidNamespace=function(a,b,c){if(!0==this._performingImportNodeOperation)return!0;var d=!0,b=this.implementation._parseQName(b);!0==this._parseComplete&&(-1<b.localName.indexOf(":")&&(d=!1),d&&!c&&(a||(d=!1)),d&&""==b.prefix&&(d=!1));d&&("xml"==b.prefix&&"http://www.w3.org/XML/1998/namespace"!=a)&&(d=!1);return d};DOMDocument.prototype.toString=function(){return""+this.childNodes};
DOMElement=function(a){this._class=addClass(this._class,"DOMElement");this.DOMNode=DOMNode;this.DOMNode(a);this.id=this.tagName="";this.nodeType=DOMNode.ELEMENT_NODE};DOMElement.prototype=new DOMNode;DOMElement.prototype.getTagName=function(){return this.tagName};DOMElement.prototype.getAttribute=function(a){var b="";if(a=this.attributes.getNamedItem(a))b=a.value;return b};
DOMElement.prototype.setAttribute=function(a,b){var c=this.attributes.getNamedItem(a);c||(c=this.ownerDocument.createAttribute(a));b=new String(b);if(this.ownerDocument.implementation.errorChecking){if(c._readonly)throw new DOMException(DOMException.NO_MODIFICATION_ALLOWED_ERR);if(!this.ownerDocument.implementation._isValidString(b))throw new DOMException(DOMException.INVALID_CHARACTER_ERR);}this.ownerDocument.implementation._isIdDeclaration(a)&&(this.id=b);c.value=b;c.nodeValue=b;c.specified=0<b.length?
!0:!1;this.attributes.setNamedItem(c)};DOMElement.prototype.removeAttribute=function(a){return this.attributes.removeNamedItem(a)};DOMElement.prototype.getAttributeNode=function(a){return this.attributes.getNamedItem(a)};DOMElement.prototype.setAttributeNode=function(a){this.ownerDocument.implementation._isIdDeclaration(a.name)&&(this.id=a.value);return this.attributes.setNamedItem(a)};
DOMElement.prototype.removeAttributeNode=function(a){if(this.ownerDocument.implementation.errorChecking&&a._readonly)throw new DOMException(DOMException.NO_MODIFICATION_ALLOWED_ERR);a=this.attributes._findItemIndex(a._id);if(this.ownerDocument.implementation.errorChecking&&0>a)throw new DOMException(DOMException.NOT_FOUND_ERR);return this.attributes._removeChild(a)};DOMElement.prototype.getAttributeNS=function(a,b){var c="",d=this.attributes.getNamedItemNS(a,b);d&&(c=d.value);return c};
DOMElement.prototype.setAttributeNS=function(a,b,c){var d=this.attributes.getNamedItem(a,b);d||(d=this.ownerDocument.createAttributeNS(a,b));c=new String(c);if(this.ownerDocument.implementation.errorChecking){if(d._readonly)throw new DOMException(DOMException.NO_MODIFICATION_ALLOWED_ERR);if(!this.ownerDocument._isValidNamespace(a,b))throw new DOMException(DOMException.NAMESPACE_ERR);if(!this.ownerDocument.implementation._isValidString(c))throw new DOMException(DOMException.INVALID_CHARACTER_ERR);
}this.ownerDocument.implementation._isIdDeclaration(name)&&(this.id=c);d.value=c;d.nodeValue=c;d.specified=0<c.length?!0:!1;this.attributes.setNamedItemNS(d)};DOMElement.prototype.removeAttributeNS=function(a,b){return this.attributes.removeNamedItemNS(a,b)};DOMElement.prototype.getAttributeNodeNS=function(a,b){return this.attributes.getNamedItemNS(a,b)};
DOMElement.prototype.setAttributeNodeNS=function(a){""==a.prefix&&this.ownerDocument.implementation._isIdDeclaration(a.name)&&(this.id=a.value);return this.attributes.setNamedItemNS(a)};DOMElement.prototype.hasAttribute=function(a){return this.attributes._hasAttribute(a)};DOMElement.prototype.hasAttributeNS=function(a,b){return this.attributes._hasAttributeNS(a,b)};
DOMElement.prototype.toString=function(){var a;a=this._namespaces.toString();0<a.length&&(a=" "+a);var b=this.attributes.toString();0<b.length&&(b=" "+b);a=""+("<"+this.nodeName+a+b+">");a+=this.childNodes.toString();return a+="</"+this.nodeName+">"};DOMAttr=function(a){this._class=addClass(this._class,"DOMAttr");this.DOMNode=DOMNode;this.DOMNode(a);this.name="";this.specified=!1;this.value="";this.nodeType=DOMNode.ATTRIBUTE_NODE;this.attributes=this.childNodes=this.ownerElement=null};
DOMAttr.prototype=new DOMNode;DOMAttr.prototype.getName=function(){return this.nodeName};DOMAttr.prototype.getSpecified=function(){return this.specified};DOMAttr.prototype.getValue=function(){return this.nodeValue};DOMAttr.prototype.setValue=function(a){if(this.ownerDocument.implementation.errorChecking&&this._readonly)throw new DOMException(DOMException.NO_MODIFICATION_ALLOWED_ERR);this.setNodeValue(a)};
DOMAttr.prototype.setNodeValue=function(a){this.value=this.nodeValue=new String(a);this.specified=0<this.value.length};DOMAttr.prototype.toString=function(){var a;return a=""+(this.nodeName+'="'+this.__escapeString(this.nodeValue)+'"')};DOMAttr.prototype.getOwnerElement=function(){return this.ownerElement};DOMNamespace=function(a){this._class=addClass(this._class,"DOMNamespace");this.DOMNode=DOMNode;this.DOMNode(a);this.name="";this.specified=!1;this.value="";this.nodeType=DOMNode.NAMESPACE_NODE};
DOMNamespace.prototype=new DOMNode;DOMNamespace.prototype.getValue=function(){return this.nodeValue};DOMNamespace.prototype.setValue=function(a){this.value=this.nodeValue=new String(a)};DOMNamespace.prototype.toString=function(){var a="";return a=""!=this.nodeName?a+(this.nodeName+'="'+this.__escapeString(this.nodeValue)+'"'):a+('xmlns="'+this.__escapeString(this.nodeValue)+'"')};
DOMCharacterData=function(a){this._class=addClass(this._class,"DOMCharacterData");this.DOMNode=DOMNode;this.DOMNode(a);this.data="";this.length=0};DOMCharacterData.prototype=new DOMNode;DOMCharacterData.prototype.getData=function(){return this.nodeValue};DOMCharacterData.prototype.setData=function(a){this.setNodeValue(a)};
DOMCharacterData.prototype.setNodeValue=function(a){if(this.ownerDocument.implementation.errorChecking&&this._readonly)throw new DOMException(DOMException.NO_MODIFICATION_ALLOWED_ERR);this.data=this.nodeValue=new String(a);this.length=this.nodeValue.length};DOMCharacterData.prototype.getLength=function(){return this.nodeValue.length};
DOMCharacterData.prototype.substringData=function(a,b){var c=null;if(this.data){if(this.ownerDocument.implementation.errorChecking&&(0>a||a>this.data.length||0>b))throw new DOMException(DOMException.INDEX_SIZE_ERR);c=b?this.data.substring(a,a+b):this.data.substring(a)}return c};DOMCharacterData.prototype.appendData=function(a){if(this.ownerDocument.implementation.errorChecking&&this._readonly)throw new DOMException(DOMException.NO_MODIFICATION_ALLOWED_ERR);this.setData(""+this.data+a)};
DOMCharacterData.prototype.insertData=function(a,b){if(this.ownerDocument.implementation.errorChecking&&this._readonly)throw new DOMException(DOMException.NO_MODIFICATION_ALLOWED_ERR);if(this.data){if(this.ownerDocument.implementation.errorChecking&&(0>a||a>this.data.length))throw new DOMException(DOMException.INDEX_SIZE_ERR);this.setData(this.data.substring(0,a).concat(b,this.data.substring(a)))}else{if(this.ownerDocument.implementation.errorChecking&&0!=a)throw new DOMException(DOMException.INDEX_SIZE_ERR);
this.setData(b)}};DOMCharacterData.prototype.deleteData=function(a,b){if(this.ownerDocument.implementation.errorChecking&&this._readonly)throw new DOMException(DOMException.NO_MODIFICATION_ALLOWED_ERR);if(this.data){if(this.ownerDocument.implementation.errorChecking&&(0>a||a>this.data.length||0>b))throw new DOMException(DOMException.INDEX_SIZE_ERR);!b||a+b>this.data.length?this.setData(this.data.substring(0,a)):this.setData(this.data.substring(0,a).concat(this.data.substring(a+b)))}};
DOMCharacterData.prototype.replaceData=function(a,b,c){if(this.ownerDocument.implementation.errorChecking&&this._readonly)throw new DOMException(DOMException.NO_MODIFICATION_ALLOWED_ERR);if(this.data){if(this.ownerDocument.implementation.errorChecking&&(0>a||a>this.data.length||0>b))throw new DOMException(DOMException.INDEX_SIZE_ERR);this.setData(this.data.substring(0,a).concat(c,this.data.substring(a+b)))}else this.setData(c)};
DOMText=function(a){this._class=addClass(this._class,"DOMText");this.DOMCharacterData=DOMCharacterData;this.DOMCharacterData(a);this.nodeName="#text";this.nodeType=DOMNode.TEXT_NODE};DOMText.prototype=new DOMCharacterData;
DOMText.prototype.splitText=function(a){var b;if(this.ownerDocument.implementation.errorChecking){if(this._readonly)throw new DOMException(DOMException.NO_MODIFICATION_ALLOWED_ERR);if(0>a||a>this.data.length)throw new DOMException(DOMException.INDEX_SIZE_ERR);}this.parentNode&&(b=this.substringData(a),b=this.ownerDocument.createTextNode(b),this.nextSibling?this.parentNode.insertBefore(b,this.nextSibling):this.parentNode.appendChild(b),this.deleteData(a));return b};
DOMText.prototype.toString=function(){return this.__escapeString(""+this.nodeValue)};DOMCDATASection=function(a){this._class=addClass(this._class,"DOMCDATASection");this.DOMCharacterData=DOMCharacterData;this.DOMCharacterData(a);this.nodeName="#cdata-section";this.nodeType=DOMNode.CDATA_SECTION_NODE};DOMCDATASection.prototype=new DOMCharacterData;
DOMCDATASection.prototype.splitText=function(a){var b;if(this.ownerDocument.implementation.errorChecking){if(this._readonly)throw new DOMException(DOMException.NO_MODIFICATION_ALLOWED_ERR);if(0>a||a>this.data.length)throw new DOMException(DOMException.INDEX_SIZE_ERR);}this.parentNode&&(b=this.substringData(a),b=this.ownerDocument.createCDATASection(b),this.nextSibling?this.parentNode.insertBefore(b,this.nextSibling):this.parentNode.appendChild(b),this.deleteData(a));return b};
DOMCDATASection.prototype.toString=function(){var a;return a=""+("<![CDATA["+this.nodeValue+"]]\>")};DOMComment=function(a){this._class=addClass(this._class,"DOMComment");this.DOMCharacterData=DOMCharacterData;this.DOMCharacterData(a);this.nodeName="#comment";this.nodeType=DOMNode.COMMENT_NODE};DOMComment.prototype=new DOMCharacterData;DOMComment.prototype.toString=function(){var a;return a=""+("<\!--"+this.nodeValue+"--\>")};
DOMProcessingInstruction=function(a){this._class=addClass(this._class,"DOMProcessingInstruction");this.DOMNode=DOMNode;this.DOMNode(a);this.data=this.target="";this.nodeType=DOMNode.PROCESSING_INSTRUCTION_NODE};DOMProcessingInstruction.prototype=new DOMNode;DOMProcessingInstruction.prototype.getTarget=function(){return this.nodeName};DOMProcessingInstruction.prototype.getData=function(){return this.nodeValue};DOMProcessingInstruction.prototype.setData=function(a){this.setNodeValue(a)};
DOMProcessingInstruction.prototype.setNodeValue=function(a){if(this.ownerDocument.implementation.errorChecking&&this._readonly)throw new DOMException(DOMException.NO_MODIFICATION_ALLOWED_ERR);this.data=this.nodeValue=new String(a)};DOMProcessingInstruction.prototype.toString=function(){var a;return a=""+("<?"+this.nodeName+" "+this.nodeValue+" ?>")};
DOMDocumentFragment=function(a){this._class=addClass(this._class,"DOMDocumentFragment");this.DOMNode=DOMNode;this.DOMNode(a);this.nodeName="#document-fragment";this.nodeType=DOMNode.DOCUMENT_FRAGMENT_NODE};DOMDocumentFragment.prototype=new DOMNode;DOMDocumentFragment.prototype.toString=function(){var a="",b=this.getChildNodes().getLength();for(intLoop=0;intLoop<b;intLoop++)a+=this.getChildNodes().item(intLoop).toString();return a};DOMDocumentType=function(){alert("DOMDocumentType.constructor(): Not Implemented")};
DOMEntity=function(){alert("DOMEntity.constructor(): Not Implemented")};DOMEntityReference=function(){alert("DOMEntityReference.constructor(): Not Implemented")};DOMNotation=function(){alert("DOMNotation.constructor(): Not Implemented")};
Strings={WHITESPACE:" \t\n\r",QUOTES:"\"'",isEmpty:function(a){return null===a||0===a.length},indexOfNonWhitespace:function(a,b,c){if(Strings.isEmpty(a))return-1;c=c||a.length;for(b=b||0;b<c;b++)if(-1==Strings.WHITESPACE.indexOf(a.charAt(b)))return b;return-1},lastIndexOfNonWhitespace:function(a,b,c){if(Strings.isEmpty(a))return-1;b=b||0;c=c||a.length;for(c-=1;c>=b;c--)if(-1==Strings.WHITESPACE.indexOf(a.charAt(c)))return c;return-1},indexOfWhitespace:function(a,b,c){if(Strings.isEmpty(a))return-1;
c=c||a.length;for(b=b||0;b<c;b++)if(-1!=Strings.WHITESPACE.indexOf(a.charAt(b)))return b;return-1},replace:function(a,b,c,d,e){if(Strings.isEmpty(a))return"";c=c||a.length;return a.substring(b||0,c).split(d).join(e)},getLineNumber:function(a,b){if(Strings.isEmpty(a))return-1;b=b||a.length;return a.substring(0,b).split("\n").length},getColumnNumber:function(a,b){if(Strings.isEmpty(a))return-1;var b=b||a.length,c=a.substring(0,b).split("\n");c.length--;c=c.join("\n").length;return b-c}};
StringBuffer=function(){this._a=[]};StringBuffer.prototype.append=function(a){this._a[this._a.length]=a};StringBuffer.prototype.toString=function(){return this._a.join("")};draw2d.XMLSerializer=function(){alert("do not init this class. Use the static methods instead")};
draw2d.XMLSerializer.toXML=function(a,b,c){void 0==b&&(b="model");var c=c?c:"",d=draw2d.XMLSerializer.getTypeName(a),e=c+"<"+b+' type="'+d+'">';switch(d){case "int":case "number":case "boolean":e+=a;break;case "string":e+=draw2d.XMLSerializer.xmlEncode(a);break;case "date":e+=a.toLocaleString();break;case "Array":case "array":for(var e=e+"\n",d=c+"   ",f=0;f<a.length;f++)e+=draw2d.XMLSerializer.toXML(a[f],"element",d);e+=c;break;default:if(null!==a){e+="\n";a instanceof draw2d.ArrayList&&a.trimToSize();
a=a.getPersistentAttributes();d=c+"   ";for(f in a)e+=draw2d.XMLSerializer.toXML(a[f],f,d);e+=c}}return e+("</"+b+">\n")};draw2d.XMLSerializer.isSimpleVar=function(a){switch(a){case "int":case "string":case "String":case "Number":case "number":case "Boolean":case "boolean":case "bool":case "dateTime":case "Date":case "date":case "float":return!0}return!1};
draw2d.XMLSerializer.getTypeName=function(a){if(null===a)return"undefined";if(a instanceof Array)return"Array";if(a instanceof Date)return"Date";var b=typeof a;return"number"==b?parseInt(a).toString()==a?"int":"number":draw2d.XMLSerializer.isSimpleVar(b)?b:a.type.replace("@NAMESPACE@","")};draw2d.XMLSerializer.xmlEncode=function(a){a=a.replace(/&/gi,"&#38;#38;");a=a.replace(/"/gi,"&#34;");a=a.replace(/</gi,"&#38;#60;");a=a.replace(/>/gi,"&#62;");return a=a.replace(/'/gi,"&#39;")};
draw2d.Graphics=function(a,b,c){this.jsGraphics=a;this.xt=c.x;this.yt=c.y;this.radian=b*Math.PI/180;this.sinRadian=Math.sin(this.radian);this.cosRadian=Math.cos(this.radian)};draw2d.Graphics.prototype.setStroke=function(a){this.jsGraphics.setStroke(a)};draw2d.Graphics.prototype.drawLine=function(a,b,c,d){this.jsGraphics.drawLine(this.xt+a*this.cosRadian-b*this.sinRadian,this.yt+a*this.sinRadian+b*this.cosRadian,this.xt+c*this.cosRadian-d*this.sinRadian,this.yt+c*this.sinRadian+d*this.cosRadian)};
draw2d.Graphics.prototype.fillRect=function(a,b,c,d){this.jsGraphics.fillPolygon([this.xt+a*this.cosRadian-b*this.sinRadian,this.xt+(a+c)*this.cosRadian-b*this.sinRadian,this.xt+(a+c)*this.cosRadian-(b+d)*this.sinRadian,this.xt+a*this.cosRadian-(b+d)*this.sinRadian],[this.yt+a*this.sinRadian+b*this.cosRadian,this.yt+(a+c)*this.sinRadian+b*this.cosRadian,this.yt+(a+c)*this.sinRadian+(b+d)*this.cosRadian,this.yt+a*this.sinRadian+(b+d)*this.cosRadian])};
draw2d.Graphics.prototype.fillPolygon=function(a,b){for(var c=[],d=[],e=0;e<a.length;e++)c[e]=this.xt+a[e]*this.cosRadian-b[e]*this.sinRadian,d[e]=this.yt+a[e]*this.sinRadian+b[e]*this.cosRadian;this.jsGraphics.fillPolygon(c,d)};draw2d.Graphics.prototype.setColor=function(a){this.jsGraphics.setColor(a.getHTMLStyle())};
draw2d.Graphics.prototype.drawPolygon=function(a,b){for(var c=[],d=[],e=0;e<a.length;e++)c[e]=this.xt+a[e]*this.cosRadian-b[e]*this.sinRadian,d[e]=this.yt+a[e]*this.sinRadian+b[e]*this.cosRadian;this.jsGraphics.drawPolygon(c,d)};draw2d.PropertyChangeEvent=function(a,b,c,d){this.model=a;this.property=b;this.oldValue=c;this.newValue=d};draw2d.PropertyChangeEvent.prototype.type="draw2d.PropertyChangeEvent";String.prototype.trim=function(){return this.replace(RegExp("^([\\s]+)|([\\s]+)$","gm"),"")};
String.prototype.lefttrim=function(){return this.replace(RegExp("^[\\s]+","gm"),"")};String.prototype.righttrim=function(){return this.replace(RegExp("[\\s]+$","gm"),"")};String.prototype.between=function(a,b,c){c||(c=0);c=this.indexOf(a,c);if(-1==c)return null;b=this.indexOf(b,c);return-1==b?null:this.substring(c+a.length,b)};draw2d.GraphicalEditor=function(a){try{this.view=new draw2d.GraphicalViewer(a),this.initializeGraphicalViewer()}catch(b){pushErrorStack(b,"draw2d.GraphicalEditor=function(/*:String*/ id)")}};
draw2d.GraphicalEditor.prototype.type="draw2d.GraphicalEditor";draw2d.GraphicalEditor.prototype.initializeGraphicalViewer=function(){};draw2d.GraphicalEditor.prototype.getGraphicalViewer=function(){return this.view};draw2d.GraphicalEditor.prototype.executeCommand=function(a){this.view.getCommandStack().execute(a)};draw2d.CommandStack=function(){this.undostack=[];this.redostack=[];this.maxundo=50;this.eventListeners=new draw2d.ArrayList};draw2d.CommandStack.PRE_EXECUTE=1;
draw2d.CommandStack.PRE_REDO=2;draw2d.CommandStack.PRE_UNDO=4;draw2d.CommandStack.POST_EXECUTE=8;draw2d.CommandStack.POST_REDO=16;draw2d.CommandStack.POST_UNDO=32;draw2d.CommandStack.POST_MASK=draw2d.CommandStack.POST_EXECUTE|draw2d.CommandStack.POST_UNDO|draw2d.CommandStack.POST_REDO;draw2d.CommandStack.PRE_MASK=draw2d.CommandStack.PRE_EXECUTE|draw2d.CommandStack.PRE_UNDO|draw2d.CommandStack.PRE_REDO;draw2d.CommandStack.prototype.type="draw2d.CommandStack";
draw2d.CommandStack.prototype.setUndoLimit=function(a){this.maxundo=a};draw2d.CommandStack.prototype.markSaveLocation=function(){this.undostack=[];this.redostack=[]};draw2d.CommandStack.prototype.execute=function(a){null!==a&&!1!=a.canExecute()&&(this.notifyListeners(a,draw2d.CommandStack.PRE_EXECUTE),this.undostack.push(a),a.execute(),this.redostack=[],this.undostack.length>this.maxundo&&(this.undostack=this.undostack.slice(this.undostack.length-this.maxundo)),this.notifyListeners(a,draw2d.CommandStack.POST_EXECUTE))};
draw2d.CommandStack.prototype.undo=function(){var a=this.undostack.pop();a&&(this.notifyListeners(a,draw2d.CommandStack.PRE_UNDO),this.redostack.push(a),a.undo(),this.notifyListeners(a,draw2d.CommandStack.POST_UNDO))};draw2d.CommandStack.prototype.redo=function(){var a=this.redostack.pop();a&&(this.notifyListeners(a,draw2d.CommandStack.PRE_REDO),this.undostack.push(a),a.redo(),this.notifyListeners(a,draw2d.CommandStack.POST_REDO))};
draw2d.CommandStack.prototype.getRedoLabel=function(){if(0===this.redostack.lenght)return"";var a=this.redostack[this.redostack.length-1];return a?a.getLabel():""};draw2d.CommandStack.prototype.getUndoLabel=function(){if(0===this.undostack.lenght)return"";var a=this.undostack[this.undostack.length-1];return a?a.getLabel():""};draw2d.CommandStack.prototype.canRedo=function(){return 0<this.redostack.length};draw2d.CommandStack.prototype.canUndo=function(){return 0<this.undostack.length};
draw2d.CommandStack.prototype.addCommandStackEventListener=function(a){if(a instanceof draw2d.CommandStackEventListener)this.eventListeners.add(a);else throw"Object doesn't implement required callback interface [draw2d.CommandStackListener]";};draw2d.CommandStack.prototype.removeCommandStackEventListener=function(a){this.eventListeners.remove(a)};draw2d.CommandStack.prototype.notifyListeners=function(a,b){for(var c=new draw2d.CommandStackEvent(a,b),d=this.eventListeners.getSize(),e=0;e<d;e++)this.eventListeners.get(e).stackChanged(c)};
draw2d.XMLDeserializer=function(){alert("do not init this class. Use the static methods instead")};
draw2d.XMLDeserializer.fromXML=function(a,b){var c=""+a.getAttributes().getNamedItem("type").getNodeValue();a.getNodeValue();switch(c){case "int":try{return parseInt(""+a.getChildNodes().item(0).getNodeValue())}catch(d){alert("Error:"+d+"\nDataType:"+c+"\nXML Node:"+a)}case "string":case "String":try{return 0<a.getChildNodes().getLength()?""+a.getChildNodes().item(0).getNodeValue():""}catch(e){alert("Error:"+e+"\nDataType:"+c+"\nXML Node:"+a)}case "Number":case "number":try{return parseFloat(""+a.getChildNodes().item(0).getNodeValue())}catch(f){alert("Error:"+
f+"\nDataType:"+c+"\nXML Node:"+a)}case "Boolean":case "boolean":case "bool":try{return"true"==(""+a.getChildNodes().item(0).getNodeValue()).toLowerCase()}catch(g){alert("Error:"+g+"\nDataType:"+c+"\nXML Node:"+a)}case "dateTime":case "Date":case "date":try{return new Date(""+a.getChildNodes().item(0).getNodeValue())}catch(h){alert("Error:"+h+"\nDataType:"+c+"\nXML Node:"+a)}case "float":try{return parseFloat(""+a.getChildNodes().item(0).getNodeValue())}catch(i){alert("Error:"+i+"\nDataType:"+c+"\nXML Node:"+
a)}}c=c.replace("@NAMESPACE@","");c=eval("new "+c+"()");void 0!=b&&void 0!=c.setModelParent&&c.setModelParent(b);for(var k=a.getChildNodes(),j=0;j<k.length;j++){var m=k.item(j),l=m.getNodeName();c instanceof Array&&(l=j);c[l]=draw2d.XMLDeserializer.fromXML(m,c instanceof draw2d.AbstractObjectModel?c:b)}return c};draw2d.Color=function(a,b,c){"undefined"==typeof b?(a=this.hex2rgb(a),this.red=a[0],this.green=a[1],this.blue=a[2]):(this.red=a,this.green=b,this.blue=c)};draw2d.Color.prototype.type="draw2d.Color";
draw2d.Color.prototype.getHTMLStyle=function(){return"rgb("+this.red+","+this.green+","+this.blue+")"};draw2d.Color.prototype.getRed=function(){return this.red};draw2d.Color.prototype.getGreen=function(){return this.green};draw2d.Color.prototype.getBlue=function(){return this.blue};draw2d.Color.prototype.getIdealTextColor=function(){return 105>255-(0.299*this.red+0.587*this.green+0.114*this.blue)?new draw2d.Color(0,0,0):new draw2d.Color(255,255,255)};
draw2d.Color.prototype.hex2rgb=function(a){a=a.replace("#","");return{"0":parseInt(a.substr(0,2),16),1:parseInt(a.substr(2,2),16),2:parseInt(a.substr(4,2),16)}};draw2d.Color.prototype.hex=function(){return this.int2hex(this.red)+this.int2hex(this.green)+this.int2hex(this.blue)};draw2d.Color.prototype.int2hex=function(a){a=Math.round(Math.min(Math.max(0,a),255));return"0123456789ABCDEF".charAt((a-a%16)/16)+"0123456789ABCDEF".charAt(a%16)};
draw2d.Color.prototype.darker=function(a){var b=parseInt(Math.round(this.getRed()*(1-a))),c=parseInt(Math.round(this.getGreen()*(1-a))),a=parseInt(Math.round(this.getBlue()*(1-a)));0>b?b=0:255<b&&(b=255);0>c?c=0:255<c&&(c=255);0>a?a=0:255<a&&(a=255);return new draw2d.Color(b,c,a)};
draw2d.Color.prototype.lighter=function(a){var b=parseInt(Math.round(this.getRed()*(1+a))),c=parseInt(Math.round(this.getGreen()*(1+a))),a=parseInt(Math.round(this.getBlue()*(1+a)));0>b?b=0:255<b&&(b=255);0>c?c=0:255<c&&(c=255);0>a?a=0:255<a&&(a=255);return new draw2d.Color(b,c,a)};var whitespace="\n\r\t ";XMLP=function(a){a=SAXStrings.replace(a,null,null,"\r\n","\n");this.m_xml=a=SAXStrings.replace(a,null,null,"\r","\n");this.m_iP=0;this.m_iState=XMLP._STATE_PROLOG;this.m_stack=new Stack;this._clearAttributes()};
XMLP._NONE=0;XMLP._ELM_B=1;XMLP._ELM_E=2;XMLP._ELM_EMP=3;XMLP._ATT=4;XMLP._TEXT=5;XMLP._ENTITY=6;XMLP._PI=7;XMLP._CDATA=8;XMLP._COMMENT=9;XMLP._DTD=10;XMLP._ERROR=11;XMLP._CONT_XML=0;XMLP._CONT_ALT=1;XMLP._ATT_NAME=0;XMLP._ATT_VAL=1;XMLP._STATE_PROLOG=1;XMLP._STATE_DOCUMENT=2;XMLP._STATE_MISC=3;XMLP._errs=[];XMLP._errs[XMLP.ERR_CLOSE_PI=0]="PI: missing closing sequence";XMLP._errs[XMLP.ERR_CLOSE_DTD=1]="DTD: missing closing sequence";XMLP._errs[XMLP.ERR_CLOSE_COMMENT=2]="Comment: missing closing sequence";
XMLP._errs[XMLP.ERR_CLOSE_CDATA=3]="CDATA: missing closing sequence";XMLP._errs[XMLP.ERR_CLOSE_ELM=4]="Element: missing closing sequence";XMLP._errs[XMLP.ERR_CLOSE_ENTITY=5]="Entity: missing closing sequence";XMLP._errs[XMLP.ERR_PI_TARGET=6]="PI: target is required";XMLP._errs[XMLP.ERR_ELM_EMPTY=7]="Element: cannot be both empty and closing";XMLP._errs[XMLP.ERR_ELM_NAME=8]='Element: name must immediatly follow "<"';XMLP._errs[XMLP.ERR_ELM_LT_NAME=9]='Element: "<" not allowed in element names';
XMLP._errs[XMLP.ERR_ATT_VALUES=10]="Attribute: values are required and must be in quotes";XMLP._errs[XMLP.ERR_ATT_LT_NAME=11]='Element: "<" not allowed in attribute names';XMLP._errs[XMLP.ERR_ATT_LT_VALUE=12]='Attribute: "<" not allowed in attribute values';XMLP._errs[XMLP.ERR_ATT_DUP=13]="Attribute: duplicate attributes not allowed";XMLP._errs[XMLP.ERR_ENTITY_UNKNOWN=14]="Entity: unknown entity";XMLP._errs[XMLP.ERR_INFINITELOOP=15]="Infininte loop";XMLP._errs[XMLP.ERR_DOC_STRUCTURE=16]="Document: only comments, processing instructions, or whitespace allowed outside of document element";
XMLP._errs[XMLP.ERR_ELM_NESTING=17]="Element: must be nested correctly";XMLP.prototype._addAttribute=function(a,b){this.m_atts[this.m_atts.length]=[a,b]};
XMLP.prototype._checkStructure=function(a){if(XMLP._STATE_PROLOG==this.m_iState){if((XMLP._TEXT==a||XMLP._ENTITY==a)&&-1!=SAXStrings.indexOfNonWhitespace(this.getContent(),this.getContentBegin(),this.getContentEnd()))return this._setErr(XMLP.ERR_DOC_STRUCTURE);if(XMLP._ELM_B==a||XMLP._ELM_EMP==a)this.m_iState=XMLP._STATE_DOCUMENT}if(XMLP._STATE_DOCUMENT==this.m_iState){(XMLP._ELM_B==a||XMLP._ELM_EMP==a)&&this.m_stack.push(this.getName());if(XMLP._ELM_E==a||XMLP._ELM_EMP==a){var b=this.m_stack.pop();
if(null===b||b!=this.getName())return this._setErr(XMLP.ERR_ELM_NESTING)}if(0===this.m_stack.count())return this.m_iState=XMLP._STATE_MISC,a}return XMLP._STATE_MISC==this.m_iState&&(XMLP._ELM_B==a||(XMLP._ELM_E==a||XMLP._ELM_EMP==a||XMLP.EVT_DTD==a)||(XMLP._TEXT==a||XMLP._ENTITY==a)&&-1!=SAXStrings.indexOfNonWhitespace(this.getContent(),this.getContentBegin(),this.getContentEnd()))?this._setErr(XMLP.ERR_DOC_STRUCTURE):a};XMLP.prototype._clearAttributes=function(){this.m_atts=[]};
XMLP.prototype._findAttributeIndex=function(a){for(var b=0;b<this.m_atts.length;b++)if(this.m_atts[b][XMLP._ATT_NAME]==a)return b;return-1};XMLP.prototype.getAttributeCount=function(){return this.m_atts?this.m_atts.length:0};XMLP.prototype.getAttributeName=function(a){return 0>a||a>=this.m_atts.length?null:this.m_atts[a][XMLP._ATT_NAME]};XMLP.prototype.getAttributeValue=function(a){return 0>a||a>=this.m_atts.length?null:__unescapeString(this.m_atts[a][XMLP._ATT_VAL])};
XMLP.prototype.getAttributeValueByName=function(a){return this.getAttributeValue(this._findAttributeIndex(a))};XMLP.prototype.getColumnNumber=function(){return SAXStrings.getColumnNumber(this.m_xml,this.m_iP)};XMLP.prototype.getContent=function(){return this.m_cSrc==XMLP._CONT_XML?this.m_xml:this.m_cAlt};XMLP.prototype.getContentBegin=function(){return this.m_cB};XMLP.prototype.getContentEnd=function(){return this.m_cE};
XMLP.prototype.getLineNumber=function(){return SAXStrings.getLineNumber(this.m_xml,this.m_iP)};XMLP.prototype.getName=function(){return this.m_name};XMLP.prototype.next=function(){return this._checkStructure(this._parse())};
XMLP.prototype._parse=function(){return this.m_iP==this.m_xml.length?XMLP._NONE:this.m_iP==this.m_xml.indexOf("<?",this.m_iP)?this._parsePI(this.m_iP+2):this.m_iP==this.m_xml.indexOf("<!DOCTYPE",this.m_iP)?this._parseDTD(this.m_iP+9):this.m_iP==this.m_xml.indexOf("<\!--",this.m_iP)?this._parseComment(this.m_iP+4):this.m_iP==this.m_xml.indexOf("<![CDATA[",this.m_iP)?this._parseCDATA(this.m_iP+9):this.m_iP==this.m_xml.indexOf("<",this.m_iP)?this._parseElement(this.m_iP+1):this.m_iP==this.m_xml.indexOf("&",
this.m_iP)?this._parseEntity(this.m_iP+1):this._parseText(this.m_iP)};
XMLP.prototype._parseAttribute=function(a,b){var c,d,e,f;this.m_cAlt="";c=SAXStrings.indexOfNonWhitespace(this.m_xml,a,b);if(-1==c||c>=b)return c;e=this.m_xml.indexOf("=",c);if(-1==e||e>b)return this._setErr(XMLP.ERR_ATT_VALUES);d=SAXStrings.lastIndexOfNonWhitespace(this.m_xml,c,e);e=SAXStrings.indexOfNonWhitespace(this.m_xml,e+1,b);if(-1==e||e>b)return this._setErr(XMLP.ERR_ATT_VALUES);f=this.m_xml.charAt(e);if(-1==SAXStrings.QUOTES.indexOf(f))return this._setErr(XMLP.ERR_ATT_VALUES);f=this.m_xml.indexOf(f,
e+1);if(-1==f||f>b)return this._setErr(XMLP.ERR_ATT_VALUES);c=this.m_xml.substring(c,d+1);d=this.m_xml.substring(e+1,f);if(-1!=c.indexOf("<"))return this._setErr(XMLP.ERR_ATT_LT_NAME);if(-1!=d.indexOf("<"))return this._setErr(XMLP.ERR_ATT_LT_VALUE);d=SAXStrings.replace(d,null,null,"\n"," ");d=SAXStrings.replace(d,null,null,"\t"," ");iRet=this._replaceEntities(d);if(iRet==XMLP._ERROR)return iRet;d=this.m_cAlt;if(-1==this._findAttributeIndex(c))this._addAttribute(c,d);else return this._setErr(XMLP.ERR_ATT_DUP);
this.m_iP=f+2;return XMLP._ATT};XMLP.prototype._parseCDATA=function(a){var b=this.m_xml.indexOf("]]\>",a);if(-1==b)return this._setErr(XMLP.ERR_CLOSE_CDATA);this._setContent(XMLP._CONT_XML,a,b);this.m_iP=b+3;return XMLP._CDATA};XMLP.prototype._parseComment=function(a){var b=this.m_xml.indexOf("--\>",a);if(-1==b)return this._setErr(XMLP.ERR_CLOSE_COMMENT);this._setContent(XMLP._CONT_XML,a,b);this.m_iP=b+3;return XMLP._COMMENT};
XMLP.prototype._parseDTD=function(a){var b,c,d;b=this.m_xml.indexOf(">",a);if(-1==b)return this._setErr(XMLP.ERR_CLOSE_DTD);c=this.m_xml.indexOf("[",a);for(c=-1!=c&&c<b?"]>":">";;){if(b==d)return this._setErr(XMLP.ERR_INFINITELOOP);d=b;b=this.m_xml.indexOf(c,a);if(-1==b)return this._setErr(XMLP.ERR_CLOSE_DTD);if("]]\>"!=this.m_xml.substring(b-1,b+2))break}this.m_iP=b+c.length;return XMLP._DTD};
XMLP.prototype._parseElement=function(a){var b,c,d,e,f,g;c=b=this.m_xml.indexOf(">",a);if(-1==b)return this._setErr(XMLP.ERR_CLOSE_ELM);"/"==this.m_xml.charAt(a)?(f=XMLP._ELM_E,a++):f=XMLP._ELM_B;if("/"==this.m_xml.charAt(b-1)){if(f==XMLP._ELM_E)return this._setErr(XMLP.ERR_ELM_EMPTY);f=XMLP._ELM_EMP;c--}c=SAXStrings.lastIndexOfNonWhitespace(this.m_xml,a,c);if(1!=b-a&&SAXStrings.indexOfNonWhitespace(this.m_xml,a,c)!=a)return this._setErr(XMLP.ERR_ELM_NAME);this._clearAttributes();d=SAXStrings.indexOfWhitespace(this.m_xml,
a,c);if(-1==d)d=c+1;else for(this.m_iP=d;this.m_iP<c;){if(this.m_iP==g)return this._setErr(XMLP.ERR_INFINITELOOP);g=this.m_iP;e=this._parseAttribute(this.m_iP,c);if(e==XMLP._ERROR)return e}a=this.m_xml.substring(a,d);if(-1!=a.indexOf("<"))return this._setErr(XMLP.ERR_ELM_LT_NAME);this.m_name=a;this.m_iP=b+1;return f};XMLP.prototype._parseEntity=function(a){var b=this.m_xml.indexOf(";",a);if(-1==b)return this._setErr(XMLP.ERR_CLOSE_ENTITY);this.m_iP=b+1;return this._replaceEntity(this.m_xml,a,b)};
XMLP.prototype._parsePI=function(a){var b,c,d,e;b=this.m_xml.indexOf("?>",a);if(-1==b)return this._setErr(XMLP.ERR_CLOSE_PI);a=SAXStrings.indexOfNonWhitespace(this.m_xml,a,b);if(-1==a)return this._setErr(XMLP.ERR_PI_TARGET);c=SAXStrings.indexOfWhitespace(this.m_xml,a,b);-1==c&&(c=b);d=SAXStrings.indexOfNonWhitespace(this.m_xml,c,b);-1==d&&(d=b);e=SAXStrings.lastIndexOfNonWhitespace(this.m_xml,d,b);-1==e&&(e=b-1);this.m_name=this.m_xml.substring(a,c);this._setContent(XMLP._CONT_XML,d,e+1);this.m_iP=
b+2;return XMLP._PI};XMLP.prototype._parseText=function(a){var b,c;b=this.m_xml.indexOf("<",a);-1==b&&(b=this.m_xml.length);c=this.m_xml.indexOf("&",a);-1!=c&&c<=b&&(b=c);this._setContent(XMLP._CONT_XML,a,b);this.m_iP=b;return XMLP._TEXT};
XMLP.prototype._replaceEntities=function(a,b,c){if(SAXStrings.isEmpty(a))return"";var b=b||0,c=c||a.length,d,e="";for(d=a.indexOf("&",b);0<d&&d<c;){e+=a.substring(b,d);b=a.indexOf(";",d)+1;if(0===b||b>c)return this._setErr(XMLP.ERR_CLOSE_ENTITY);iRet=this._replaceEntity(a,d+1,b-1);if(iRet==XMLP._ERROR)return iRet;e+=this.m_cAlt;d=a.indexOf("&",b)}b!=c&&(e+=a.substring(b,c));this._setContent(XMLP._CONT_ALT,e);return XMLP._ENTITY};
XMLP.prototype._replaceEntity=function(a,b,c){if(SAXStrings.isEmpty(a))return-1;b=b||0;c=c||a.length;switch(a.substring(b,c)){case "amp":strEnt="&";break;case "lt":strEnt="<";break;case "gt":strEnt=">";break;case "apos":strEnt="'";break;case "quot":strEnt='"';break;default:if("#"==a.charAt(b))strEnt=String.fromCharCode(parseInt(a.substring(b+1,c)));else return this._setErr(XMLP.ERR_ENTITY_UNKNOWN)}this._setContent(XMLP._CONT_ALT,strEnt);return XMLP._ENTITY};
XMLP.prototype._setContent=function(a){var b=arguments;XMLP._CONT_XML==a?(this.m_cAlt=null,this.m_cB=b[1],this.m_cE=b[2]):(this.m_cAlt=b[1],this.m_cB=0,this.m_cE=b[1].length);this.m_cSrc=a};XMLP.prototype._setErr=function(a){this.m_cAlt=a=XMLP._errs[a];this.m_cB=0;this.m_cE=a.length;this.m_cSrc=XMLP._CONT_ALT;return XMLP._ERROR};SAXDriver=function(){this.m_hndLex=this.m_hndErr=this.m_hndDoc=null};SAXDriver.DOC_B=1;SAXDriver.DOC_E=2;SAXDriver.ELM_B=3;SAXDriver.ELM_E=4;SAXDriver.CHARS=5;
SAXDriver.PI=6;SAXDriver.CD_B=7;SAXDriver.CD_E=8;SAXDriver.CMNT=9;SAXDriver.DTD_B=10;SAXDriver.DTD_E=11;SAXDriver.prototype.parse=function(a){a=new XMLP(a);this.m_hndDoc&&this.m_hndDoc.setDocumentLocator&&this.m_hndDoc.setDocumentLocator(this);this.m_parser=a;(this.m_bErr=!1)||this._fireEvent(SAXDriver.DOC_B);this._parseLoop();this.m_bErr||this._fireEvent(SAXDriver.DOC_E);this.m_xml=null;this.m_iP=0};SAXDriver.prototype.setDocumentHandler=function(a){this.m_hndDoc=a};
SAXDriver.prototype.setErrorHandler=function(a){this.m_hndErr=a};SAXDriver.prototype.setLexicalHandler=function(a){this.m_hndLex=a};SAXDriver.prototype.getColumnNumber=function(){return this.m_parser.getColumnNumber()};SAXDriver.prototype.getLineNumber=function(){return this.m_parser.getLineNumber()};SAXDriver.prototype.getMessage=function(){return this.m_strErrMsg};SAXDriver.prototype.getPublicId=function(){return null};SAXDriver.prototype.getSystemId=function(){return null};
SAXDriver.prototype.getLength=function(){return this.m_parser.getAttributeCount()};SAXDriver.prototype.getName=function(a){return this.m_parser.getAttributeName(a)};SAXDriver.prototype.getValue=function(a){return this.m_parser.getAttributeValue(a)};SAXDriver.prototype.getValueByName=function(a){return this.m_parser.getAttributeValueByName(a)};SAXDriver.prototype._fireError=function(a){this.m_strErrMsg=a;this.m_bErr=!0;this.m_hndErr&&this.m_hndErr.fatalError&&this.m_hndErr.fatalError(this)};
SAXDriver.prototype._fireEvent=function(a){var b,c,d=arguments,e=d.length-1;if(!this.m_bErr&&(SAXDriver.DOC_B==a?(c="startDocument",b=this.m_hndDoc):SAXDriver.DOC_E==a?(c="endDocument",b=this.m_hndDoc):SAXDriver.ELM_B==a?(c="startElement",b=this.m_hndDoc):SAXDriver.ELM_E==a?(c="endElement",b=this.m_hndDoc):SAXDriver.CHARS==a?(c="characters",b=this.m_hndDoc):SAXDriver.PI==a?(c="processingInstruction",b=this.m_hndDoc):SAXDriver.CD_B==a?(c="startCDATA",b=this.m_hndLex):SAXDriver.CD_E==a?(c="endCDATA",
b=this.m_hndLex):SAXDriver.CMNT==a&&(c="comment",b=this.m_hndLex),b&&b[c]))if(0==e)b[c]();else if(1==e)b[c](d[1]);else if(2==e)b[c](d[1],d[2]);else if(3==e)b[c](d[1],d[2],d[3])};
SAXDriver.prototype._parseLoop=function(a){for(var b,a=this.m_parser;!this.m_bErr;)if(b=a.next(),b==XMLP._ELM_B)this._fireEvent(SAXDriver.ELM_B,a.getName(),this);else if(b==XMLP._ELM_E)this._fireEvent(SAXDriver.ELM_E,a.getName());else if(b==XMLP._ELM_EMP)this._fireEvent(SAXDriver.ELM_B,a.getName(),this),this._fireEvent(SAXDriver.ELM_E,a.getName());else if(b==XMLP._TEXT)this._fireEvent(SAXDriver.CHARS,a.getContent(),a.getContentBegin(),a.getContentEnd()-a.getContentBegin());else if(b==XMLP._ENTITY)this._fireEvent(SAXDriver.CHARS,
a.getContent(),a.getContentBegin(),a.getContentEnd()-a.getContentBegin());else if(b==XMLP._PI)this._fireEvent(SAXDriver.PI,a.getName(),a.getContent().substring(a.getContentBegin(),a.getContentEnd()));else if(b==XMLP._CDATA)this._fireEvent(SAXDriver.CD_B),this._fireEvent(SAXDriver.CHARS,a.getContent(),a.getContentBegin(),a.getContentEnd()-a.getContentBegin()),this._fireEvent(SAXDriver.CD_E);else if(b==XMLP._COMMENT)this._fireEvent(SAXDriver.CMNT,a.getContent(),a.getContentBegin(),a.getContentEnd()-
a.getContentBegin());else if(b!=XMLP._DTD)if(b==XMLP._ERROR)this._fireError(a.getContent());else if(b==XMLP._NONE)break};SAXStrings=function(){};SAXStrings.WHITESPACE=" \t\n\r";SAXStrings.QUOTES="\"'";SAXStrings.getColumnNumber=function(a,b){if(SAXStrings.isEmpty(a))return-1;var b=b||a.length,c=a.substring(0,b).split("\n");c.length--;c=c.join("\n").length;return b-c};SAXStrings.getLineNumber=function(a,b){if(SAXStrings.isEmpty(a))return-1;b=b||a.length;return a.substring(0,b).split("\n").length};
SAXStrings.indexOfNonWhitespace=function(a,b,c){if(SAXStrings.isEmpty(a))return-1;c=c||a.length;for(b=b||0;b<c;b++)if(-1==SAXStrings.WHITESPACE.indexOf(a.charAt(b)))return b;return-1};SAXStrings.indexOfWhitespace=function(a,b,c){if(SAXStrings.isEmpty(a))return-1;c=c||a.length;for(b=b||0;b<c;b++)if(-1!=SAXStrings.WHITESPACE.indexOf(a.charAt(b)))return b;return-1};SAXStrings.isEmpty=function(a){return null===a||0===a.length};
SAXStrings.lastIndexOfNonWhitespace=function(a,b,c){if(SAXStrings.isEmpty(a))return-1;b=b||0;c=c||a.length;for(c-=1;c>=b;c--)if(-1==SAXStrings.WHITESPACE.indexOf(a.charAt(c)))return c;return-1};SAXStrings.replace=function(a,b,c,d,e){if(SAXStrings.isEmpty(a))return"";c=c||a.length;return a.substring(b||0,c).split(d).join(e)};Stack=function(){this.m_arr=[]};Stack.prototype.clear=function(){this.m_arr=[]};Stack.prototype.count=function(){return this.m_arr.length};
Stack.prototype.destroy=function(){this.m_arr=null};Stack.prototype.peek=function(){return 0===this.m_arr.length?null:this.m_arr[this.m_arr.length-1]};Stack.prototype.pop=function(){if(0===this.m_arr.length)return null;var a=this.m_arr[this.m_arr.length-1];this.m_arr.length--;return a};Stack.prototype.push=function(a){this.m_arr[this.m_arr.length]=a};function isEmpty(a){return null===a||0==a.length}
function trim(a,b,c){if(isEmpty(a))return"";null===b&&(b=!0);null===c&&(c=!0);var d=0,e=0,f=0,g=0;if(!0==b)for(;f<a.length&&-1!=whitespace.indexOf(a.charAt(f++));)d++;if(!0==c)for(g=a.length-1;g>=d&&-1!=whitespace.indexOf(a.charAt(g--));)e++;return a.substring(d,a.length-e)}function __escapeString(a){a=a.replace(/&/g,"&amp;");a=a.replace(/</g,"&lt;");a=a.replace(/>/g,"&gt;");a=a.replace(/"/g,"&quot;");return a=a.replace(/'/g,"&apos;")}
function __unescapeString(a){a=a.replace(/&amp;/g,"&");a=a.replace(/&lt;/g,"<");a=a.replace(/&gt;/g,">");a=a.replace(/&quot;/g,'"');return a=a.replace(/&apos;/g,"'")}draw2d.ArrayList=function(){this.increment=10;this.size=0;this.data=Array(this.increment)};draw2d.ArrayList.EMPTY_LIST=new draw2d.ArrayList;draw2d.ArrayList.prototype.type="draw2d.ArrayList";draw2d.ArrayList.prototype.reverse=function(){for(var a=Array(this.size),b=0;b<this.size;b++)a[b]=this.data[this.size-b-1];this.data=a};
draw2d.ArrayList.prototype.getCapacity=function(){return this.data.length};draw2d.ArrayList.prototype.getSize=function(){return this.size};draw2d.ArrayList.prototype.isEmpty=function(){return 0===this.getSize()};draw2d.ArrayList.prototype.getLastElement=function(){if(null!==this.data[this.getSize()-1])return this.data[this.getSize()-1]};draw2d.ArrayList.prototype.asArray=function(){this.trimToSize();return this.data};
draw2d.ArrayList.prototype.getFirstElement=function(){return null!==this.data[0]&&void 0!==this.data[0]?this.data[0]:null};draw2d.ArrayList.prototype.get=function(a){return this.data[a]};draw2d.ArrayList.prototype.add=function(a){this.getSize()==this.data.length&&this.resize();this.data[this.size++]=a};draw2d.ArrayList.prototype.addAll=function(a){for(var b=0;b<a.getSize();b++)this.add(a.get(b))};draw2d.ArrayList.prototype.remove=function(a){a=this.indexOf(a);return 0<=a?this.removeElementAt(a):null};
draw2d.ArrayList.prototype.insertElementAt=function(a,b){this.size==this.capacity&&this.resize();for(var c=this.getSize();c>b;c--)this.data[c]=this.data[c-1];this.data[b]=a;this.size++};draw2d.ArrayList.prototype.removeElementAt=function(a){for(var b=this.data[a];a<this.getSize()-1;a++)this.data[a]=this.data[a+1];this.data[this.getSize()-1]=null;this.size--;return b};draw2d.ArrayList.prototype.removeAllElements=function(){for(var a=this.size=0;a<this.data.length;a++)this.data[a]=null};
draw2d.ArrayList.prototype.indexOf=function(a){for(var b=0;b<this.getSize();b++)if(this.data[b]==a)return b;return-1};draw2d.ArrayList.prototype.contains=function(a){for(var b=0;b<this.getSize();b++)if(this.data[b]==a)return!0;return!1};draw2d.ArrayList.prototype.resize=function(){newData=Array(this.data.length+this.increment);for(var a=0;a<this.data.length;a++)newData[a]=this.data[a];this.data=newData};
draw2d.ArrayList.prototype.trimToSize=function(){if(this.data.length!=this.size){for(var a=Array(this.getSize()),b=0;b<this.getSize();b++)a[b]=this.data[b];this.size=a.length;this.data=a}};draw2d.ArrayList.prototype.sort=function(a){var b,c,d,e,f;for(b=1;b<this.getSize();b++){e=this.data[b];d=e[a];c=b-1;f=this.data[c];for(f=f[a];0<=c&&f>d;)this.data[c+1]=this.data[c],c--,0<=c&&(f=this.data[c],f=f[a]);this.data[c+1]=e}};
draw2d.ArrayList.prototype.clone=function(){for(var a=new draw2d.ArrayList(this.size),b=0;b<this.size;b++)a.add(this.data[b]);return a};draw2d.ArrayList.prototype.overwriteElementAt=function(a,b){this.data[b]=a};draw2d.ArrayList.prototype.getPersistentAttributes=function(){return{data:this.data,increment:this.increment,size:this.getSize()}};draw2d.EditPartFactory=function(){};draw2d.EditPartFactory.prototype.type="draw2d.EditPartFactory";draw2d.EditPartFactory.prototype.createEditPart=function(){};
var _errorStack_=[];function pushErrorStack(a,b){_errorStack_.push(b+"\n");throw a;}draw2d.AbstractEvent=function(){this.relatedTarget=this.target=this.type=null;this.cancelable=!1;this.timeStamp=null;this.returnValue=!0};draw2d.AbstractEvent.prototype.initEvent=function(a,b){this.type=a;this.cancelable=b;this.timeStamp=(new Date).getTime()};draw2d.AbstractEvent.prototype.preventDefault=function(){this.cancelable&&(this.returnValue=!1)};
draw2d.AbstractEvent.fireDOMEvent=function(a,b){if(document.createEvent){var c=document.createEvent("Events");c.initEvent(a,!0,!0);b.dispatchEvent(c)}else document.createEventObject&&(c=document.createEventObject(),b.fireEvent("on"+a,c))};draw2d.EventTarget=function(){this.eventhandlers={}};draw2d.EventTarget.prototype.addEventListener=function(a,b){"undefined"==typeof this.eventhandlers[a]&&(this.eventhandlers[a]=[]);this.eventhandlers[a][this.eventhandlers[a].length]=b};
draw2d.EventTarget.prototype.dispatchEvent=function(a){a.target=this;if("undefined"!=typeof this.eventhandlers[a.type])for(var b=0;b<this.eventhandlers[a.type].length;b++)this.eventhandlers[a.type][b](a);return a.returnValue};draw2d.EventTarget.prototype.removeEventListener=function(a,b){if("undefined"!=typeof this.eventhandlers[a]){for(var c=[],d=0;d<this.eventhandlers[a].length;d++)this.eventhandlers[a][d]!=b&&(c[c.length]=this.eventhandlers[a][d]);this.eventhandlers[a]=c}};draw2d.Drag=function(){};
draw2d.Drag.current=null;draw2d.Drag.currentTarget=null;draw2d.Drag.currentHover=null;draw2d.Drag.currentCompartment=null;draw2d.Drag.dragging=!1;draw2d.Drag.isDragging=function(){return this.dragging};draw2d.Drag.setCurrent=function(a){this.current=a;this.dragging=!0};draw2d.Drag.getCurrent=function(){return this.current};draw2d.Drag.clearCurrent=function(){this.current=null;this.dragging=!1;this.currentTarget=null};
draw2d.Draggable=function(a,b){this.id=draw2d.UUID.create();this.node=null;draw2d.EventTarget.call(this);this.construct(a,b);this.diffY=this.diffX=0;this.targets=new draw2d.ArrayList};draw2d.Draggable.prototype=new draw2d.EventTarget;
draw2d.Draggable.prototype.construct=function(a){if(!(null===a||void 0===a)){this.element=a;var b=this,a=function(a){var c=new draw2d.DragDropEvent;c.initDragDropEvent("dblclick",!0);b.dispatchEvent(c);a=a||window.event;a.cancelBubble=!0;a.returnValue=!1},c=function(a){var a=a||window.event,c=new draw2d.DragDropEvent;if(null!==b.node){var d=b.node.getWorkflow().getAbsoluteX(),h=b.node.getWorkflow().getAbsoluteY(),i=b.node.getWorkflow().getScrollLeft(),k=b.node.getWorkflow().getScrollTop();c.x=a.clientX-
b.element.offsetLeft+i-d;c.y=a.clientY-b.element.offsetTop+k-h}2===a.button?(c.initDragDropEvent("contextmenu",!0),b.dispatchEvent(c)):(c.initDragDropEvent("dragstart",!0),b.dispatchEvent(c)&&(b.diffX=a.clientX-b.element.offsetLeft,b.diffY=a.clientY-b.element.offsetTop,draw2d.Drag.setCurrent(b),!0==b.isAttached&&b.detachEventHandlers(),b.attachEventHandlers()));a.cancelBubble=!0;a.returnValue=!1},d=function(){if(null===draw2d.Drag.getCurrent()){if(null!==draw2d.Drag.currentHover&&b!==draw2d.Drag.currentHover){var a=
new draw2d.DragDropEvent;a.initDragDropEvent("mouseleave",!1,b);draw2d.Drag.currentHover.dispatchEvent(a)}null!==b&&b!==draw2d.Drag.currentHover&&(a=new draw2d.DragDropEvent,a.initDragDropEvent("mouseenter",!1,b),b.dispatchEvent(a));draw2d.Drag.currentHover=b}};if(this.element.addEventListener)this.element.addEventListener("mousemove",d,!1),this.element.addEventListener("mousedown",c,!1),this.element.addEventListener("dblclick",a,!1);else if(this.element.attachEvent)this.element.attachEvent("onmousemove",
d),this.element.attachEvent("onmousedown",c),this.element.attachEvent("ondblclick",a);else throw"Drag not supported in this browser.";}};draw2d.Draggable.prototype.onDrop=function(){};
draw2d.Draggable.prototype.attachEventHandlers=function(){var a=this;a.isAttached=!0;this.tempMouseMove=function(b){var c=b||window.event,b=new draw2d.Point(c.clientX-a.diffX,c.clientY-a.diffY);null!==a.node&&a.node.getCanSnapToHelper()&&(b=a.node.getWorkflow().snapToHelper(a.node,b));a.element.style.left=b.x+"px";a.element.style.top=b.y+"px";if(null!==a.node){var d=a.node.getWorkflow().getScrollLeft(),e=a.node.getWorkflow().getScrollTop(),f=a.node.getWorkflow().getAbsoluteX(),g=a.node.getWorkflow().getAbsoluteY(),
b=a.getDropTarget(c.clientX+d-f,c.clientY+e-g),c=a.getCompartment(c.clientX+d-f,c.clientY+e-g);null!==draw2d.Drag.currentTarget&&b!=draw2d.Drag.currentTarget&&(d=new draw2d.DragDropEvent,d.initDragDropEvent("dragleave",!1,a),draw2d.Drag.currentTarget.dispatchEvent(d));null!==b&&b!==draw2d.Drag.currentTarget&&(d=new draw2d.DragDropEvent,d.initDragDropEvent("dragenter",!1,a),b.dispatchEvent(d));draw2d.Drag.currentTarget=b;null!==draw2d.Drag.currentCompartment&&c!==draw2d.Drag.currentCompartment&&(d=
new draw2d.DragDropEvent,d.initDragDropEvent("figureleave",!1,a),draw2d.Drag.currentCompartment.dispatchEvent(d));null!==c&&(c.node!=a.node&&c!==draw2d.Drag.currentCompartment)&&(d=new draw2d.DragDropEvent,d.initDragDropEvent("figureenter",!1,a),c.dispatchEvent(d));draw2d.Drag.currentCompartment=c}b=new draw2d.DragDropEvent;b.initDragDropEvent("drag",!1);a.dispatchEvent(b)};a.tempMouseUp=function(b){a.detachEventHandlers();b=b||window.event;if(null!==a.node){var c=a.node.getWorkflow().getScrollLeft(),
d=a.node.getWorkflow().getScrollTop(),e=a.node.getWorkflow().getAbsoluteX(),f=a.node.getWorkflow().getAbsoluteY(),g=a.getDropTarget(b.clientX+c-e,b.clientY+d-f),c=a.getCompartment(b.clientX+c-e,b.clientY+d-f);null!==g&&(d=new draw2d.DragDropEvent,d.initDragDropEvent("drop",!1,a),g.dispatchEvent(d));null!==c&&c.node!==a.node&&(d=new draw2d.DragDropEvent,d.initDragDropEvent("figuredrop",!1,a),c.dispatchEvent(d));null!==draw2d.Drag.currentTarget&&(d=new draw2d.DragDropEvent,d.initDragDropEvent("dragleave",
!1,a),draw2d.Drag.currentTarget.dispatchEvent(d),draw2d.Drag.currentTarget=null)}g=new draw2d.DragDropEvent;g.initDragDropEvent("dragend",!1);a.dispatchEvent(g);a.onDrop(b.clientX,b.clientY);draw2d.Drag.currentCompartment=null;draw2d.Drag.clearCurrent()};if(document.body.addEventListener)document.body.addEventListener("mousemove",this.tempMouseMove,!1),document.body.addEventListener("mouseup",this.tempMouseUp,!1);else if(document.body.attachEvent)document.body.attachEvent("onmousemove",this.tempMouseMove),
document.body.attachEvent("onmouseup",this.tempMouseUp);else throw Error("Drag doesn't support this browser.");};
draw2d.Draggable.prototype.detachEventHandlers=function(){this.isAttached=!1;if(document.body.removeEventListener)document.body.removeEventListener("mousemove",this.tempMouseMove,!1),document.body.removeEventListener("mouseup",this.tempMouseUp,!1);else if(document.body.detachEvent)document.body.detachEvent("onmousemove",this.tempMouseMove),document.body.detachEvent("onmouseup",this.tempMouseUp);else throw Error("Drag doesn't support this browser.");};
draw2d.Draggable.prototype.getDropTarget=function(a,b){for(var c=0;c<this.targets.getSize();c++){var d=this.targets.get(c);if(d.node.isOver(a,b)&&d.node!==this.node)return d}return null};draw2d.Draggable.prototype.getCompartment=function(a,b){for(var c=null,d=0;d<this.node.getWorkflow().compartments.getSize();d++){var e=this.node.getWorkflow().compartments.get(d);e.isOver(a,b)&&e!==this.node&&(null===c?c=e:c.getZOrder()<e.getZOrder()&&(c=e))}return null===c?null:c.dropable};
draw2d.Draggable.prototype.getLeft=function(){return this.element.offsetLeft};draw2d.Draggable.prototype.getTop=function(){return this.element.offsetTop};draw2d.DragDropEvent=function(){draw2d.AbstractEvent.call(this)};draw2d.DragDropEvent.prototype=new draw2d.AbstractEvent;draw2d.DragDropEvent.prototype.initDragDropEvent=function(a,b,c){this.initEvent(a,b);this.relatedTarget=c};draw2d.DropTarget=function(a){draw2d.EventTarget.call(this);this.construct(a)};draw2d.DropTarget.prototype=new draw2d.EventTarget;
draw2d.DropTarget.prototype.construct=function(a){this.element=a};draw2d.DropTarget.prototype.getLeft=function(){for(var a=this.element,b=a.offsetLeft;null!==(a=a.offsetParent);)b+=a.offsetLeft;return b};draw2d.DropTarget.prototype.getTop=function(){for(var a=this.element,b=a.offsetTop;null!==(a=a.offsetParent);)b+=a.offsetTop;return b};draw2d.DropTarget.prototype.getHeight=function(){return this.element.offsetHeight};draw2d.DropTarget.prototype.getWidth=function(){return this.element.offsetWidth};
draw2d.AbstractObjectModel=function(){this.listeners=new draw2d.ArrayList;this.id=draw2d.UUID.create()};draw2d.AbstractObjectModel.EVENT_ELEMENT_ADDED="element added";draw2d.AbstractObjectModel.EVENT_ELEMENT_REMOVED="element removed";draw2d.AbstractObjectModel.EVENT_CONNECTION_ADDED="connection addedx";draw2d.AbstractObjectModel.EVENT_CONNECTION_REMOVED="connection removed";draw2d.AbstractObjectModel.prototype.type="draw2d.AbstractObjectModel";
draw2d.AbstractObjectModel.prototype.getModelChildren=function(){return new draw2d.ArrayList};draw2d.AbstractObjectModel.prototype.getModelParent=function(){return this.modelParent};draw2d.AbstractObjectModel.prototype.setModelParent=function(a){this.modelParent=a};draw2d.AbstractObjectModel.prototype.getId=function(){return this.id};
draw2d.AbstractObjectModel.prototype.firePropertyChange=function(a,b,c){var d=this.listeners.getSize();if(0!==d){b=new draw2d.PropertyChangeEvent(this,a,b,c);for(c=0;c<d;c++)try{this.listeners.get(c).propertyChange(b)}catch(e){alert("Method: draw2d.AbstractObjectModel.prototype.firePropertyChange\n"+e+"\nProperty: "+a+"\nListener Class:"+this.listeners.get(c).type)}}};draw2d.AbstractObjectModel.prototype.addPropertyChangeListener=function(a){null!==a&&this.listeners.add(a)};
draw2d.AbstractObjectModel.prototype.removePropertyChangeListener=function(a){null!==a&&this.listeners.remove(a)};draw2d.AbstractObjectModel.prototype.getPersistentAttributes=function(){return{id:this.id}};draw2d.AbstractConnectionModel=function(){draw2d.AbstractObjectModel.call(this)};draw2d.AbstractConnectionModel.prototype=new draw2d.AbstractObjectModel;draw2d.AbstractConnectionModel.prototype.type="draw2d.AbstractConnectionModel";
draw2d.AbstractConnectionModel.prototype.getSourceModel=function(){throw"you must override the method [AbstractConnectionModel.prototype.getSourceModel]";};draw2d.AbstractConnectionModel.prototype.getTargetModel=function(){throw"you must override the method [AbstractConnectionModel.prototype.getTargetModel]";};draw2d.AbstractConnectionModel.prototype.getSourcePortName=function(){throw"you must override the method [AbstractConnectionModel.prototype.getSourcePortName]";};
draw2d.AbstractConnectionModel.prototype.getTargetPortName=function(){throw"you must override the method [AbstractConnectionModel.prototype.getTargetPortName]";};draw2d.AbstractConnectionModel.prototype.getSourcePortModel=function(){throw"you must override the method [AbstractConnectionModel.prototype.getSourcePortModel]";};draw2d.AbstractConnectionModel.prototype.getTargetPortModel=function(){throw"you must override the method [AbstractConnectionModel.prototype.getTargetPortModel]";};
draw2d.Border=function(){this.color=null};draw2d.Border.prototype.type="draw2d.Border";draw2d.Border.prototype.dispose=function(){this.color=null};draw2d.Border.prototype.getHTMLStyle=function(){return""};draw2d.Border.prototype.setColor=function(a){this.color=a};draw2d.Border.prototype.getColor=function(){return this.color};draw2d.Border.prototype.refresh=function(){};draw2d.LineBorder=function(a){draw2d.Border.call(this);this.width=1;a&&(this.width=a);this.figure=null};
draw2d.LineBorder.prototype=new draw2d.Border;draw2d.LineBorder.prototype.type="draw2d.LineBorder";draw2d.LineBorder.prototype.dispose=function(){draw2d.Border.prototype.dispose.call(this);this.figure=null};draw2d.LineBorder.prototype.setLineWidth=function(a){this.width=a;null!==this.figure&&(this.figure.html.style.border=this.getHTMLStyle())};draw2d.LineBorder.prototype.getHTMLStyle=function(){return null!==this.getColor()?this.width+"px solid "+this.getColor().getHTMLStyle():this.width+"px solid black"};
draw2d.LineBorder.prototype.refresh=function(){this.setLineWidth(this.width)};draw2d.Button=function(a,b,c){this.y=this.x=0;this.height=this.width=24;this.id=draw2d.UUID.create();this.enabled=!0;this.active=!1;this.palette=a;this.html=this.createHTMLElement();void 0!==b&&void 0!==c?this.setDimension(b,c):this.setDimension(24,24)};draw2d.Button.prototype.type="draw2d.Button";draw2d.Button.prototype.dispose=function(){};draw2d.Button.prototype.getImageUrl=function(){return this.type+".png"};
draw2d.Button.prototype.createHTMLElement=function(){var a=document.createElement("div");a.id=this.id;a.style.position="absolute";a.style.left=this.x+"px";a.style.top=this.y+"px";a.style.height=this.width+"px";a.style.width=this.height+"px";a.style.margin="0px";a.style.padding="0px";a.style.outline="none";a.style.backgroundImage=null!==this.getImageUrl()?"url("+this.getImageUrl()+")":"";var b=this;this.omousedown=function(a){b.enabled&&b.setActive(!0);a.cancelBubble=!0;a.returnValue=!1};this.omouseup=
function(a){b.enabled&&(b.setActive(!1),b.execute(),b.palette.setActiveTool(null));a.cancelBubble=!0;a.returnValue=!1};a.addEventListener?(a.addEventListener("mousedown",this.omousedown,!1),a.addEventListener("mouseup",this.omouseup,!1)):a.attachEvent&&(a.attachEvent("onmousedown",this.omousedown),a.attachEvent("onmouseup",this.omouseup));return a};draw2d.Button.prototype.getHTMLElement=function(){null===this.html&&(this.html=this.createHTMLElement());return this.html};
draw2d.Button.prototype.execute=function(){};draw2d.Button.prototype.setTooltip=function(a){this.tooltip=a;this.html.title=null!==this.tooltip?this.tooltip:""};draw2d.Button.prototype.getWorkflow=function(){return this.getToolPalette().getWorkflow()};draw2d.Button.prototype.getToolPalette=function(){return this.palette};draw2d.Button.prototype.setActive=function(a){this.enabled&&(this.active=a,this.html.style.border=!0===a?"1px inset":"0px")};draw2d.Button.prototype.isActive=function(){return this.active};
draw2d.Button.prototype.setEnabled=function(a){(this.enabled=a)?(this.html.style.filter="alpha(opacity=100)",this.html.style.opacity="1.0"):(this.html.style.filter="alpha(opacity=30)",this.html.style.opacity="0.3")};draw2d.Button.prototype.setDimension=function(a,b){this.width=a;this.height=b;null!==this.html&&(this.html.style.width=this.width+"px",this.html.style.height=this.height+"px")};
draw2d.Button.prototype.setPosition=function(a,b){this.x=Math.max(0,a);this.y=Math.max(0,b);null!==this.html&&(this.html.style.left=this.x+"px",this.html.style.top=this.y+"px")};draw2d.Button.prototype.getWidth=function(){return this.width};draw2d.Button.prototype.getHeight=function(){return this.height};draw2d.Button.prototype.getY=function(){return this.y};draw2d.Button.prototype.getX=function(){return this.x};draw2d.Button.prototype.getPosition=function(){return new draw2d.Point(this.x,this.y)};
draw2d.ToggleButton=function(a){draw2d.Button.call(this,a);this.isDownFlag=!1};draw2d.ToggleButton.prototype=new draw2d.Button;draw2d.ToggleButton.prototype.type="draw2d.ToggleButton";
draw2d.ToggleButton.prototype.createHTMLElement=function(){var a=document.createElement("div");a.id=this.id;a.style.position="absolute";a.style.left=this.x+"px";a.style.top=this.y+"px";a.style.height="24px";a.style.width="24px";a.style.margin="0px";a.style.padding="0px";a.style.backgroundImage=null!==this.getImageUrl()?"url("+this.getImageUrl()+")":"";var b=this;this.omousedown=function(a){b.enabled&&(b.isDown()||draw2d.Button.prototype.setActive.call(b,!0));a.cancelBubble=!0;a.returnValue=!1};this.omouseup=
function(a){b.enabled&&(b.isDown()&&draw2d.Button.prototype.setActive.call(b,!1),b.isDownFlag=!b.isDownFlag,b.execute());a.cancelBubble=!0;a.returnValue=!1};a.addEventListener?(a.addEventListener("mousedown",this.omousedown,!1),a.addEventListener("mouseup",this.omouseup,!1)):a.attachEvent&&(a.attachEvent("onmousedown",this.omousedown),a.attachEvent("onmouseup",this.omouseup));return a};draw2d.ToggleButton.prototype.isDown=function(){return this.isDownFlag};
draw2d.ToggleButton.prototype.setActive=function(a){draw2d.Button.prototype.setActive.call(this,a);this.isDownFlag=a};draw2d.ToggleButton.prototype.execute=function(){};draw2d.bpmn.ButtonShowBlocksMenu=function(a){draw2d.Button.call(this,a,16,16)};draw2d.bpmn.ButtonShowBlocksMenu.prototype=new draw2d.Button;draw2d.bpmn.ButtonShowBlocksMenu.prototype.execute=function(){draw2d.bpmn.getBlocksMenu().show(this);draw2d.ToolGeneric.prototype.execute.call(this)};
draw2d.bpmn.ButtonShowBlocksMenu.prototype.getImageUrl=function(){return draw2d.bpmn.getCssImage("showmenublocks.png",!0)};draw2d.Canvas=function(a){try{a&&this.construct(a),this.enableSmoothFigureHandling=!1,this.canvasLines=new draw2d.ArrayList}catch(b){pushErrorStack(b,"draw2d.Canvas=function(/*:String*/id)")}};draw2d.Canvas.IMAGE_BASE_URL="";draw2d.Canvas.prototype.type="draw2d.Canvas";
draw2d.Canvas.prototype.construct=function(a){this.canvasId=a;this.html=document.getElementById(this.canvasId);this.scrollArea=document.body.parentNode};draw2d.Canvas.prototype.setViewPort=function(a){this.scrollArea=document.getElementById(a)};
draw2d.Canvas.prototype.addFigure=function(a,b,c,d){try{!0===this.enableSmoothFigureHandling&&(0>=a.timer&&a.setAlpha(0.001),0<a.timer&&window.clearInterval(a.timer),a.timer=window.setInterval(function(){1>a.alpha?a.setAlpha(Math.min(1,a.alpha+0.05)):(window.clearInterval(a.timer),a.timer=-1)},30));a.setCanvas(this);b&&c&&a.setPosition(b,c);if(a instanceof draw2d.Line)this.canvasLines.add(a),this.html.appendChild(a.getHTMLElement());else{var e=this.canvasLines.getFirstElement();null===e?this.html.appendChild(a.getHTMLElement()):
this.html.insertBefore(a.getHTMLElement(),e.getHTMLElement())}d||a.paint()}catch(f){pushErrorStack(f,"draw2d.Canvas.prototype.addFigure= function( /*:draw2d.Figure*/figure,/*:int*/ xPos,/*:int*/ yPos, /*:boolean*/ avoidPaint)")}};
draw2d.Canvas.prototype.removeFigure=function(a){if(!0===this.enableSmoothFigureHandling){var b=this;0<a.timer&&window.clearInterval(a.timer);a.timer=window.setInterval(function(){0<a.alpha?a.setAlpha(Math.max(0,a.alpha-0.05)):(window.clearInterval(a.timer),a.timer=-1,b.html.removeChild(a.html),a.setCanvas(null))},20)}else this.html.removeChild(a.html),a.setCanvas(null);a instanceof draw2d.Line&&this.canvasLines.remove(a)};draw2d.Canvas.prototype.getEnableSmoothFigureHandling=function(){return this.enableSmoothFigureHandling};
draw2d.Canvas.prototype.setEnableSmoothFigureHandling=function(a){this.enableSmoothFigureHandling=a};draw2d.Canvas.prototype.getWidth=function(){return parseInt(this.html.style.width)};draw2d.Canvas.prototype.setWidth=function(a){null!==this.scrollArea?this.scrollArea.style.width=a+"px":this.html.style.width=a+"px"};draw2d.Canvas.prototype.getHeight=function(){return parseInt(this.html.style.height)};
draw2d.Canvas.prototype.setHeight=function(a){null!==this.scrollArea?this.scrollArea.style.height=a+"px":this.html.style.height=a+"px"};draw2d.Canvas.prototype.setBackgroundImage=function(a,b){this.html.style.background=null!==a?b?"transparent url("+a+") ":"transparent url("+a+") no-repeat":"transparent"};draw2d.Canvas.prototype.getY=function(){return this.y};draw2d.Canvas.prototype.getX=function(){return this.x};
draw2d.Canvas.prototype.getAbsoluteY=function(){for(var a=this.html,b=a.offsetTop;null!==(a=a.offsetParent);)b+=a.offsetTop;return b};draw2d.Canvas.prototype.getAbsoluteX=function(){for(var a=this.html,b=a.offsetLeft;null!==(a=a.offsetParent);)b+=a.offsetLeft;return b};draw2d.Canvas.prototype.getScrollLeft=function(){return this.scrollArea.scrollLeft};draw2d.Canvas.prototype.getScrollTop=function(){return this.scrollArea.scrollTop};
draw2d.Workflow=function(a){try{if(a&&(this.isIPad=null!=navigator.userAgent.match(/iPad/i),this.menu=null,this.gridWidthY=this.gridWidthX=10,this.snapToGeometryHelper=this.horizontalSnapToHelperLine=this.verticalSnapToHelperLine=this.snapToGridHelper=null,this.figures=new draw2d.ArrayList,this.lines=new draw2d.ArrayList,this.commonPorts=new draw2d.ArrayList,this.dropTargets=new draw2d.ArrayList,this.compartments=new draw2d.ArrayList,this.selectionListeners=new draw2d.ArrayList,this.dialogs=new draw2d.ArrayList,
this.toolPalette=null,this.dragging=!1,this.draggingLineCommand=this.draggingLine=this.tooltip=null,this.commandStack=new draw2d.CommandStack,this.oldScrollPosTop=this.oldScrollPosLeft=0,this.currentMenu=this.currentSelection=null,this.connectionLine=new draw2d.Line,this.resizeHandleStart=new draw2d.LineStartResizeHandle(this),this.resizeHandleEnd=new draw2d.LineEndResizeHandle(this),this.resizeHandle1=new draw2d.ResizeHandle(this,1),this.resizeHandle2=new draw2d.ResizeHandle(this,2),this.resizeHandle3=
new draw2d.ResizeHandle(this,3),this.resizeHandle4=new draw2d.ResizeHandle(this,4),this.resizeHandle5=new draw2d.ResizeHandle(this,5),this.resizeHandle6=new draw2d.ResizeHandle(this,6),this.resizeHandle7=new draw2d.ResizeHandle(this,7),this.resizeHandle8=new draw2d.ResizeHandle(this,8),this.resizeHandleHalfWidth=parseInt(this.resizeHandle2.getWidth()/2),draw2d.Canvas.call(this,a),this.setPanning(this.isIPad),null!==this.html)){this.html.style.backgroundImage="url(grid_10.png)";this.html.className=
"Workflow";b=this;this.html.tabIndex="0";this.html.oncontextmenu=function(){return!1};var b=this,a=function(a){b.onKeyDown(a.keyCode,a.ctrlKey)},c=function(a){var c=a||window.event;if(!1!=c.returnValue){var a=c.clientX,c=c.clientY,d=b.getScrollLeft(),e=b.getScrollTop(),f=b.getAbsoluteX(),g=b.getAbsoluteY();b.onMouseDown(a+d-f,c+e-g)}},d=function(a){var c=a.touches.item(0),d=c.clientX,c=c.clientY,e=b.getScrollLeft(),f=b.getScrollTop(),g=b.getAbsoluteX(),h=b.getAbsoluteY();b.onMouseDown(d+e-g,c+f-h);
a.preventDefault()},e=function(a){var c=a||window.event;null!==b.currentMenu&&(b.removeFigure(b.currentMenu),b.currentMenu=null);if(2!=c.button){var a=c.clientX,c=c.clientY,d=b.getScrollLeft(),e=b.getScrollTop(),f=b.getAbsoluteX(),g=b.getAbsoluteY();b.onMouseUp(a+d-f,c+e-g)}},f=function(a){var c=a.touches.item(0),d=c.clientX,e=c.clientY,f=b.getScrollLeft(),g=b.getScrollTop(),h=b.getAbsoluteX(),i=b.getAbsoluteY();b.currentMouseX=d+f-h;b.currentMouseY=e+g-i;var q=b.getBestFigure(b.currentMouseX,b.currentMouseY);
null!==draw2d.Drag.currentHover&&null===q?(c=new draw2d.DragDropEvent,c.initDragDropEvent("mouseleave",!1,b),draw2d.Drag.currentHover.dispatchEvent(c)):(d=c.clientX,e=c.clientY,f=b.getScrollLeft(),g=b.getScrollTop(),h=b.getAbsoluteX(),i=b.getAbsoluteY(),b.onMouseMove(d+f-h,e+g-i));null===q&&(draw2d.Drag.currentHover=null);a.preventDefault()},g=function(a){var c=a||window.event,d=c.clientX,e=c.clientY,f=b.getScrollLeft(),g=b.getScrollTop(),h=b.getAbsoluteX(),i=b.getAbsoluteY();b.currentMouseX=d+f-
h;b.currentMouseY=e+g-i;a=b.getBestFigure(b.currentMouseX,b.currentMouseY);null!==draw2d.Drag.currentHover&&null===a?(c=new draw2d.DragDropEvent,c.initDragDropEvent("mouseleave",!1,b),draw2d.Drag.currentHover.dispatchEvent(c)):(d=c.clientX,e=c.clientY,f=b.getScrollLeft(),g=b.getScrollTop(),h=b.getAbsoluteX(),i=b.getAbsoluteY(),b.onMouseMove(d+f-h,e+g-i));null===a&&(draw2d.Drag.currentHover=null);null!==b.tooltip&&(10<Math.abs(b.currentTooltipX-b.currentMouseX)||10<Math.abs(b.currentTooltipY-b.currentMouseY))&&
b.showTooltip(null)},h=function(a){var a=a||window.event,c=a.clientX,a=a.clientY,d=b.getScrollLeft(),e=b.getScrollTop(),f=b.getAbsoluteX(),g=b.getAbsoluteY(),c=b.getBestLine(c+d-f,a+e-g,null);if(null!==c)c.onDoubleClick()};if(this.html.addEventListener)this.html.addEventListener("touchstart",d,!1),this.html.addEventListener("touchmove",f,!1),this.html.addEventListener("mousemove",g,!1),this.html.addEventListener("mouseup",e,!1),this.html.addEventListener("mousedown",c,!1),this.html.addEventListener("keydown",
a,!1),this.html.addEventListener("dblclick",h,!1);else if(this.html.attachEvent)this.html.attachEvent("onmousemove",g),this.html.attachEvent("onmousedown",c),this.html.attachEvent("onmouseup",e),this.html.attachEvent("onkeydown",a),this.html.attachEvent("ondblclick",h);else throw"FreeGroup Draw2D 0.9.26 not supported in this browser.";}}catch(i){pushErrorStack(i,"draw2d.Workflow=function(/*:String*/id)")}};draw2d.Workflow.prototype=new draw2d.Canvas;draw2d.Workflow.prototype.type="draw2d.Workflow";
draw2d.Workflow.COLOR_GREEN=new draw2d.Color(0,255,0);
draw2d.Workflow.prototype.clear=function(){this.scrollTo(0,0,!0);this.gridWidthY=this.gridWidthX=10;this.horizontalSnapToHelperLine=this.verticalSnapToHelperLine=this.snapToGridHelper=null;for(var a=this.getDocument(),b=a.getLines().clone(),c=0;c<b.getSize();c++)(new draw2d.CommandDelete(b.get(c))).execute();a=a.getFigures().clone();for(c=0;c<a.getSize();c++)(new draw2d.CommandDelete(a.get(c))).execute();this.commonPorts.removeAllElements();this.dropTargets.removeAllElements();this.compartments.removeAllElements();
this.selectionListeners.removeAllElements();this.dialogs.removeAllElements();this.commandStack=new draw2d.CommandStack;this.currentMenu=this.currentSelection=null;draw2d.Drag.clearCurrent()};
draw2d.Workflow.prototype.onScroll=function(){for(var a=this.getScrollLeft(),b=this.getScrollTop(),c=a-this.oldScrollPosLeft,d=b-this.oldScrollPosTop,e=0;e<this.figures.getSize();e++){var f=this.figures.get(e);f.hasFixedPosition&&!0==f.hasFixedPosition()&&f.setPosition(f.getX()+c,f.getY()+d)}this.oldScrollPosLeft=a;this.oldScrollPosTop=b};draw2d.Workflow.prototype.setPanning=function(a){this.panning=a;this.html.style.cursor=a?"move":"default"};
draw2d.Workflow.prototype.scrollTo=function(a,b,c){if(c)this.scrollArea.scrollLeft=a,this.scrollArea.scrollTop=b;else for(var a=(a-this.getScrollLeft())/40,b=(b-this.getScrollTop())/40,c=this.getScrollLeft(),d=this.getScrollTop(),e=0;40>e;e++)this.scrollArea.scrollLeft=c+a*e,this.scrollArea.scrollTop=d+b*e};
draw2d.Workflow.prototype.showTooltip=function(a,b){null!==this.tooltip&&(this.removeFigure(this.tooltip),this.tooltip=null,0<=this.tooltipTimer&&(window.clearTimeout(this.tooltipTimer),this.tooltipTimer=-1));this.tooltip=a;if(null!==this.tooltip){this.currentTooltipX=this.currentMouseX;this.currentTooltipY=this.currentMouseY;this.addFigure(this.tooltip,this.currentTooltipX+10,this.currentTooltipY+10);var c=this;!0==b&&(this.tooltipTimer=window.setTimeout(function(){c.tooltipTimer=-1;c.showTooltip(null)},
5E3))}};draw2d.Workflow.prototype.showDialog=function(a,b,c){b?this.addFigure(a,b,c):this.addFigure(a,200,100);this.dialogs.add(a)};draw2d.Workflow.prototype.showMenu=function(a,b,c){null!==this.menu&&(this.html.removeChild(this.menu.getHTMLElement()),this.menu.setWorkflow());this.menu=a;null!==this.menu&&(this.menu.setWorkflow(this),this.menu.setPosition(b,c),this.html.appendChild(this.menu.getHTMLElement()),this.menu.paint())};
draw2d.Workflow.prototype.onContextMenu=function(a,b){var c=this.getContextMenu();null!==c&&this.showMenu(c,a,b)};draw2d.Workflow.prototype.getContextMenu=function(){return null};draw2d.Workflow.prototype.setToolWindow=function(a,b,c){this.toolPalette=a;c?this.addFigure(a,b,c):this.addFigure(a,20,20);this.dialogs.add(a)};draw2d.Workflow.prototype.setSnapToGrid=function(a){this.snapToGridHelper=a?new draw2d.SnapToGrid(this):null};
draw2d.Workflow.prototype.setSnapToGeometry=function(a){this.snapToGeometryHelper=a?new draw2d.SnapToGeometry(this):null};draw2d.Workflow.prototype.setGridWidth=function(a,b){this.gridWidthX=a;this.gridWidthY=b};
draw2d.Workflow.prototype.addFigure=function(a,b,c){try{draw2d.Canvas.prototype.addFigure.call(this,a,b,c,!0);a.setWorkflow(this);var d=this;a instanceof draw2d.CompartmentFigure&&this.compartments.add(a);a instanceof draw2d.Line?this.lines.add(a):(this.figures.add(a),a.draggable.addEventListener("drag",function(a){a=d.getFigure(a.target.element.id);null!==a&&!1!=a.isSelectable()&&d.moveResizeHandles(a)}));a.paint();this.setDocumentDirty()}catch(e){pushErrorStack(e,"draw2d.Workflow.prototype.addFigure=function(/*:draw2d.Figure*/ figure ,/*:int*/ xPos, /*:int*/ yPos)")}};
draw2d.Workflow.prototype.removeFigure=function(a){draw2d.Canvas.prototype.removeFigure.call(this,a);this.figures.remove(a);this.lines.remove(a);this.dialogs.remove(a);a.setWorkflow(null);a instanceof draw2d.CompartmentFigure&&this.compartments.remove(a);a instanceof draw2d.Connection&&a.disconnect();this.currentSelection==a&&this.setCurrentSelection(null);this.setDocumentDirty();a.onRemove(this)};draw2d.Workflow.prototype.moveFront=function(a){this.html.removeChild(a.getHTMLElement());this.html.appendChild(a.getHTMLElement())};
draw2d.Workflow.prototype.moveBack=function(a){this.html.removeChild(a.getHTMLElement());this.html.insertBefore(a.getHTMLElement(),this.html.firstChild)};draw2d.Workflow.prototype.getBestCompartmentFigure=function(a,b,c){for(var d=null,e=0;e<this.figures.getSize();e++){var f=this.figures.get(e);f instanceof draw2d.CompartmentFigure&&(!0==f.isOver(a,b)&&f!=c)&&(null===d?d=f:d.getZOrder()<f.getZOrder()&&(d=f))}return d};
draw2d.Workflow.prototype.getBestFigure=function(a,b,c){for(var d=null,e=0;e<this.figures.getSize();e++){var f=this.figures.get(e);!0==f.isOver(a,b)&&f!=c&&(null===d?d=f:d.getZOrder()<f.getZOrder()&&(d=f))}return d};draw2d.Workflow.prototype.getBestLine=function(a,b,c){for(var d=null,e=this.lines.getSize(),f=0;f<e;f++){var g=this.lines.get(f);!0==g.containsPoint(a,b)&&g!=c&&(null===d?d=g:d.getZOrder()<g.getZOrder()&&(d=g))}return d};
draw2d.Workflow.prototype.getFigure=function(a){for(var b=0;b<this.figures.getSize();b++){var c=this.figures.get(b);if(c.id==a)return c}return null};draw2d.Workflow.prototype.getFigures=function(){return this.figures};draw2d.Workflow.prototype.getDocument=function(){return new draw2d.CanvasDocument(this)};
draw2d.Workflow.prototype.addSelectionListener=function(a){if(null!==a)if(a.onSelectionChanged)this.selectionListeners.add(a);else throw"Object doesn't implement required callback method [onSelectionChanged]";};draw2d.Workflow.prototype.removeSelectionListener=function(a){this.selectionListeners.remove(a)};
draw2d.Workflow.prototype.setCurrentSelection=function(a){if(null===a||this.currentSelection!=a)this.hideResizeHandles(),this.hideLineResizeHandles();this.currentSelection=a;for(var b=0;b<this.selectionListeners.getSize();b++){var c=this.selectionListeners.get(b);if(c.onSelectionChanged)c.onSelectionChanged(this.currentSelection,this.currentSelection?this.currentSelection.getModel():null)}a instanceof draw2d.Line&&(this.showLineResizeHandles(a),a instanceof draw2d.Connection||(this.draggingLineCommand=
a.createCommand(new draw2d.EditPolicy(draw2d.EditPolicy.MOVE)),null!==this.draggingLineCommand&&(this.draggingLine=a)))};draw2d.Workflow.prototype.getCurrentSelection=function(){return this.currentSelection};draw2d.Workflow.prototype.getLine=function(a){for(var b=this.lines.getSize(),c=0;c<b;c++){var d=this.lines.get(c);if(d.getId()==a)return d}return null};draw2d.Workflow.prototype.getLines=function(){return this.lines};
draw2d.Workflow.prototype.registerPort=function(a){a.draggable.targets=this.dropTargets;this.commonPorts.add(a);this.dropTargets.add(a.dropable)};draw2d.Workflow.prototype.unregisterPort=function(a){a.draggable.targets=null;this.commonPorts.remove(a);this.dropTargets.remove(a.dropable)};draw2d.Workflow.prototype.getCommandStack=function(){return this.commandStack};
draw2d.Workflow.prototype.showConnectionLine=function(a,b,c,d){this.connectionLine.setStartPoint(a,b);this.connectionLine.setEndPoint(c,d);null===this.connectionLine.canvas&&draw2d.Canvas.prototype.addFigure.call(this,this.connectionLine)};draw2d.Workflow.prototype.hideConnectionLine=function(){null!==this.connectionLine.canvas&&draw2d.Canvas.prototype.removeFigure.call(this,this.connectionLine)};
draw2d.Workflow.prototype.showLineResizeHandles=function(a){var b=this.resizeHandleStart.getWidth()/2;this.resizeHandleStart.getHeight();var c=a.getStartPoint(),d=a.getEndPoint();draw2d.Canvas.prototype.addFigure.call(this,this.resizeHandleStart,c.x-b,c.y-b);draw2d.Canvas.prototype.addFigure.call(this,this.resizeHandleEnd,d.x-b,d.y-b);this.resizeHandleStart.setCanDrag(a.isResizeable());this.resizeHandleEnd.setCanDrag(a.isResizeable());a.isResizeable()?(this.resizeHandleStart.setBackgroundColor(draw2d.Workflow.COLOR_GREEN),
this.resizeHandleEnd.setBackgroundColor(draw2d.Workflow.COLOR_GREEN),this.resizeHandleStart.draggable.targets=this.dropTargets,this.resizeHandleEnd.draggable.targets=this.dropTargets):(this.resizeHandleStart.setBackgroundColor(null),this.resizeHandleEnd.setBackgroundColor(null))};
draw2d.Workflow.prototype.hideLineResizeHandles=function(){null!==this.resizeHandleStart.canvas&&draw2d.Canvas.prototype.removeFigure.call(this,this.resizeHandleStart);null!==this.resizeHandleEnd.canvas&&draw2d.Canvas.prototype.removeFigure.call(this,this.resizeHandleEnd)};
draw2d.Workflow.prototype.showResizeHandles=function(a){this.hideLineResizeHandles();this.hideResizeHandles();!0==this.getEnableSmoothFigureHandling()&&this.getCurrentSelection()!=a&&(this.resizeHandle1.setAlpha(0.01),this.resizeHandle2.setAlpha(0.01),this.resizeHandle3.setAlpha(0.01),this.resizeHandle4.setAlpha(0.01),this.resizeHandle5.setAlpha(0.01),this.resizeHandle6.setAlpha(0.01),this.resizeHandle7.setAlpha(0.01),this.resizeHandle8.setAlpha(0.01));var b=this.resizeHandle1.getWidth(),c=this.resizeHandle1.getHeight(),
d=a.getHeight(),e=a.getWidth(),f=a.getX(),g=a.getY();draw2d.Canvas.prototype.addFigure.call(this,this.resizeHandle1,f-b,g-c);draw2d.Canvas.prototype.addFigure.call(this,this.resizeHandle3,f+e,g-c);draw2d.Canvas.prototype.addFigure.call(this,this.resizeHandle5,f+e,g+d);draw2d.Canvas.prototype.addFigure.call(this,this.resizeHandle7,f-b,g+d);this.moveFront(this.resizeHandle1);this.moveFront(this.resizeHandle3);this.moveFront(this.resizeHandle5);this.moveFront(this.resizeHandle7);this.resizeHandle1.setCanDrag(a.isResizeable());
this.resizeHandle3.setCanDrag(a.isResizeable());this.resizeHandle5.setCanDrag(a.isResizeable());this.resizeHandle7.setCanDrag(a.isResizeable());if(a.isResizeable()){var h=new draw2d.Color(0,255,0);this.resizeHandle1.setBackgroundColor(h);this.resizeHandle3.setBackgroundColor(h);this.resizeHandle5.setBackgroundColor(h);this.resizeHandle7.setBackgroundColor(h)}else this.resizeHandle1.setBackgroundColor(null),this.resizeHandle3.setBackgroundColor(null),this.resizeHandle5.setBackgroundColor(null),this.resizeHandle7.setBackgroundColor(null);
a.isStrechable()&&a.isResizeable()&&(this.resizeHandle2.setCanDrag(a.isResizeable()),this.resizeHandle4.setCanDrag(a.isResizeable()),this.resizeHandle6.setCanDrag(a.isResizeable()),this.resizeHandle8.setCanDrag(a.isResizeable()),draw2d.Canvas.prototype.addFigure.call(this,this.resizeHandle2,f+e/2-this.resizeHandleHalfWidth,g-c),draw2d.Canvas.prototype.addFigure.call(this,this.resizeHandle4,f+e,g+d/2-c/2),draw2d.Canvas.prototype.addFigure.call(this,this.resizeHandle6,f+e/2-this.resizeHandleHalfWidth,
g+d),draw2d.Canvas.prototype.addFigure.call(this,this.resizeHandle8,f-b,g+d/2-c/2),this.moveFront(this.resizeHandle2),this.moveFront(this.resizeHandle4),this.moveFront(this.resizeHandle6),this.moveFront(this.resizeHandle8))};
draw2d.Workflow.prototype.hideResizeHandles=function(){null!==this.resizeHandle1.canvas&&draw2d.Canvas.prototype.removeFigure.call(this,this.resizeHandle1);null!==this.resizeHandle2.canvas&&draw2d.Canvas.prototype.removeFigure.call(this,this.resizeHandle2);null!==this.resizeHandle3.canvas&&draw2d.Canvas.prototype.removeFigure.call(this,this.resizeHandle3);null!==this.resizeHandle4.canvas&&draw2d.Canvas.prototype.removeFigure.call(this,this.resizeHandle4);null!==this.resizeHandle5.canvas&&draw2d.Canvas.prototype.removeFigure.call(this,
this.resizeHandle5);null!==this.resizeHandle6.canvas&&draw2d.Canvas.prototype.removeFigure.call(this,this.resizeHandle6);null!==this.resizeHandle7.canvas&&draw2d.Canvas.prototype.removeFigure.call(this,this.resizeHandle7);null!==this.resizeHandle8.canvas&&draw2d.Canvas.prototype.removeFigure.call(this,this.resizeHandle8)};
draw2d.Workflow.prototype.moveResizeHandles=function(a){var b=this.resizeHandle1.getWidth(),c=this.resizeHandle1.getHeight(),d=a.getHeight(),e=a.getWidth(),f=a.getX(),g=a.getY();this.resizeHandle1.setPosition(f-b,g-c);this.resizeHandle3.setPosition(f+e,g-c);this.resizeHandle5.setPosition(f+e,g+d);this.resizeHandle7.setPosition(f-b,g+d);a.isStrechable()&&(this.resizeHandle2.setPosition(f+e/2-this.resizeHandleHalfWidth,g-c),this.resizeHandle4.setPosition(f+e,g+d/2-c/2),this.resizeHandle6.setPosition(f+
e/2-this.resizeHandleHalfWidth,g+d),this.resizeHandle8.setPosition(f-b,g+d/2-c/2))};draw2d.Workflow.prototype.onMouseDown=function(a,b){this.dragging=!0;this.mouseDownPosX=a;this.mouseDownPosY=b;null!==this.toolPalette&&null!==this.toolPalette.getActiveTool()&&this.toolPalette.getActiveTool().execute(a,b);this.showMenu(null);var c=this.getBestLine(a,b);null!==c&&c.isSelectable()?this.setCurrentSelection(c):this.setCurrentSelection(null)};
draw2d.Workflow.prototype.onMouseUp=function(){this.dragging=!1;null!==this.draggingLineCommand&&(this.getCommandStack().execute(this.draggingLineCommand),this.draggingLineCommand=this.draggingLine=null)};
draw2d.Workflow.prototype.onMouseMove=function(a,b){if(!0===this.dragging&&null!==this.draggingLine){var c=a-this.mouseDownPosX,d=b-this.mouseDownPosY;this.draggingLine.startX=this.draggingLine.getStartX()+c;this.draggingLine.startY=this.draggingLine.getStartY()+d;this.draggingLine.setEndPoint(this.draggingLine.getEndX()+c,this.draggingLine.getEndY()+d);this.mouseDownPosX=a;this.mouseDownPosY=b;this.showLineResizeHandles(this.currentSelection)}else!0===this.dragging&&!0===this.panning&&(c=a-this.mouseDownPosX,
d=b-this.mouseDownPosY,this.scrollTo(this.getScrollLeft()-c,this.getScrollTop()-d,!0),this.onScroll())};draw2d.Workflow.prototype.onKeyDown=function(a,b){46==a&&null!==this.currentSelection?this.commandStack.execute(this.currentSelection.createCommand(new draw2d.EditPolicy(draw2d.EditPolicy.DELETE))):90==a&&b?this.commandStack.undo():89==a&&b&&this.commandStack.redo()};
draw2d.Workflow.prototype.setDocumentDirty=function(){try{for(var a=0;a<this.dialogs.getSize();a++){var b=this.dialogs.get(a);if(null!==b&&b.onSetDocumentDirty)b.onSetDocumentDirty()}if(null!==this.snapToGeometryHelper)this.snapToGeometryHelper.onSetDocumentDirty();if(null!==this.snapToGridHelper)this.snapToGridHelper.onSetDocumentDirty()}catch(c){pushErrorStack(c,"draw2d.Workflow.prototype.setDocumentDirty=function()")}};
draw2d.Workflow.prototype.snapToHelper=function(a,b){if(null!==this.snapToGeometryHelper){if(a instanceof draw2d.ResizeHandle){var c=a.getSnapToGridAnchor();b.x+=c.x;b.y+=c.y;var d=new draw2d.Point(b.x,b.y),e=a.getSnapToDirection(),f=this.snapToGeometryHelper.snapPoint(e,b,d);e&draw2d.SnapToHelper.EAST_WEST&&!(f&draw2d.SnapToHelper.EAST_WEST)?this.showSnapToHelperLineVertical(d.x):this.hideSnapToHelperLineVertical();e&draw2d.SnapToHelper.NORTH_SOUTH&&!(f&draw2d.SnapToHelper.NORTH_SOUTH)?this.showSnapToHelperLineHorizontal(d.y):
this.hideSnapToHelperLineHorizontal();d.x-=c.x;d.y-=c.y;return d}c=new draw2d.Dimension(b.x,b.y,a.getWidth(),a.getHeight());d=new draw2d.Dimension(b.x,b.y,a.getWidth(),a.getHeight());e=draw2d.SnapToHelper.NSEW;f=this.snapToGeometryHelper.snapRectangle(c,d);e&draw2d.SnapToHelper.WEST&&!(f&draw2d.SnapToHelper.WEST)?this.showSnapToHelperLineVertical(d.x):e&draw2d.SnapToHelper.EAST&&!(f&draw2d.SnapToHelper.EAST)?this.showSnapToHelperLineVertical(d.getX()+d.getWidth()):this.hideSnapToHelperLineVertical();
e&draw2d.SnapToHelper.NORTH&&!(f&draw2d.SnapToHelper.NORTH)?this.showSnapToHelperLineHorizontal(d.y):e&draw2d.SnapToHelper.SOUTH&&!(f&draw2d.SnapToHelper.SOUTH)?this.showSnapToHelperLineHorizontal(d.getY()+d.getHeight()):this.hideSnapToHelperLineHorizontal();return d.getTopLeft()}return null!==this.snapToGridHelper?(c=a.getSnapToGridAnchor(),b.x+=c.x,b.y+=c.y,d=new draw2d.Point(b.x,b.y),this.snapToGridHelper.snapPoint(0,b,d),d.x-=c.x,d.y-=c.y,d):b};
draw2d.Workflow.prototype.showSnapToHelperLineHorizontal=function(a){null===this.horizontalSnapToHelperLine&&(this.horizontalSnapToHelperLine=new draw2d.Line,this.horizontalSnapToHelperLine.setColor(new draw2d.Color(175,175,255)),this.addFigure(this.horizontalSnapToHelperLine));this.horizontalSnapToHelperLine.setStartPoint(0,a);this.horizontalSnapToHelperLine.setEndPoint(this.getWidth(),a)};
draw2d.Workflow.prototype.showSnapToHelperLineVertical=function(a){null===this.verticalSnapToHelperLine&&(this.verticalSnapToHelperLine=new draw2d.Line,this.verticalSnapToHelperLine.setColor(new draw2d.Color(175,175,255)),this.addFigure(this.verticalSnapToHelperLine));this.verticalSnapToHelperLine.setStartPoint(a,0);this.verticalSnapToHelperLine.setEndPoint(a,this.getHeight())};draw2d.Workflow.prototype.hideSnapToHelperLines=function(){this.hideSnapToHelperLineHorizontal();this.hideSnapToHelperLineVertical()};
draw2d.Workflow.prototype.hideSnapToHelperLineHorizontal=function(){null!==this.horizontalSnapToHelperLine&&(this.removeFigure(this.horizontalSnapToHelperLine),this.horizontalSnapToHelperLine=null)};draw2d.Workflow.prototype.hideSnapToHelperLineVertical=function(){null!==this.verticalSnapToHelperLine&&(this.removeFigure(this.verticalSnapToHelperLine),this.verticalSnapToHelperLine=null)};
draw2d.GraphicalViewer=function(a){try{draw2d.Workflow.call(this,a),this.model=this.factory=null,this.initDone=!1}catch(b){pushErrorStack(b,"draw2d.GraphicalViewer=function(/*:String*/ id)")}};draw2d.GraphicalViewer.prototype=new draw2d.Workflow;draw2d.GraphicalViewer.prototype.type="draw2d.GraphicalViewer";draw2d.GraphicalViewer.prototype.setEditPartFactory=function(a){this.factory=a;this.checkInit()};
draw2d.GraphicalViewer.prototype.setModel=function(a){try{a instanceof draw2d.AbstractObjectModel?(this.model=a,this.checkInit(),this.model.addPropertyChangeListener(this)):alert("Invalid model class type:"+a.type)}catch(b){pushErrorStack(b,"draw2d.GraphicalViewer.prototype.setModel=function(/*:draw2d.AbstractObjectModel*/ model )")}};
draw2d.GraphicalViewer.prototype.propertyChange=function(a){switch(a.property){case draw2d.AbstractObjectModel.EVENT_ELEMENT_REMOVED:var b=this.getFigure(a.oldValue.getId());this.removeFigure(b);break;case draw2d.AbstractObjectModel.EVENT_ELEMENT_ADDED:b=this.factory.createEditPart(a.newValue),b.setId(a.newValue.getId()),this.addFigure(b),this.setCurrentSelection(b)}};
draw2d.GraphicalViewer.prototype.checkInit=function(){if(null!==this.factory&&null!==this.model&&!1==this.initDone){try{for(var a=this.model.getModelChildren(),b=a.getSize(),c=0;c<b;c++){var d=a.get(c),e=this.factory.createEditPart(d);e.setId(d.getId());this.addFigure(e)}}catch(f){pushErrorStack(f,"draw2d.GraphicalViewer.prototype.checkInit=function()[addFigures]")}try{for(var g=this.getDocument().getFigures(),b=g.getSize(),c=0;c<b;c++)e=g.get(c),e instanceof draw2d.Node&&this.refreshConnections(e)}catch(h){pushErrorStack(h,
"draw2d.GraphicalViewer.prototype.checkInit=function()[refreshConnections]")}}};
draw2d.GraphicalViewer.prototype.refreshConnections=function(a){try{for(var b=new draw2d.ArrayList,c=a.getModelSourceConnections(),d=c.getSize(),e=0;e<d;e++){var f=c.get(e);b.add(f.getId());var g=this.getLine(f.getId());if(null===g){var g=this.factory.createEditPart(f),h=f.getSourceModel(),i=f.getTargetModel(),k=this.getFigure(h.getId()),j=this.getFigure(i.getId()),m=k.getOutputPort(f.getSourcePortName()),l=j.getInputPort(f.getTargetPortName());g.setTarget(l);g.setSource(m);g.setId(f.getId());this.addFigure(g);
this.setCurrentSelection(g)}}for(var n=a.getOutputPorts(),d=n.getSize(),e=0;e<d;e++)for(var r=n.get(e).getConnections(),p=r.getSize(),a=0;a<p;a++){var o=r.get(a);b.contains(o.getId())||(this.removeFigure(o),b.add(o.getId()))}}catch(q){pushErrorStack(q,"draw2d.GraphicalViewer.prototype.refreshConnections=function(/*:draw2d.Node*/ node )")}};draw2d.Command=function(a){this.label=a};draw2d.Command.prototype.type="draw2d.Command";draw2d.Command.prototype.getLabel=function(){return this.label};
draw2d.Command.prototype.canExecute=function(){return!0};draw2d.Command.prototype.execute=function(){};draw2d.Command.prototype.cancel=function(){};draw2d.Command.prototype.undo=function(){};draw2d.Command.prototype.redo=function(){};draw2d.CommandAdd=function(a,b,c,d,e){draw2d.Command.call(this,"add figure");void 0===e&&(e=null);this.parent=e;this.figure=b;this.x=c;this.y=d;this.workflow=a};draw2d.CommandAdd.prototype=new draw2d.Command;draw2d.CommandAdd.prototype.type="draw2d.CommandAdd";
draw2d.CommandAdd.prototype.execute=function(){this.redo()};draw2d.CommandAdd.prototype.redo=function(){this.x&&this.y?this.workflow.addFigure(this.figure,this.x,this.y):this.workflow.addFigure(this.figure);this.workflow.setCurrentSelection(this.figure);null!==this.parent&&this.parent.addChild(this.figure)};draw2d.CommandAdd.prototype.undo=function(){this.workflow.removeFigure(this.figure);this.workflow.setCurrentSelection(null);null!==this.parent&&this.parent.removeChild(this.figure)};
draw2d.CommandConnect=function(a,b,c){draw2d.Command.call(this,"create connection");this.workflow=a;this.source=b;this.target=c;this.connection=null};draw2d.CommandConnect.prototype=new draw2d.Command;draw2d.CommandConnect.prototype.type="draw2d.CommandConnect";draw2d.CommandConnect.prototype.setConnection=function(a){this.connection=a};
draw2d.CommandConnect.prototype.execute=function(){null===this.connection&&(this.connection=new draw2d.Connection);this.connection.setSource(this.source);this.connection.setTarget(this.target);this.workflow.addFigure(this.connection)};draw2d.CommandConnect.prototype.redo=function(){this.workflow.addFigure(this.connection);this.connection.reconnect()};draw2d.CommandConnect.prototype.undo=function(){this.workflow.removeFigure(this.connection)};
draw2d.CommandDelete=function(a){draw2d.Command.call(this,"delete figure");this.parent=a.parent;this.figure=a;this.workflow=a.workflow;this.compartmentDeleteCommands=this.connections=null};draw2d.CommandDelete.prototype=new draw2d.Command;draw2d.CommandDelete.prototype.type="draw2d.CommandDelete";draw2d.CommandDelete.prototype.execute=function(){this.redo()};
draw2d.CommandDelete.prototype.undo=function(){if(this.figure instanceof draw2d.CompartmentFigure)for(var a=0;a<this.compartmentDeleteCommands.getSize();a++)this.figure.addChild(this.compartmentDeleteCommands.get(a).figure),this.workflow.getCommandStack().undo();this.workflow.addFigure(this.figure);this.figure instanceof draw2d.Connection&&this.figure.reconnect();this.workflow.setCurrentSelection(this.figure);null!==this.parent&&this.parent.addChild(this.figure);for(a=0;a<this.connections.getSize();++a)this.workflow.addFigure(this.connections.get(a)),
this.connections.get(a).reconnect()};
draw2d.CommandDelete.prototype.redo=function(){if(this.figure instanceof draw2d.CompartmentFigure)if(null===this.compartmentDeleteCommands){this.compartmentDeleteCommands=new draw2d.ArrayList;for(var a=this.figure.getChildren().clone(),b=0;b<a.getSize();b++){var c=a.get(b);this.figure.removeChild(c);c=new draw2d.CommandDelete(c);this.compartmentDeleteCommands.add(c);this.workflow.getCommandStack().execute(c)}}else for(b=0;b<this.compartmentDeleteCommands.getSize();b++)this.workflow.redo();this.workflow.removeFigure(this.figure);
this.workflow.setCurrentSelection(null);if(this.figure instanceof draw2d.Node&&null===this.connections){this.connections=new draw2d.ArrayList;a=this.figure.getPorts();for(b=0;b<a.getSize();b++)for(var c=a.get(b),d=0,e=c.getConnections().getSize();d<e;d++)this.connections.contains(c.getConnections().get(d))||this.connections.add(c.getConnections().get(d))}null===this.connections&&(this.connections=new draw2d.ArrayList);null!==this.parent&&this.parent.removeChild(this.figure);for(b=0;b<this.connections.getSize();++b)this.workflow.removeFigure(this.connections.get(b))};
draw2d.CommandMove=function(a,b,c){draw2d.Command.call(this,"move figure");this.figure=a;void 0==b?(this.oldX=a.getX(),this.oldY=a.getY()):(this.oldX=b,this.oldY=c);this.oldCompartment=a.getParent()};draw2d.CommandMove.prototype=new draw2d.Command;draw2d.CommandMove.prototype.type="draw2d.CommandMove";draw2d.CommandMove.prototype.setStartPosition=function(a,b){this.oldX=a;this.oldY=b};
draw2d.CommandMove.prototype.setPosition=function(a,b){this.newX=a;this.newY=b;this.newCompartment=this.figure.workflow.getBestCompartmentFigure(a,b,this.figure)};draw2d.CommandMove.prototype.canExecute=function(){return this.newX!=this.oldX||this.newY!=this.oldY};draw2d.CommandMove.prototype.execute=function(){this.redo()};
draw2d.CommandMove.prototype.undo=function(){this.figure.setPosition(this.oldX,this.oldY);null!==this.newCompartment&&this.newCompartment.removeChild(this.figure);null!==this.oldCompartment&&this.oldCompartment.addChild(this.figure);this.figure.workflow.moveResizeHandles(this.figure)};
draw2d.CommandMove.prototype.redo=function(){this.figure.setPosition(this.newX,this.newY);null!==this.oldCompartment&&this.oldCompartment.removeChild(this.figure);null!==this.newCompartment&&this.newCompartment.addChild(this.figure);this.figure.workflow.moveResizeHandles(this.figure)};draw2d.CommandMoveLine=function(a,b,c,d,e){draw2d.Command.call(this,"move line");this.line=a;this.startX1=b;this.startY1=c;this.endX1=d;this.endY1=e};draw2d.CommandMoveLine.prototype=new draw2d.Command;
draw2d.CommandMoveLine.prototype.type="draw2d.CommandMoveLine";draw2d.CommandMoveLine.prototype.canExecute=function(){return this.startX1!=this.startX2||this.startY1!=this.startY2||this.endX1!=this.endX2||this.endY1!=this.endY2};draw2d.CommandMoveLine.prototype.execute=function(){this.startX2=this.line.getStartX();this.startY2=this.line.getStartY();this.endX2=this.line.getEndX();this.endY2=this.line.getEndY();this.redo()};
draw2d.CommandMoveLine.prototype.undo=function(){this.line.setStartPoint(this.startX1,this.startY1);this.line.setEndPoint(this.endX1,this.endY1);this.line.workflow.getCurrentSelection()==this.line&&this.line.workflow.showLineResizeHandles(this.line)};draw2d.CommandMoveLine.prototype.redo=function(){this.line.setStartPoint(this.startX2,this.startY2);this.line.setEndPoint(this.endX2,this.endY2);this.line.workflow.getCurrentSelection()==this.line&&this.line.workflow.showLineResizeHandles(this.line)};
draw2d.CommandMovePort=function(a){draw2d.Command.call(this,"move port");this.port=a};draw2d.CommandMovePort.prototype=new draw2d.Command;draw2d.CommandMovePort.prototype.type="draw2d.CommandMovePort";draw2d.CommandMovePort.prototype.execute=function(){this.port.setAlpha(1);this.port.setPosition(this.port.originX,this.port.originY);this.port.parentNode.workflow.hideConnectionLine()};draw2d.CommandMovePort.prototype.undo=function(){};draw2d.CommandMovePort.prototype.redo=function(){};
draw2d.CommandMovePort.prototype.setPosition=function(){};draw2d.CommandReconnect=function(a){draw2d.Command.call(this,"reconnect connection");this.con=a;this.oldSourcePort=a.getSource();this.oldTargetPort=a.getTarget();this.oldRouter=a.getRouter();this.con.setRouter(new draw2d.NullConnectionRouter)};draw2d.CommandReconnect.prototype=new draw2d.Command;draw2d.CommandReconnect.prototype.type="draw2d.CommandReconnect";draw2d.CommandReconnect.prototype.canExecute=function(){return!0};
draw2d.CommandReconnect.prototype.setNewPorts=function(a,b){this.newSourcePort=a;this.newTargetPort=b};draw2d.CommandReconnect.prototype.execute=function(){this.redo()};draw2d.CommandReconnect.prototype.cancel=function(){var a=this.con.sourceAnchor.getLocation(this.con.targetAnchor.getReferencePoint()),b=this.con.targetAnchor.getLocation(this.con.sourceAnchor.getReferencePoint());this.con.setStartPoint(a.x,a.y);this.con.setEndPoint(b.x,b.y);this.con.getWorkflow().showLineResizeHandles(this.con);this.con.setRouter(this.oldRouter)};
draw2d.CommandReconnect.prototype.undo=function(){this.con.setSource(this.oldSourcePort);this.con.setTarget(this.oldTargetPort);this.con.setRouter(this.oldRouter);this.con.getWorkflow().getCurrentSelection()==this.con&&this.con.getWorkflow().showLineResizeHandles(this.con)};draw2d.CommandReconnect.prototype.redo=function(){this.con.setSource(this.newSourcePort);this.con.setTarget(this.newTargetPort);this.con.setRouter(this.oldRouter);this.con.getWorkflow().getCurrentSelection()==this.con&&this.con.getWorkflow().showLineResizeHandles(this.con)};
draw2d.CommandResize=function(a,b,c){draw2d.Command.call(this,"resize figure");this.figure=a;void 0===b?(this.oldWidth=a.getWidth(),this.oldHeight=a.getHeight()):(this.oldWidth=b,this.oldHeight=c)};draw2d.CommandResize.prototype=new draw2d.Command;draw2d.CommandResize.prototype.type="draw2d.CommandResize";draw2d.CommandResize.prototype.setDimension=function(a,b){this.newWidth=a;this.newHeight=b};
draw2d.CommandResize.prototype.canExecute=function(){return this.newWidth!=this.oldWidth||this.newHeight!=this.oldHeight};draw2d.CommandResize.prototype.execute=function(){this.redo()};draw2d.CommandResize.prototype.undo=function(){this.figure.setDimension(this.oldWidth,this.oldHeight);this.figure.workflow.moveResizeHandles(this.figure);draw2d.bpmn.onResize(this.figure)};
draw2d.CommandResize.prototype.redo=function(){this.figure.setDimension(this.newWidth,this.newHeight);this.figure.workflow.moveResizeHandles(this.figure);draw2d.bpmn.onResize(this.figure)};draw2d.CommandSetBackgroundColor=function(a,b){draw2d.Command.call(this,"set background color");this.figure=a;this.newColor=b;this.oldColor=a.getBackgroundColor()};draw2d.CommandSetBackgroundColor.prototype=new draw2d.Command;draw2d.CommandSetBackgroundColor.prototype.type="draw2d.CommandSetBackgroundColor";
draw2d.CommandSetBackgroundColor.prototype.execute=function(){this.redo()};draw2d.CommandSetBackgroundColor.prototype.undo=function(){this.figure.setBackgroundColor(this.oldColor)};draw2d.CommandSetBackgroundColor.prototype.redo=function(){this.figure.setBackgroundColor(this.newColor)};draw2d.CommandSetColor=function(a,b){draw2d.Command.call(this,"set color");this.figure=a;this.newColor=b;this.oldColor=a.getColor()};draw2d.CommandSetColor.prototype=new draw2d.Command;
draw2d.CommandSetColor.prototype.type="draw2d.CommandSetColor";draw2d.CommandSetColor.prototype.execute=function(){this.redo()};draw2d.CommandSetColor.prototype.undo=function(){this.figure.setColor(this.oldColor)};draw2d.CommandSetColor.prototype.redo=function(){this.figure.setColor(this.newColor)};draw2d.CommandSetText=function(a,b){draw2d.Command.call(this,"set text");this.figure=a;this.newText=b;this.oldText=a.getText()};draw2d.CommandSetText.prototype=new draw2d.Command;
draw2d.CommandSetText.prototype.type="draw2d.CommandSetText";draw2d.CommandSetText.prototype.execute=function(){this.redo()};draw2d.CommandSetText.prototype.redo=function(){this.figure.setText(this.newText)};draw2d.CommandSetText.prototype.undo=function(){this.figure.setText(this.oldText)};draw2d.CommandStackEventListener=function(){};draw2d.CommandStackEventListener.prototype.type="draw2d.CommandStackEventListener";draw2d.CommandStackEventListener.prototype.stackChanged=function(){};
draw2d.bpmn.CommandListener=function(){draw2d.CommandStackEventListener.call(this)};draw2d.bpmn.CommandListener.prototype=new draw2d.CommandStackEventListener;
draw2d.bpmn.CommandListener.prototype.stackChanged=function(a){var b=a.getCommand();if(a.isPostChangeEvent())if(b instanceof draw2d.CommandDelete)a=draw2d.bpmn.getSwimlanePanel(),a.setMinBounds(b.figure),b.figure.paramsData&&b.figure.paramsData._id?a.changedFigures.setItem(b.figure.id,{_id:b.figure.paramsData._id,_action:"delete"}):a.changedFigures.removeItem(b.figure.id);else{if(b instanceof draw2d.CommandMove&&(a=b.figure.getParent())&&"collapsed"==a.viewState)console.log("disable drop on collapsed"),
b.undo()}else a.isPreChangeEvent()};draw2d.ConnectionAnchor=function(a){this.owner=a};draw2d.ConnectionAnchor.prototype.type="draw2d.ConnectionAnchor";draw2d.ConnectionAnchor.prototype.getLocation=function(){return this.getReferencePoint()};draw2d.ConnectionAnchor.prototype.getOwner=function(){return this.owner};draw2d.ConnectionAnchor.prototype.setOwner=function(a){this.owner=a};draw2d.ConnectionAnchor.prototype.getBox=function(){return this.getOwner().getAbsoluteBounds()};
draw2d.ConnectionAnchor.prototype.getReferencePoint=function(){return null===this.getOwner()?null:this.getOwner().getAbsolutePosition()};draw2d.ChopboxConnectionAnchor=function(a){draw2d.ConnectionAnchor.call(this,a)};draw2d.ChopboxConnectionAnchor.prototype=new draw2d.ConnectionAnchor;draw2d.ChopboxConnectionAnchor.prototype.type="draw2d.ChopboxConnectionAnchor";
draw2d.ChopboxConnectionAnchor.prototype.getLocation=function(a){var b=new draw2d.Dimension;b.setBounds(this.getBox());b.translate(-1,-1);b.resize(1,1);var c=b.x+b.w/2,d=b.y+b.h/2;if(b.isEmpty()||a.x==c&&a.y==d)return new Point(c,d);var e=a.x-c,a=a.y-d,b=0.5/Math.max(Math.abs(e)/b.w,Math.abs(a)/b.h),d=d+a*b;return new draw2d.Point(Math.round(c+e*b),Math.round(d))};draw2d.ChopboxConnectionAnchor.prototype.getBox=function(){return this.getOwner().getParent().getBounds()};
draw2d.ChopboxConnectionAnchor.prototype.getReferencePoint=function(){return this.getBox().getCenter()};draw2d.ConnectionDecorator=function(){this.color=new draw2d.Color(0,0,0);this.backgroundColor=new draw2d.Color(250,250,250)};draw2d.ConnectionDecorator.prototype.type="draw2d.ConnectionDecorator";draw2d.ConnectionDecorator.prototype.paint=function(){};draw2d.ConnectionDecorator.prototype.setColor=function(a){this.color=a};
draw2d.ConnectionDecorator.prototype.setBackgroundColor=function(a){this.backgroundColor=a};draw2d.ArrowConnectionDecorator=function(a,b){draw2d.ConnectionDecorator.call(this);this.lenght=a||15;this.width=b||10};draw2d.ArrowConnectionDecorator.prototype=new draw2d.ConnectionDecorator;draw2d.ArrowConnectionDecorator.prototype.type="draw2d.ArrowConnectionDecorator";
draw2d.ArrowConnectionDecorator.prototype.paint=function(a){null!==this.backgroundColor&&(a.setColor(this.backgroundColor),a.fillPolygon([3,this.lenght,this.lenght,3],[0,this.width/2,-(this.width/2),0]));a.setColor(this.color);a.setStroke(1);a.drawPolygon([3,this.lenght,this.lenght,3],[0,this.width/2,-(this.width/2),0])};draw2d.ArrowConnectionDecorator.prototype.setDimension=function(a){this.width=w;this.lenght=a};
draw2d.bpmn.ArrowConnectionDecorator=function(){draw2d.ArrowConnectionDecorator.call(this,10,8);this.setColor(new draw2d.Color("#0076aa"));this.setBackgroundColor(new draw2d.Color("#0076aa"))};draw2d.bpmn.ArrowConnectionDecorator.prototype=new draw2d.ArrowConnectionDecorator;draw2d.ConnectionRouter=function(){};draw2d.ConnectionRouter.prototype.type="draw2d.ConnectionRouter";
draw2d.ConnectionRouter.prototype.getDirection=function(a,b){var c=Math.abs(a.x-b.x),d=3,e=Math.abs(a.y-b.y);e<=c&&(c=e,d=0);e=Math.abs(a.getBottom()-b.y);e<=c&&(c=e,d=2);e=Math.abs(a.getRight()-b.x);e<c&&(d=1);return d};draw2d.ConnectionRouter.prototype.getEndDirection=function(a){var b=a.getEndPoint();return this.getDirection(a.getTarget().getParent().getBounds(),b)};
draw2d.ConnectionRouter.prototype.getStartDirection=function(a){var b=a.getStartPoint();return this.getDirection(a.getSource().getParent().getBounds(),b)};draw2d.ConnectionRouter.prototype.route=function(){};draw2d.BezierConnectionRouter=function(a){this.cheapRouter=a?null:new draw2d.ManhattanConnectionRouter;this.iteration=5};draw2d.BezierConnectionRouter.prototype=new draw2d.ConnectionRouter;draw2d.BezierConnectionRouter.prototype.type="draw2d.BezierConnectionRouter";
draw2d.BezierConnectionRouter.prototype.drawBezier=function(a,b,c,d){for(var e=a.length-1,f=[],g=e+1,h=0;h<g;h++)f[h]=[],f[h][0]=a[h];for(a=1;a<=e;a++)for(h=0;h<=e-a;h++)f[h][a]=new draw2d.Point((1-c)*f[h][a-1].x+c*f[h+1][a-1].x,(1-c)*f[h][a-1].y+c*f[h+1][a-1].y);a=[];g=[];for(h=0;h<e+1;h++)a[h]=f[0][h],g[h]=f[h][e-h];if(0<=d)this.drawBezier(a,b,c,--d),this.drawBezier(g,b,c,--d);else for(h=0;h<e;h++)b.push(f[h][e-h])};
draw2d.BezierConnectionRouter.prototype.route=function(a){if(null!==this.cheapRouter&&(!0===a.getSource().getParent().isMoving||!0===a.getTarget().getParent().isMoving))this.cheapRouter.route(a);else{var b=[],c=a.getStartPoint(),d=a.getEndPoint();this._route(b,a,d,this.getEndDirection(a),c,this.getStartDirection(a));c=[];this.drawBezier(b,c,0.5,this.iteration);for(b=0;b<c.length;b++)a.addPoint(c[b]);a.addPoint(d)}};
draw2d.BezierConnectionRouter.prototype._route=function(a,b,c,d,e,f){var g=c.x-e.x,h=c.y-e.y,i,k;0.01>g*g&&0.01>h*h?a.push(new draw2d.Point(e.x,e.y)):(3===d?0<g&&0.1>h*h&&1===f?(i=e,k=f):(0>g?i=new draw2d.Point(c.x-90,c.y):0<h&&2===f||0>h&&0===f?i=new draw2d.Point(e.x,c.y):d===f?(d=Math.min(c.x,e.x)-90,i=new draw2d.Point(d,c.y)):i=new draw2d.Point(c.x-g/2,c.y),k=0<h?0:2):1===d?0>g&&0.1>h*h&&3==f?(i=e,k=f):(0<g?i=new draw2d.Point(c.x+90,c.y):0<h&&2===f||0>h&&0===f?i=new draw2d.Point(e.x,c.y):d===f?
(d=Math.max(c.x,e.x)+90,i=new draw2d.Point(d,c.y)):i=new draw2d.Point(c.x-g/2,c.y),k=0<h?0:2):2===d?0.1>g*g&&0>h&&0===f?(i=e,k=f):(0<h?i=new draw2d.Point(c.x,c.y+90):0<g&&1===f||0>g&&3===f?i=new draw2d.Point(c.x,e.y):d===f?(d=Math.max(c.y,e.y)+90,i=new draw2d.Point(c.x,d)):i=new draw2d.Point(c.x,c.y-h/2),k=0<g?3:1):0===d&&(0.1>g*g&&0<h&&2===f?(i=e,k=f):(0>h?i=new draw2d.Point(c.x,c.y-90):0<g&&1===f||0>g&&3===f?i=new draw2d.Point(c.x,e.y):d===f?(d=Math.min(c.y,e.y)-90,i=new draw2d.Point(c.x,d)):i=
new draw2d.Point(c.x,c.y-h/2),k=0<g?3:1)),this._route(a,b,i,k,e,f),a.push(c))};draw2d.ManhattanConnectionRouter=function(){this.MINDIST=20};draw2d.ManhattanConnectionRouter.prototype=new draw2d.ConnectionRouter;draw2d.ManhattanConnectionRouter.prototype.type="draw2d.ManhattanConnectionRouter";draw2d.ManhattanConnectionRouter.prototype.route=function(a){var b=a.getStartPoint(),c=this.getStartDirection(a),d=a.getEndPoint(),e=this.getEndDirection(a);this._route(a,d,e,b,c)};
draw2d.ManhattanConnectionRouter.prototype._route=function(a,b,c,d,e){var f=b.x-d.x,g=b.y-d.y,h,i;0.01>f*f&&0.01>g*g?a.addPoint(new draw2d.Point(d.x,d.y)):(3==c?0<f&&0.1>g*g&&1===e?(h=d,i=e):(0>f?h=new draw2d.Point(b.x-this.MINDIST,b.y):0<g&&2===e||0>g&&0==e?h=new draw2d.Point(d.x,b.y):c==e?(c=Math.min(b.x,d.x)-this.MINDIST,h=new draw2d.Point(c,b.y)):h=new draw2d.Point(b.x-f/2,b.y),i=0<g?0:2):1==c?0>f&&0.1>g*g&&3===e?(h=d,i=e):(0<f?h=new draw2d.Point(b.x+this.MINDIST,b.y):0<g&&2===e||0>g&&0===e?h=
new draw2d.Point(d.x,b.y):c==e?(c=Math.max(b.x,d.x)+this.MINDIST,h=new draw2d.Point(c,b.y)):h=new draw2d.Point(b.x-f/2,b.y),i=0<g?0:2):2==c?0.1>f*f&&0>g&&0==e?(h=d,i=e):(0<g?h=new draw2d.Point(b.x,b.y+this.MINDIST):0<f&&1===e||0>f&&3===e?h=new draw2d.Point(b.x,d.y):c===e?(c=Math.max(b.y,d.y)+this.MINDIST,h=new draw2d.Point(b.x,c)):h=new draw2d.Point(b.x,b.y-g/2),i=0<f?3:1):0==c&&(0.1>f*f&&0<g&&2===e?(h=d,i=e):(0>g?h=new draw2d.Point(b.x,b.y-this.MINDIST):0<f&&1===e||0>f&&3===e?h=new draw2d.Point(b.x,
d.y):c===e?(c=Math.min(b.y,d.y)-this.MINDIST,h=new draw2d.Point(b.x,c)):h=new draw2d.Point(b.x,b.y-g/2),i=0<f?3:1)),this._route(a,h,i,d,e),a.addPoint(b))};draw2d.NullConnectionRouter=function(){};draw2d.NullConnectionRouter.prototype=new draw2d.ConnectionRouter;draw2d.NullConnectionRouter.prototype.type="draw2d.NullConnectionRouter";draw2d.NullConnectionRouter.prototype.invalidate=function(){};draw2d.NullConnectionRouter.prototype.route=function(a){a.addPoint(a.getStartPoint());a.addPoint(a.getEndPoint())};
draw2d.FanConnectionRouter=function(){};draw2d.FanConnectionRouter.prototype=new draw2d.NullConnectionRouter;draw2d.FanConnectionRouter.prototype.type="draw2d.FanConnectionRouter";
draw2d.FanConnectionRouter.prototype.route=function(a){a.getStartPoint();a.getEndPoint();for(var b=a.getSource().getConnections(),c=new draw2d.ArrayList,d=0,e=0;e<b.getSize();e++){var f=b.get(e);if(f.getTarget()==a.getTarget()||f.getSource()==a.getTarget())c.add(f),a==f&&(d=c.getSize())}1<c.getSize()?this.routeCollision(a,d):draw2d.NullConnectionRouter.prototype.route.call(this,a)};draw2d.FanConnectionRouter.prototype.routeNormal=function(a){a.addPoint(a.getStartPoint());a.addPoint(a.getEndPoint())};
draw2d.FanConnectionRouter.prototype.routeCollision=function(a,b){var c=a.getStartPoint(),d=a.getEndPoint();a.addPoint(c);var e=new draw2d.Point((d.x+c.x)/2,(d.y+c.y)/2),f=d.getPosition(c),f=f==draw2d.PositionConstants.SOUTH||f==draw2d.PositionConstants.EAST?new draw2d.Point(d.x-c.x,d.y-c.y):new draw2d.Point(c.x-d.x,c.y-d.y),g=Math.sqrt(f.x*f.x+f.y*f.y),c=10*f.x/g,f=10*f.y/g,e=0===b%2?new draw2d.Point(e.x+b/2*-1*f,e.y+b/2*c):new draw2d.Point(e.x+b/2*f,e.y+b/2*-1*c);a.addPoint(e);a.addPoint(d)};
draw2d.AbstractPalettePart=function(){this.y=this.x=0;this.html=null};draw2d.AbstractPalettePart.prototype.type="draw2d.AbstractPalettePart";draw2d.AbstractPalettePart.prototype=new draw2d.Draggable;draw2d.AbstractPalettePart.prototype.createHTMLElement=function(){var a=document.createElement("div");a.id=this.id;a.style.position="absolute";a.style.height="24px";a.style.width="24px";return a};draw2d.AbstractPalettePart.prototype.setEnviroment=function(a,b){this.palette=b;this.workflow=a};
draw2d.AbstractPalettePart.prototype.getHTMLElement=function(){null===this.html&&(this.html=this.createHTMLElement(),draw2d.Draggable.call(this,this.html));return this.html};draw2d.AbstractPalettePart.prototype.onDrop=function(a,b){var c=this.workflow.getScrollLeft(),d=this.workflow.getScrollTop(),e=this.workflow.getAbsoluteX(),f=this.workflow.getAbsoluteY();this.setPosition(this.x,this.y);this.execute(a+c-e,b+d-f)};draw2d.AbstractPalettePart.prototype.execute=function(){alert("inerited class should override the method 'draw2d.AbstractPalettePart.prototype.execute'")};
draw2d.AbstractPalettePart.prototype.setTooltip=function(a){this.tooltip=a;this.html.title=null!==this.tooltip?this.tooltip:""};draw2d.AbstractPalettePart.prototype.setDimension=function(a,b){this.width=a;this.height=b;null!==this.html&&(this.html.style.width=this.width+"px",this.html.style.height=this.height+"px")};
draw2d.AbstractPalettePart.prototype.setPosition=function(a,b){this.x=Math.max(0,a);this.y=Math.max(0,b);null!==this.html&&(this.html.style.left=this.x+"px",this.html.style.top=this.y+"px",this.html.style.cursor="move")};draw2d.AbstractPalettePart.prototype.getWidth=function(){return this.width};draw2d.AbstractPalettePart.prototype.getHeight=function(){return this.height};draw2d.AbstractPalettePart.prototype.getY=function(){return this.y};draw2d.AbstractPalettePart.prototype.getX=function(){return this.x};
draw2d.AbstractPalettePart.prototype.getPosition=function(){return new draw2d.Point(this.x,this.y)};draw2d.AbstractPalettePart.prototype.disableTextSelection=function(a){"undefined"!=typeof a.onselectstart?a.onselectstart=function(){return!1}:"undefined"!=typeof a.style.MozUserSelect&&(a.style.MozUserSelect="none")};draw2d.Point=function(a,b){this.x=a;this.y=b};draw2d.Point.prototype.type="draw2d.Point";draw2d.Point.prototype.getX=function(){return this.x};draw2d.Point.prototype.getY=function(){return this.y};
draw2d.Point.prototype.getPosition=function(a){var b=a.x-this.x,a=a.y-this.y;return Math.abs(b)>Math.abs(a)?0>b?draw2d.PositionConstants.WEST:draw2d.PositionConstants.EAST:0>a?draw2d.PositionConstants.NORTH:draw2d.PositionConstants.SOUTH};draw2d.Point.prototype.equals=function(a){return this.x==a.x&&this.y==a.y};draw2d.Point.prototype.getDistance=function(a){return Math.sqrt((this.x-a.x)*(this.x-a.x)+(this.y-a.y)*(this.y-a.y))};
draw2d.Point.prototype.getTranslated=function(a){return new draw2d.Point(this.x+a.x,this.y+a.y)};draw2d.Point.prototype.getPersistentAttributes=function(){return{x:this.x,y:this.y}};draw2d.Figure=function(){this.construct()};draw2d.Figure.prototype.type="draw2d.Figure";draw2d.Figure.ZOrderBaseIndex=100;draw2d.Figure.setZOrderBaseIndex=function(a){draw2d.Figure.ZOrderBaseIndex=a};
draw2d.Figure.prototype.construct=function(){this.y=this.x=this.lastDragStartTime=0;this.height=this.width=10;this.border=null;this.id=draw2d.UUID.create();this.html=this.createHTMLElement();this.parent=this.draggable=this.workflow=this.canvas=null;this.isMoving=!1;this.canSnapToHelper=!0;this.snapToGridAnchor=new draw2d.Point(0,0);this.timer=-1;this.model=null;this.alphaBeforeOnDrag=this.alpha=1;this.properties={};this.moveListener=new draw2d.ArrayList;this.setDimension(this.width,this.height);this.setDeleteable(!0);
this.setCanDrag(!0);this.setResizeable(!0);this.setSelectable(!0)};
draw2d.Figure.prototype.dispose=function(){this.moveListener=this.workflow=this.canvas=null;null!==this.draggable&&(this.draggable.removeEventListener("mouseenter",this.tmpMouseEnter),this.draggable.removeEventListener("mouseleave",this.tmpMouseLeave),this.draggable.removeEventListener("dragend",this.tmpDragend),this.draggable.removeEventListener("dragstart",this.tmpDragstart),this.draggable.removeEventListener("drag",this.tmpDrag),this.draggable.removeEventListener("dblclick",this.tmpDoubleClick),
this.draggable.node=null,this.draggable.target.removeAllElements());this.draggable=null;null!==this.border&&this.border.dispose();this.border=null;null!==this.parent&&this.parent.removeChild(this)};draw2d.Figure.prototype.getProperties=function(){return this.properties};draw2d.Figure.prototype.getProperty=function(a){return this.properties[a]};draw2d.Figure.prototype.setProperty=function(a,b){this.properties[a]=b;this.setDocumentDirty()};draw2d.Figure.prototype.getId=function(){return this.id};
draw2d.Figure.prototype.setId=function(a){this.id=a;null!==this.html&&(this.html.id=a)};draw2d.Figure.prototype.setCanvas=function(a){this.canvas=a};draw2d.Figure.prototype.getWorkflow=function(){return this.workflow};
draw2d.Figure.prototype.setWorkflow=function(a){if(null===this.draggable){this.html.tabIndex="0";var b=this;this.keyDown=function(a){a.cancelBubble=!0;a.returnValue=!0;b.onKeyDown(a.keyCode,a.ctrlKey)};this.html.addEventListener?this.html.addEventListener("keydown",this.keyDown,!1):this.html.attachEvent&&this.html.attachEvent("onkeydown",this.keyDown);this.draggable=new draw2d.Draggable(this.html,draw2d.Draggable.DRAG_X|draw2d.Draggable.DRAG_Y);this.draggable.node=this;this.tmpContextMenu=function(a){b.onContextMenu(b.x+
a.x,a.y+b.y)};this.tmpMouseEnter=function(){b.onMouseEnter()};this.tmpMouseLeave=function(){b.onMouseLeave()};this.tmpDragend=function(){b.onDragend()};this.tmpDragstart=function(a){var d=b.workflow;d.showMenu(null);if(d.toolPalette&&d.toolPalette.activeTool)a.returnValue=!1,d.onMouseDown(b.x+a.x,a.y+b.y),d.onMouseUp(b.x+a.x,a.y+b.y);else{if(!(b instanceof draw2d.ResizeHandle)&&!(b instanceof draw2d.Port)){var e=d.getBestLine(b.x+a.x,a.y+b.y);if(null!==e){a.returnValue=!1;d.setCurrentSelection(e);
d.showLineResizeHandles(e);d.onMouseDown(b.x+a.x,a.y+b.y);return}b.isSelectable()&&(d.showResizeHandles(b),d.setCurrentSelection(b))}a.returnValue=b.onDragstart(a.x,a.y)}};this.tmpDrag=function(){b.onDrag()};this.tmpDoubleClick=function(){b.onDoubleClick()};this.draggable.addEventListener("contextmenu",this.tmpContextMenu);this.draggable.addEventListener("mouseenter",this.tmpMouseEnter);this.draggable.addEventListener("mouseleave",this.tmpMouseLeave);this.draggable.addEventListener("dragend",this.tmpDragend);
this.draggable.addEventListener("dragstart",this.tmpDragstart);this.draggable.addEventListener("drag",this.tmpDrag);this.draggable.addEventListener("dblclick",this.tmpDoubleClick)}this.workflow=a};
draw2d.Figure.prototype.createHTMLElement=function(){var a=document.createElement("div");a.id=this.id;a.style.position="absolute";a.style.left=this.x+"px";a.style.top=this.y+"px";a.style.height=this.width+"px";a.style.width=this.height+"px";a.style.margin="0px";a.style.padding="0px";a.style.outline="none";a.style.zIndex=""+draw2d.Figure.ZOrderBaseIndex;return a};draw2d.Figure.prototype.setParent=function(a){this.parent=a};draw2d.Figure.prototype.getParent=function(){return this.parent};
draw2d.Figure.prototype.getZOrder=function(){return this.html.style.zIndex};draw2d.Figure.prototype.setZOrder=function(a){this.html.style.zIndex=a};draw2d.Figure.prototype.hasFixedPosition=function(){return!1};draw2d.Figure.prototype.getMinWidth=function(){return 5};draw2d.Figure.prototype.getMinHeight=function(){return 5};draw2d.Figure.prototype.getHTMLElement=function(){null===this.html&&(this.html=this.createHTMLElement());return this.html};draw2d.Figure.prototype.paint=function(){};
draw2d.Figure.prototype.setBorder=function(a){null!==this.border&&(this.border.figure=null);this.border=a;this.border.figure=this;this.border.refresh();this.setDocumentDirty()};draw2d.Figure.prototype.onRemove=function(){};draw2d.Figure.prototype.onContextMenu=function(a,b){var c=this.getContextMenu();null!==c&&this.workflow.showMenu(c,a,b)};draw2d.Figure.prototype.getContextMenu=function(){return null};draw2d.Figure.prototype.onDoubleClick=function(){};draw2d.Figure.prototype.onMouseEnter=function(){};
draw2d.Figure.prototype.onMouseLeave=function(){};draw2d.Figure.prototype.onDrag=function(){this.x=this.draggable.getLeft();this.y=this.draggable.getTop();!1==this.isMoving&&(this.isMoving=!0,this.alphaBeforeOnDrag=this.getAlpha(),this.setAlpha(0.5*this.alphaBeforeOnDrag));this.fireMoveEvent()};
draw2d.Figure.prototype.onDragend=function(){if(!0===this.getWorkflow().getEnableSmoothFigureHandling()){var a=this;0<a.timer&&window.clearInterval(a.timer);a.timer=window.setInterval(function(){a.alpha<a.alphaBeforeOnDrag?a.setAlpha(Math.min(1,a.alpha+0.05)):(window.clearInterval(a.timer),a.timer=-1)},20)}else this.setAlpha(this.alphaBeforeOnDrag);this.command.setPosition(this.x,this.y);this.workflow.commandStack.execute(this.command);this.command=null;this.isMoving=!1;this.workflow.hideSnapToHelperLines();
this.fireMoveEvent()};draw2d.Figure.prototype.onDragstart=function(){this.command=this.createCommand(new draw2d.EditPolicy(draw2d.EditPolicy.MOVE));return null!==this.command};draw2d.Figure.prototype.setCanDrag=function(a){this.canDrag=a;this.html.style.cursor=a?"move":""};draw2d.Figure.prototype.getCanDrag=function(){return this.canDrag};
draw2d.Figure.prototype.setAlpha=function(a){this.alpha!==a&&(this.alpha=Math.max(0,Math.min(1,a)),1==this.alpha?(this.html.style.filter="",this.html.style.opacity=""):(this.html.style.filter="alpha(opacity="+Math.round(100*this.alpha)+")",this.html.style.opacity=this.alpha))};draw2d.Figure.prototype.getAlpha=function(){return this.alpha};
draw2d.Figure.prototype.setDimension=function(a,b){this.width=Math.max(this.getMinWidth(),a);this.height=Math.max(this.getMinHeight(),b);null!==this.html&&(this.html.style.width=this.width+"px",this.html.style.height=this.height+"px",this.fireMoveEvent(),null!==this.workflow&&this.workflow.getCurrentSelection()==this&&this.workflow.showResizeHandles(this))};
draw2d.Figure.prototype.setPosition=function(a,b){this.x=a;this.y=b;null!==this.html&&(this.html.style.left=this.x+"px",this.html.style.top=this.y+"px",this.fireMoveEvent(),null!==this.workflow&&this.workflow.getCurrentSelection()==this&&this.workflow.showResizeHandles(this))};draw2d.Figure.prototype.isResizeable=function(){return this.resizeable};draw2d.Figure.prototype.setResizeable=function(a){this.resizeable=a};draw2d.Figure.prototype.isSelectable=function(){return this.selectable};
draw2d.Figure.prototype.setSelectable=function(a){this.selectable=a};draw2d.Figure.prototype.isStrechable=function(){return!0};draw2d.Figure.prototype.isDeleteable=function(){return this.deleteable};draw2d.Figure.prototype.setDeleteable=function(a){this.deleteable=a};draw2d.Figure.prototype.setCanSnapToHelper=function(a){this.canSnapToHelper=a};draw2d.Figure.prototype.getCanSnapToHelper=function(){return this.canSnapToHelper};draw2d.Figure.prototype.getSnapToGridAnchor=function(){return this.snapToGridAnchor};
draw2d.Figure.prototype.setSnapToGridAnchor=function(a){this.snapToGridAnchor=a};draw2d.Figure.prototype.getBounds=function(){return new draw2d.Dimension(this.getX(),this.getY(),this.getWidth(),this.getHeight())};draw2d.Figure.prototype.getWidth=function(){return this.width};draw2d.Figure.prototype.getHeight=function(){return this.height};draw2d.Figure.prototype.getY=function(){return this.y};draw2d.Figure.prototype.getX=function(){return this.x};draw2d.Figure.prototype.getAbsoluteY=function(){return this.y};
draw2d.Figure.prototype.getAbsoluteX=function(){return this.x};draw2d.Figure.prototype.onKeyDown=function(a,b){46==a&&this.workflow.getCommandStack().execute(this.createCommand(new draw2d.EditPolicy(draw2d.EditPolicy.DELETE)));if(b)this.workflow.onKeyDown(a,b)};draw2d.Figure.prototype.getPosition=function(){return new draw2d.Point(this.x,this.y)};
draw2d.Figure.prototype.isOver=function(a,b){var c=this.getAbsoluteX(),d=this.getAbsoluteY(),e=c+this.width,f=d+this.height;return a>=c&&a<=e&&b>=d&&b<=f};draw2d.Figure.prototype.attachMoveListener=function(a){null===a||null===this.moveListener||this.moveListener.add(a)};draw2d.Figure.prototype.detachMoveListener=function(a){null===a||null===this.moveListener||this.moveListener.remove(a)};
draw2d.Figure.prototype.fireMoveEvent=function(){this.setDocumentDirty();for(var a=this.moveListener.getSize(),b=0;b<a;b++)this.moveListener.get(b).onOtherFigureMoved(this)};draw2d.Figure.prototype.setModel=function(a){null!==this.model&&this.model.removePropertyChangeListener(this);this.model=a;null!==this.model&&this.model.addPropertyChangeListener(this)};draw2d.Figure.prototype.getModel=function(){return this.model};draw2d.Figure.prototype.onOtherFigureMoved=function(){};
draw2d.Figure.prototype.setDocumentDirty=function(){null!==this.workflow&&this.workflow.setDocumentDirty()};draw2d.Figure.prototype.disableTextSelection=function(a){a.onselectstart=function(){return!1};a.unselectable="on";a.className+=" unselectable";a.onmousedown=function(){return!1}};
draw2d.Figure.prototype.createCommand=function(a){return a.getPolicy()==draw2d.EditPolicy.MOVE?!this.canDrag?null:new draw2d.CommandMove(this):a.getPolicy()==draw2d.EditPolicy.DELETE?!this.isDeleteable()?null:new draw2d.CommandDelete(this):a.getPolicy()==draw2d.EditPolicy.RESIZE?!this.isResizeable()?null:new draw2d.CommandResize(this):null};
draw2d.Annotation=function(a){this.msg=a;this.alpha=1;this.color=new draw2d.Color(0,0,0);this.bgColor=new draw2d.Color(241,241,121);this.fontSize=10;this.textNode=null;draw2d.Figure.call(this)};draw2d.Annotation.prototype=new draw2d.Figure;draw2d.Annotation.prototype.type="draw2d.Annotation";
draw2d.Annotation.prototype.createHTMLElement=function(){var a=draw2d.Figure.prototype.createHTMLElement.call(this);a.style.color=this.color.getHTMLStyle();a.style.backgroundColor=this.bgColor.getHTMLStyle();a.style.fontSize=this.fontSize+"pt";a.style.width="auto";a.style.height="auto";a.style.margin="0px";a.style.padding="0px";a.onselectstart=function(){return!1};a.unselectable="on";a.style.cursor="default";this.textNode=document.createTextNode(this.msg);a.appendChild(this.textNode);this.disableTextSelection(a);
return a};draw2d.Annotation.prototype.onDoubleClick=function(){this.workflow.showDialog(new draw2d.AnnotationDialog(this))};draw2d.Annotation.prototype.setBackgroundColor=function(a){this.bgColor=a;this.html.style.backgroundColor=null!==this.bgColor?this.bgColor.getHTMLStyle():"transparent"};draw2d.Annotation.prototype.getBackgroundColor=function(){return this.bgColor};draw2d.Annotation.prototype.setFontSize=function(a){this.fontSize=a;this.html.style.fontSize=this.fontSize+"pt"};
draw2d.Annotation.prototype.getText=function(){return this.msg};draw2d.Annotation.prototype.setText=function(a){this.msg=a;this.html.removeChild(this.textNode);this.textNode=document.createTextNode(this.msg);this.html.appendChild(this.textNode)};draw2d.Annotation.prototype.setStyledText=function(a){this.msg=a;this.html.removeChild(this.textNode);this.textNode=document.createElement("div");this.textNode.innerHTML=a;this.html.appendChild(this.textNode)};
draw2d.Label=function(a){this.msg=a;this.bgColor=null;this.color=new draw2d.Color(0,0,0);this.fontSize=10;this.textNode=null;this.align="center";draw2d.Figure.call(this)};draw2d.Label.prototype=new draw2d.Figure;draw2d.Label.prototype.type="draw2d.Label";
draw2d.Label.prototype.createHTMLElement=function(){var a=draw2d.Figure.prototype.createHTMLElement.call(this);this.textNode=document.createTextNode(this.msg);a.appendChild(this.textNode);a.style.color=this.color.getHTMLStyle();a.style.fontSize=this.fontSize+"pt";a.style.width="auto";a.style.height="auto";a.style.paddingLeft="3px";a.style.paddingRight="3px";a.style.textAlign=this.align;a.style.MozUserSelect="none";this.disableTextSelection(a);null!==this.bgColor&&(a.style.backgroundColor=this.bgColor.getHTMLStyle());
return a};draw2d.Label.prototype.isResizeable=function(){return!1};draw2d.Label.prototype.setWordwrap=function(a){this.html.style.whiteSpace=a?"wrap":"nowrap"};draw2d.Label.prototype.setAlign=function(a){this.align=a;this.html.style.textAlign=a};draw2d.Label.prototype.setBackgroundColor=function(a){this.bgColor=a;this.html.style.backgroundColor=null!==this.bgColor?this.bgColor.getHTMLStyle():"transparent"};draw2d.Label.prototype.setColor=function(a){this.color=a;this.html.style.color=this.color.getHTMLStyle()};
draw2d.Label.prototype.setFontSize=function(a){this.fontSize=a;this.html.style.fontSize=this.fontSize+"pt"};draw2d.Label.prototype.setDimension=function(){};draw2d.Label.prototype.getWidth=function(){return window.getComputedStyle?parseInt(getComputedStyle(this.html,"").getPropertyValue("width")):parseInt(this.html.clientWidth)};draw2d.Label.prototype.getHeight=function(){return window.getComputedStyle?parseInt(getComputedStyle(this.html,"").getPropertyValue("height")):parseInt(this.html.clientHeight)};
draw2d.Label.prototype.getText=function(){return this.msg};draw2d.Label.prototype.setText=function(a){this.msg=a;this.html.removeChild(this.textNode);this.textNode=document.createTextNode(this.msg);this.html.appendChild(this.textNode)};draw2d.Label.prototype.setStyledText=function(a){this.msg=a;this.html.removeChild(this.textNode);this.textNode=document.createElement("div");this.textNode.style.whiteSpace="nowrap";this.textNode.innerHTML=a;this.html.appendChild(this.textNode)};
draw2d.Menu=function(){this.menuItems=new draw2d.ArrayList;draw2d.Figure.call(this);this.setSelectable(!1);this.setDeleteable(!1);this.setCanDrag(!1);this.setResizeable(!1);this.setSelectable(!1);this.setZOrder(1E4);this.dirty=!1};draw2d.Menu.prototype=new draw2d.Figure;draw2d.Menu.prototype.type="draw2d.Menu";
draw2d.Menu.prototype.createHTMLElement=function(){var a=document.createElement("div");a.style.position="absolute";a.style.left=this.x+"px";a.style.top=this.y+"px";a.style.margin="0px";a.style.padding="0px";a.style.zIndex=""+draw2d.Figure.ZOrderBaseIndex;a.style.border="1px solid gray";a.style.background="lavender";a.style.cursor="pointer";a.style.width="auto";a.style.height="auto";a.style.boxShadow="5px 5px 5px #ccc";a.style.borderRadius="2px";a.className="Menu";return a};
draw2d.Menu.prototype.setWorkflow=function(a){this.workflow=a};draw2d.Menu.prototype.setDimension=function(){};draw2d.Menu.prototype.appendMenuItem=function(a){this.menuItems.add(a);a.parentMenu=this;this.dirty=!0};draw2d.Menu.prototype.getHTMLElement=function(){var a=draw2d.Figure.prototype.getHTMLElement.call(this);this.dirty&&this.createList();return a};
draw2d.Menu.prototype.createList=function(){this.dirty=!1;this.html.innerHTML="";for(var a=0;a<this.menuItems.getSize();a++){var b=this.menuItems.get(a),c=document.createElement("a");c.innerHTML=b.getLabel();c.style.display="block";c.style.fontFamily="Verdana, Arial, Helvetica, sans-serif";c.style.fontSize="9pt";c.style.color="dimgray";c.style.borderBottom="1px solid silver";c.style.paddingLeft="5px";c.style.paddingRight="5px";c.style.whiteSpace="nowrap";c.style.cursor="pointer";c.className="MenuItem";
this.html.appendChild(c);c.menuItem=b;c.addEventListener?(c.addEventListener("click",function(a){a=a||window.event;a.cancelBubble=!0;a.returnValue=!1;this.menuItem.execute(a.clientX+document.body.parentNode.scrollLeft,a.clientY+document.body.parentNode.scrollTop)},!1),c.addEventListener("mouseup",function(a){a.cancelBubble=!0;a.returnValue=!1},!1),c.addEventListener("mousedown",function(a){a.cancelBubble=!0;a.returnValue=!1},!1),c.addEventListener("mouseover",function(){this.style.backgroundColor=
"silver"},!1),c.addEventListener("mouseout",function(){this.style.backgroundColor="transparent"},!1)):c.attachEvent&&(c.attachEvent("onclick",function(a){var b=a||window.event;b.cancelBubble=!0;b.returnValue=!1;a.srcElement.menuItem.execute(b.clientX+document.body.parentNode.scrollLeft,b.clientY+document.body.parentNode.scrollTop)}),c.attachEvent("onmousedown",function(a){a.cancelBubble=!0;a.returnValue=!1}),c.attachEvent("onmouseup",function(a){a.cancelBubble=!0;a.returnValue=!1}),c.attachEvent("onmouseover",
function(a){a.srcElement.style.backgroundColor="silver"}),c.attachEvent("onmouseout",function(a){a.srcElement.style.backgroundColor="transparent"}))}};draw2d.Node=function(){this.bgColor=null;this.lineColor=new draw2d.Color(128,128,255);this.lineStroke=1;this.ports=new draw2d.ArrayList;draw2d.Figure.call(this)};draw2d.Node.prototype=new draw2d.Figure;draw2d.Node.prototype.type="draw2d.Node";
draw2d.Node.prototype.dispose=function(){for(var a=0;a<this.ports.getSize();a++)this.ports.get(a).dispose();this.ports=null;draw2d.Figure.prototype.dispose.call(this)};
draw2d.Node.prototype.createHTMLElement=function(){var a=draw2d.Figure.prototype.createHTMLElement.call(this);a.style.width="auto";a.style.height="auto";a.style.margin="0px";a.style.padding="0px";null!==this.lineColor&&(a.style.border=this.lineStroke+"px solid "+this.lineColor.getHTMLStyle());a.style.fontSize="1px";null!==this.bgColor&&(a.style.backgroundColor=this.bgColor.getHTMLStyle());return a};draw2d.Node.prototype.paint=function(){draw2d.Figure.prototype.paint.call(this);for(var a=0;a<this.ports.getSize();a++)this.ports.get(a).paint()};
draw2d.Node.prototype.getPorts=function(){return this.ports};draw2d.Node.prototype.getInputPorts=function(){for(var a=new draw2d.ArrayList,b=0;b<this.ports.getSize();b++){var c=this.ports.get(b);c instanceof draw2d.InputPort&&a.add(c)}return a};draw2d.Node.prototype.getOutputPorts=function(){for(var a=new draw2d.ArrayList,b=0;b<this.ports.getSize();b++){var c=this.ports.get(b);c instanceof draw2d.OutputPort&&a.add(c)}return a};
draw2d.Node.prototype.getPort=function(a){if(null===this.ports)return null;for(var b=0;b<this.ports.getSize();b++){var c=this.ports.get(b);if(c.getName()==a)return c}};draw2d.Node.prototype.getInputPort=function(a){if(null===this.ports)return null;for(var b=0;b<this.ports.getSize();b++){var c=this.ports.get(b);if(c.getName()==a&&c instanceof draw2d.InputPort)return c}};
draw2d.Node.prototype.getOutputPort=function(a){if(null===this.ports)return null;for(var b=0;b<this.ports.getSize();b++){var c=this.ports.get(b);if(c.getName()==a&&c instanceof draw2d.OutputPort)return c}};draw2d.Node.prototype.addPort=function(a,b,c){this.ports.add(a);a.setOrigin(b,c);a.setPosition(b,c);a.setParent(this);a.setDeleteable(!1);this.html.appendChild(a.getHTMLElement());null!==this.workflow&&this.workflow.registerPort(a)};
draw2d.Node.prototype.removePort=function(a){null!==this.ports&&this.ports.remove(a);try{this.html.removeChild(a.getHTMLElement())}catch(b){}null!==this.workflow&&this.workflow.unregisterPort(a);for(var a=a.getConnections(),c=0;c<a.getSize();++c)this.workflow.removeFigure(a.get(c))};
draw2d.Node.prototype.setWorkflow=function(a){var b=this.workflow;draw2d.Figure.prototype.setWorkflow.call(this,a);if(null!==b)for(a=0;a<this.ports.getSize();a++)b.unregisterPort(this.ports.get(a));if(null!==this.workflow)for(a=0;a<this.ports.getSize();a++)this.workflow.registerPort(this.ports.get(a))};draw2d.Node.prototype.setBackgroundColor=function(a){this.bgColor=a;this.html.style.backgroundColor=null!==this.bgColor?this.bgColor.getHTMLStyle():"transparent"};
draw2d.Node.prototype.getBackgroundColor=function(){return this.bgColor};draw2d.Node.prototype.setColor=function(a){this.lineColor=a;this.html.style.border=null!==this.lineColor?this.lineStroke+"px solid "+this.lineColor.getHTMLStyle():"0px"};draw2d.Node.prototype.setLineWidth=function(a){this.lineStroke=a;this.html.style.border=null!==this.lineColor?this.lineStroke+"px solid "+this.lineColor.getHTMLStyle():"0px"};
draw2d.Node.prototype.getModelSourceConnections=function(){throw"You must override the method [Node.prototype.getModelSourceConnections]";};draw2d.Node.prototype.refreshConnections=function(){null!==this.workflow&&this.workflow.refreshConnections(this)};
draw2d.CompartmentFigure=function(){draw2d.Node.call(this);this.children=new draw2d.ArrayList;this.setBorder(new draw2d.LineBorder(1));this.dropable=new draw2d.DropTarget(this.html);this.dropable.node=this;this.dropable.addEventListener("figureenter",function(a){a.target.node.onFigureEnter(a.relatedTarget.node)});this.dropable.addEventListener("figureleave",function(a){a.target.node.onFigureLeave(a.relatedTarget.node)});this.dropable.addEventListener("figuredrop",function(a){a.target.node.onFigureDrop(a.relatedTarget.node)})};
draw2d.CompartmentFigure.prototype=new draw2d.Node;draw2d.CompartmentFigure.prototype.type="draw2d.CompartmentFigure";draw2d.CompartmentFigure.prototype.onFigureEnter=function(){};draw2d.CompartmentFigure.prototype.onFigureLeave=function(){};draw2d.CompartmentFigure.prototype.onFigureDrop=function(){};draw2d.CompartmentFigure.prototype.getChildren=function(){return this.children};draw2d.CompartmentFigure.prototype.addChild=function(a){a.setZOrder(parseInt(this.getZOrder())+2);a.setParent(this);this.children.add(a)};
draw2d.CompartmentFigure.prototype.removeChild=function(a){a.setParent(null);this.children.remove(a)};draw2d.CompartmentFigure.prototype.setZOrder=function(a){draw2d.Node.prototype.setZOrder.call(this,a);for(var b=0;b<this.children.getSize();b++)this.children.get(b).setZOrder(a+2)};
draw2d.CompartmentFigure.prototype.setPosition=function(a,b){var c=this.getX(),d=this.getY();draw2d.Node.prototype.setPosition.call(this,a,b);for(var e=0;e<this.children.getSize();e++){var f=this.children.get(e);f.setPosition(f.getX()+this.getX()-c,f.getY()+this.getY()-d)}};
draw2d.CompartmentFigure.prototype.onDrag=function(){var a=this.getX(),b=this.getY();draw2d.Node.prototype.onDrag.call(this);for(var c=0;c<this.children.getSize();c++){var d=this.children.get(c);d.setPosition(d.getX()+this.getX()-a,d.getY()+this.getY()-b)}};
draw2d.bpmn.Activity=function(){this.inputPort=[null,null,null];this.outputPort=[null,null,null];this.viewState="simple";this.originalWidth=this.originalHeight=0;draw2d.CompartmentFigure.call(this);this.setLineWidth(0);this.setDimension(this.defaultWidth,this.defaultHeight);draw2d.bpmn.initInstance(this);var a=this.getContentElement();a&&this.initEditableContent(a)};draw2d.bpmn.Activity.prototype=new draw2d.CompartmentFigure;draw2d.bpmn.Activity.prototype.type="bpmn.Activity";
draw2d.bpmn.Activity.prototype.defaultWidth=140;draw2d.bpmn.Activity.prototype.defaultHeight=60;
draw2d.bpmn.Activity.prototype.createHTMLElement=function(){var a=TeamTime.jQuery,b=this,c=draw2d.Figure.prototype.createHTMLElement.call(this);a(c).html('<div class="bpmn_activity simple_activity">\t\t\t<div class="bpmn_linked_process_icon" src="linked_process_icon.gif"></div>\t\t\t<div class="bpmn_content_hidden">\t\t\t\t<div class="bpmn_activity_container">\t\t\t\t\t<span class="bpmn_activity_content">Activity</span>\t\t\t\t\t<span class="bpmn_activity_iefix">&nbsp;</span>\t\t\t\t</div>\t\t\t</div>\t\t\t<div class="bpmn_collapse_icon"></div>\t\t\t<div class="bpmn_activity_backlight" style="display:none;"></div>\t\t\t<div class="bpmn_activity_aditional_info" style="display:none;"></div>\t\t</div>');a(".bpmn_collapse_icon",
c).click(function(){b.toggle(b)});return c};
draw2d.bpmn.Activity.prototype.setViewState=function(a){var b=TeamTime.jQuery,c="",d="";this.viewState=a;a=parseInt(this.getZOrder());"collapsed"==this.viewState?(b(".bpmn_activity",this.html).removeClass("simple_activity").removeClass("subprocess_expanded_activity").addClass("subprocess_collapsed_activity"),c="expand_icon.gif",a>draw2d.Figure.ZOrderBaseIndex&&b(".bpmn_activity",this.html).parent().css("z-index",a-1)):"expanded"==this.viewState?(b(".bpmn_activity",this.html).removeClass("simple_activity").removeClass("subprocess_collapsed_activity").addClass("subprocess_expanded_activity"),
c="collapse_icon.gif",b(".bpmn_activity",this.html).parent().css("z-index",a+1)):"linked"==this.viewState?(d="linked_process_icon.gif",b(".bpmn_activity",this.html).removeClass("subprocess_collapsed_activity").removeClass("subprocess_expanded_activity").addClass("simple_activity").addClass("linked_process")):(b(".bpmn_activity",this.html).addClass("simple_activity"),c="");b(".bpmn_collapse_icon",this.html).css("background-image",draw2d.bpmn.getCssImage(c));b(".bpmn_linked_process_icon",this.html).css("background-image",
draw2d.bpmn.getCssImage(d))};draw2d.bpmn.Activity.prototype.setViewMode=function(a,b){var c=a.getChildren().getSize(),d;if("collapsed"==b){for(d=0;d<c;d++)a.getChildren().get(d).setVisibility(!1);a.originalWidth=a.width;a.originalHeight=a.height;a.setViewState("collapsed");a.setDimension(a.defaultWidth,a.defaultHeight)}else if("expanded"==b){a.setViewState("expanded");a.setDimension(a.originalWidth,a.originalHeight);for(d=0;d<c;d++)a.getChildren().get(d).setVisibility(!0)}};
draw2d.bpmn.Activity.prototype.toggle=function(a){"expanded"==a.viewState?a.setViewMode(a,"collapsed"):"collapsed"==a.viewState&&a.setViewMode(a,"expanded")};
draw2d.bpmn.Activity.prototype.showInfo=function(a,b){var c=TeamTime.jQuery,d="",e="";if("status"==a)c(".bpmn_activity_backlight",this.html).hide(),e="defaut",""!=b.state&&(e=b.state,d=b.part),c(".bpmn_activity_aditional_info",this.html).removeClass("bpmn_activity_error").removeClass("bpmn_activity_done").removeClass("bpmn_activity_done-part").addClass("bpmn_activity_"+e).html(d).show();else{c(".bpmn_activity_aditional_info",this.html).hide();switch(a){case "date":e=b.date;d='<div class="bpmn_activity_logo bpmn_activity_date-logo"></div>\t\t\t\t<div class="bpmn_activity_title">'+
e+"</div>";break;case "time":case "plan":"time"==a?e=b.fact+" / "+b.plan:(a="time",e=b.plan+" \u0447\u0435\u043b-\u0447\u0430\u0441\u043e\u0432");d='<div class="bpmn_activity_logo bpmn_activity_time-logo"></div>\t\t\t\t<div class="bpmn_activity_title">'+e+"</div>";break;case "price":e=b.price+"  \u0440\u0443\u0431.";d='<div class="bpmn_activity_logo bpmn_activity_price-logo"></div>\t\t\t\t<div class="bpmn_activity_title bpmn_activity_title-price">'+e+"</div>";break;case "performer":e=b.userName;d=
'<div class="bpmn_activity_logo bpmn_activity_performer-logo"></div>\t\t\t\t<div class="bpmn_activity_title">'+e+"</div>";break;default:a="default",d=""}c(".bpmn_activity_backlight",this.html).removeClass("bpmn_activity_date").removeClass("bpmn_activity_time").removeClass("bpmn_activity_price").removeClass("bpmn_activity_performer").addClass("bpmn_activity_"+a).html(d).show()}};
draw2d.bpmn.Activity.prototype.setWorkflow=function(a){draw2d.CompartmentFigure.prototype.setWorkflow.call(this,a);draw2d.bpmn.addConextMenu(this);this.setViewState("simple");null!==a&&null===this.inputPort[0]&&(this.inputPort[0]=new draw2d.bpmn.InputPort,this.inputPort[0].setWorkflow(a),this.inputPort[0].setName("input"),this.addPort(this.inputPort[0],0,this.height/2));null!==a&&null===this.inputPort[1]&&(this.inputPort[1]=new draw2d.bpmn.InputPort,this.inputPort[1].setWorkflow(a),this.inputPort[1].setName("input1"),
this.addPort(this.inputPort[1],20,0));null!==a&&null===this.inputPort[2]&&(this.inputPort[2]=new draw2d.bpmn.InputPort,this.inputPort[2].setWorkflow(a),this.inputPort[2].setName("input2"),this.addPort(this.inputPort[2],20,this.height));null!==a&&null===this.outputPort[0]&&(this.outputPort[0]=new draw2d.bpmn.OutputPort,this.outputPort[0].setMaxFanOut(5),this.outputPort[0].setWorkflow(a),this.outputPort[0].setName("output"),this.addPort(this.outputPort[0],this.width,this.height/2));null!==a&&null===
this.outputPort[1]&&(this.outputPort[1]=new draw2d.bpmn.OutputPort,this.outputPort[1].setMaxFanOut(5),this.outputPort[1].setWorkflow(a),this.outputPort[1].setName("output1"),this.addPort(this.outputPort[1],this.width-20,0));null!==a&&null===this.outputPort[2]&&(this.outputPort[2]=new draw2d.bpmn.OutputPort,this.outputPort[2].setMaxFanOut(5),this.outputPort[2].setWorkflow(a),this.outputPort[2].setName("output2"),this.addPort(this.outputPort[2],this.width-20,this.height))};
draw2d.bpmn.Activity.prototype.setDimension=function(a,b){var c=TeamTime.jQuery;draw2d.CompartmentFigure.prototype.setDimension.call(this,a,b);var d=c(".bpmn_activity",this.html);c(d).css("width",a).css("height",b);c(".bpmn_content_hidden",this.html).css("width",a-6).css("height",b-6);d=this.getContentElement();c(d).css("margin-top",0);null!==this.outputPort[0]&&this.outputPort[0].setPosition(this.width,this.height/2);null!==this.outputPort[1]&&this.outputPort[1].setPosition(this.width-20,0);null!==
this.outputPort[2]&&this.outputPort[2].setPosition(this.width-20,this.height);null!==this.inputPort[0]&&this.inputPort[0].setPosition(0,this.height/2);null!==this.inputPort[1]&&this.inputPort[1].setPosition(20,0);null!==this.inputPort[2]&&this.inputPort[2].setPosition(20,this.height)};draw2d.bpmn.Activity.prototype.onDragstart=function(a,b){draw2d.bpmn.onDragstart(this);return draw2d.CompartmentFigure.prototype.onDragstart.call(this,a,b)};
draw2d.bpmn.Activity.prototype.onDragend=function(){draw2d.CompartmentFigure.prototype.onDragend.call(this);draw2d.bpmn.onDragend(this)};draw2d.bpmn.Activity.prototype.onDrag=function(){draw2d.CompartmentFigure.prototype.onDrag.call(this);draw2d.bpmn.onDrag(this)};draw2d.bpmn.Activity.prototype.setVisibility=function(a){draw2d.bpmn.setVisibility(this,a)};draw2d.bpmn.Activity.prototype.isSubProcess=function(){return"simple"!=this.viewState};
draw2d.bpmn.Activity.prototype.makeSubProcess=function(a){this.setViewState("expanded");this.setDimension(300,140);var b,c,d=new draw2d.bpmn.Start;c=this.getY()+this.height/2-d.getHeight()/2;this.workflow.addFigure(d,this.getX()+10,c);draw2d.CompartmentFigure.prototype.addChild.call(this,d);var e=new draw2d.bpmn.End;this.workflow.addFigure(e,this.getX()+this.getWidth()-e.getWidth()-10,c);draw2d.CompartmentFigure.prototype.addChild.call(this,e);null==a&&(e.setPosition(this.getX()+this.getWidth()-e.getWidth()-
10,e.getY()),a=new draw2d.bpmn.Activity,this.workflow.addFigure(a,this.getX()+50,this.getY()+30),draw2d.CompartmentFigure.prototype.addChild.call(this,a));b=this.getX()+this.width/2-a.getWidth()/2;c=this.getY()+this.height/2-a.getHeight()/2;a.setPosition(b,c);b=new draw2d.bpmn.Connection;b.setSource(d.getPort("output"));b.setTarget(a.getPort("input"));this.workflow.addFigure(b);b=new draw2d.bpmn.Connection;b.setSource(a.getPort("output"));b.setTarget(e.getPort("input"));this.workflow.addFigure(b)};
draw2d.bpmn.Activity.prototype.isConnectedWith=function(a){var b=[];_.each(this.getPorts().asArray(),function(a){_.each(a.getConnections().asArray(),function(a){b.push(a)})});var c=[];_.each(a.getPorts().asArray(),function(a){_.each(a.getConnections().asArray(),function(a){c.push(a)})});for(var d,e=b.length,f=c.length,g=!1,a=0;a<e;a++){for(d=0;d<f;d++)if(b[a]==c[d]){g=!0;break}if(g)break}return g};
draw2d.bpmn.Activity.prototype.onFigureDrop=function(a){if(!this.isSubProcess()){var b=a.type;b&&!(0>b.toString().indexOf("bpmn."))&&("bpmn.InputPort"==b||"bpmn.OutputPort"==b||this.isConnectedWith(a)||this.makeSubProcess(a))}};draw2d.bpmn.Activity.prototype.getContextMenuItems=function(){var a={};"linked"==this.viewState?a.linkto={name:i18n.bpmn.item_linkto,icon:"edit"}:a.details={name:i18n.bpmn.item_details,icon:"edit"};a["delete"]={name:i18n.bpmn.delete_item,icon:"delete"};return a};
draw2d.bpmn.Activity.prototype.onContextMenuCmd=function(a){var b=TeamTime.jQuery,c=draw2d.bpmn.getSwimlanePanel(),d="",e=purl().param("is_template");"delete"==a.key?(new draw2d.CommandDelete(a.figure)).execute():"details"==a.key?(d=c.getTitle(b(a.figure.getParentRow()),"row"),d=TeamTime.getUrlForController()+"&tmpl=component&view=processdetails&id="+a.figure.id+"&process_id="+purl().param("id")+"&role="+d,"undefined"!=typeof e&&(d+="&is_template="+e),a.figure.paramsData&&a.figure.paramsData._id&&
(d+="&_id="+a.figure.paramsData._id),(a=a.figure.getParent())&&a.paramsData&&a.paramsData._id&&(d+="&_parent_id="+a.paramsData._id),console.log(d),parent.TeamTime.jQuery.fancybox({href:d,type:"iframe",width:800,autoSize:!1,padding:1,openEffect:"none",closeEffect:"none",helpers:{overlay:{css:{background:"rgba(0, 0, 0, 0.4)"}}}})):"linkto"==a.key&&(d=TeamTime.getUrlForController()+"&tmpl=component&view=processlinkto&id="+a.figure.id+"&process_id="+purl().param("id"),"undefined"==typeof e&&parent.TeamTime.jQuery.fancybox({href:d,
type:"iframe",width:440,height:472,autoSize:!1,scrolling:"no",padding:1,openEffect:"none",closeEffect:"none",helpers:{overlay:{css:{background:"rgba(0, 0, 0, 0.4)"}}}}))};draw2d.bpmn.Activity.prototype.getContentElement=function(){var a=TeamTime.jQuery;return a(".bpmn_activity_content",this.html)};draw2d.bpmn.Activity.prototype.getText=function(){var a=TeamTime.jQuery,b=this.getContentElement();return!b?"":a(b).text()};
draw2d.bpmn.Activity.prototype.setText=function(a){var b=TeamTime.jQuery,c=this.getContentElement();c&&b(c).text(a)};draw2d.bpmn.Activity.prototype.isContentEditable=function(){var a=TeamTime.jQuery;return a(this.getContentElement()).attr("contentEditable")};draw2d.bpmn.Activity.prototype.setContentEditable=function(a){var b=TeamTime.jQuery,c=this.getContentElement();c&&(a?b(c).attr("contentEditable","true").focus():b(c).removeAttr("contentEditable"))};
draw2d.bpmn.Activity.prototype.initEditableContent=function(a){var b=TeamTime.jQuery,c=this;b(a).blur(function(){c.setContentEditable(!1);c.setDimension(c.width,c.height)})};draw2d.bpmn.Activity.prototype.onDoubleClick=function(){this.setContentEditable(!0);draw2d.bpmn.selectText(this)};draw2d.bpmn.Activity.prototype.onKeyDown=function(a,b){this.isContentEditable()||draw2d.CompartmentFigure.prototype.onKeyDown.call(this,a,b)};
draw2d.bpmn.Activity.prototype.getParentRow=function(){return this.getParent()?this.getParent().getParentRow():this.parentRow};draw2d.bpmn.Activity.prototype.getParentCol=function(){return this.getParent()?this.getParent().getParentCol():this.parentCol};draw2d.ImageFigure=function(a){void 0===a&&(a=null);this.url=a;draw2d.Node.call(this);this.setDimension(40,40)};draw2d.ImageFigure.prototype=new draw2d.Node;draw2d.ImageFigure.prototype.type="draw2d.Image";
draw2d.ImageFigure.prototype.createHTMLElement=function(){var a=draw2d.Node.prototype.createHTMLElement.call(this);a.style.width=this.width+"px";a.style.height=this.height+"px";a.style.margin="0px";a.style.padding="0px";a.style.border="0px";a.style.backgroundImage=null!==this.url?"url("+this.url+")":"";return a};draw2d.ImageFigure.prototype.setColor=function(){};draw2d.ImageFigure.prototype.isResizeable=function(){return!1};
draw2d.ImageFigure.prototype.setImage=function(a){void 0===a&&(a=null);this.url=a;this.html.style.backgroundImage=null!==this.url?"url("+this.url+")":""};draw2d.SVGFigure=function(a,b){this.bgColor=null;this.lineColor=new draw2d.Color(0,0,0);this.stroke=1;this.context=null;draw2d.Node.call(this);a&&b&&this.setDimension(a,b)};draw2d.SVGFigure.prototype=new draw2d.Node;draw2d.SVGFigure.prototype.type="draw2d.SVGFigure";
draw2d.SVGFigure.prototype.createHTMLElement=function(){var a=new MooCanvas(this.id,{width:100,height:100});a.style.position="absolute";a.style.left=this.x+"px";a.style.top=this.y+"px";a.style.zIndex=""+draw2d.Figure.ZOrderBaseIndex;this.context=a.getContext("2d");return a};draw2d.SVGFigure.prototype.paint=function(){this.context.clearRect(0,0,this.getWidth(),this.getHeight());this.context.fillStyle="rgba(200,0,0,0.3)";this.context.fillRect(0,0,this.getWidth(),this.getHeight())};
draw2d.SVGFigure.prototype.setDimension=function(a,b){draw2d.Node.prototype.setDimension.call(this,a,b);this.html.width=a;this.html.height=b;this.html.style.width=a+"px";this.html.style.height=b+"px";null!==this.context&&(this.context.element&&(this.context.element.style.width=a+"px",this.context.element.style.height=b+"px"),this.paint())};draw2d.SVGFigure.prototype.setBackgroundColor=function(a){this.bgColor=a;null!==this.graphics&&this.paint()};draw2d.SVGFigure.prototype.getBackgroundColor=function(){return this.bgColor};
draw2d.SVGFigure.prototype.setLineWidth=function(a){this.stroke=a;null!==this.context&&this.paint()};draw2d.SVGFigure.prototype.setColor=function(a){this.lineColor=a;null!==this.context&&this.paint()};draw2d.SVGFigure.prototype.getColor=function(){return this.lineColor};draw2d.VectorFigure=function(){this.bgColor=null;this.lineColor=new draw2d.Color(0,0,0);this.stroke=1;this.graphics=null;draw2d.Node.call(this)};draw2d.VectorFigure.prototype=new draw2d.Node;draw2d.VectorFigure.prototype.type="draw2d.VectorFigure";
draw2d.VectorFigure.prototype.dispose=function(){draw2d.Node.prototype.dispose.call(this);this.lineColor=this.bgColor=null;null!==this.graphics&&this.graphics.clear();this.graphics=null};draw2d.VectorFigure.prototype.createHTMLElement=function(){var a=draw2d.Node.prototype.createHTMLElement.call(this);a.style.border="0px";a.style.backgroundColor="transparent";return a};
draw2d.VectorFigure.prototype.setWorkflow=function(a){draw2d.Node.prototype.setWorkflow.call(this,a);null===this.workflow&&(this.graphics.clear(),this.graphics=null)};
draw2d.VectorFigure.prototype.paint=function(){if(null!==this.html)try{null===this.graphics?this.graphics=new jsGraphics(this.html):this.graphics.clear();draw2d.Node.prototype.paint.call(this);for(var a=0;a<this.ports.getSize();a++)this.getHTMLElement().appendChild(this.ports.get(a).getHTMLElement())}catch(b){pushErrorStack(b,"draw2d.VectorFigure.prototype.paint=function()["+area+"]")}};
draw2d.VectorFigure.prototype.setDimension=function(a,b){draw2d.Node.prototype.setDimension.call(this,a,b);null!==this.graphics&&this.paint()};draw2d.VectorFigure.prototype.setBackgroundColor=function(a){this.bgColor=a;null!==this.graphics&&this.paint()};draw2d.VectorFigure.prototype.getBackgroundColor=function(){return this.bgColor};draw2d.VectorFigure.prototype.setLineWidth=function(a){this.stroke=a;null!==this.graphics&&this.paint()};
draw2d.VectorFigure.prototype.setColor=function(a){this.lineColor=a;null!==this.graphics&&this.paint()};draw2d.VectorFigure.prototype.getColor=function(){return this.lineColor};draw2d.Oval=function(){draw2d.VectorFigure.call(this)};draw2d.Oval.prototype=new draw2d.VectorFigure;draw2d.Oval.prototype.type="draw2d.Oval";
draw2d.Oval.prototype.paint=function(){if(null!==this.html)try{draw2d.VectorFigure.prototype.paint.call(this),this.graphics.setStroke(this.stroke),null!==this.bgColor&&(this.graphics.setColor(this.bgColor.getHTMLStyle()),this.graphics.fillOval(0,0,this.getWidth()-1,this.getHeight()-1)),null!==this.lineColor&&(this.graphics.setColor(this.lineColor.getHTMLStyle()),this.graphics.drawOval(0,0,this.getWidth()-1,this.getHeight()-1)),this.graphics.paint()}catch(a){pushErrorStack(a,"draw2d.Oval.prototype.paint=function()")}};
draw2d.Circle=function(a){draw2d.Oval.call(this);a&&this.setDimension(a,a)};draw2d.Circle.prototype=new draw2d.Oval;draw2d.Circle.prototype.type="draw2d.Circle";draw2d.Circle.prototype.setDimension=function(a,b){a>b?draw2d.Oval.prototype.setDimension.call(this,a,a):draw2d.Oval.prototype.setDimension.call(this,b,b)};draw2d.Circle.prototype.isStrechable=function(){return!1};
draw2d.bpmn.Figure=function(){draw2d.Node.call(this);this.setDimension(40,40);draw2d.bpmn.initInstance(this);var a=this.getContentElement();a&&this.initEditableContent(a)};draw2d.bpmn.Figure.prototype=new draw2d.Node;draw2d.bpmn.Figure.prototype.isResizeable=function(){return!1};draw2d.bpmn.Figure.prototype.onDragstart=function(a,b){draw2d.bpmn.onDragstart(this);return draw2d.Node.prototype.onDragstart.call(this,a,b)};
draw2d.bpmn.Figure.prototype.onDragend=function(){draw2d.Node.prototype.onDragend.call(this);draw2d.bpmn.onDragend(this)};draw2d.bpmn.Figure.prototype.onDrag=function(){draw2d.Node.prototype.onDrag.call(this);draw2d.bpmn.onDrag(this)};draw2d.bpmn.Figure.prototype.setVisibility=function(a){draw2d.bpmn.setVisibility(this,a)};draw2d.bpmn.Figure.prototype.getContentElement=function(){return null};
draw2d.bpmn.Figure.prototype.getText=function(){var a=TeamTime.jQuery,b=this.getContentElement();return!b?"":a(b).text()};draw2d.bpmn.Figure.prototype.setText=function(a){var b=TeamTime.jQuery,c=this.getContentElement();c&&b(c).text(a)};draw2d.bpmn.Figure.prototype.isContentEditable=function(){var a=TeamTime.jQuery;return a(this.getContentElement()).attr("contentEditable")};
draw2d.bpmn.Figure.prototype.setContentEditable=function(a){var b=TeamTime.jQuery,c=this.getContentElement();c&&(a?b(c).attr("contentEditable","true").focus():b(c).removeAttr("contentEditable"))};draw2d.bpmn.Figure.prototype.initEditableContent=function(a){var b=TeamTime.jQuery,c=this;b(a).blur(function(){c.setContentEditable(!1)})};draw2d.bpmn.Figure.prototype.onDoubleClick=function(){this.setContentEditable(!0);draw2d.bpmn.selectText(this)};
draw2d.bpmn.Figure.prototype.onKeyDown=function(a,b){this.isContentEditable()||draw2d.Node.prototype.onKeyDown.call(this,a,b)};draw2d.bpmn.Figure.prototype.getParentRow=function(){return this.getParent()?this.getParent().getParentRow():this.parentRow};draw2d.bpmn.Figure.prototype.getParentCol=function(){return this.getParent()?this.getParent().getParentCol():this.parentCol};draw2d.bpmn.ConditionAND=function(){draw2d.bpmn.Figure.call(this);this.inputPort=[null,null];this.outputPort=[null,null]};
draw2d.bpmn.ConditionAND.prototype=new draw2d.bpmn.Figure;draw2d.bpmn.ConditionAND.prototype.type="bpmn.ConditionAND";draw2d.bpmn.ConditionAND.prototype.createHTMLElement=function(){var a=TeamTime.jQuery,b=draw2d.Figure.prototype.createHTMLElement.call(this);a(b).html("<div class='bpmn_condition_and'>\t\t\t<div class='bpmn_icon'></div>\t\t\t<div class='bpmn_event_content'>AND</div>\t\t</div>");a(".bpmn_icon",b).css("background-image",draw2d.bpmn.getCssImage("condition_and.gif"));return b};
draw2d.bpmn.ConditionAND.prototype.setWorkflow=function(a){draw2d.bpmn.Figure.prototype.setWorkflow.call(this,a);draw2d.bpmn.addConextMenu(this);null!==a&&null===this.inputPort[0]&&(this.inputPort[0]=new draw2d.bpmn.InputPort,this.inputPort[0].setWorkflow(a),this.inputPort[0].setName("input"),this.addPort(this.inputPort[0],0,this.height/2));null!==a&&null===this.inputPort[1]&&(this.inputPort[1]=new draw2d.bpmn.InputPort,this.inputPort[1].setWorkflow(a),this.inputPort[1].setName("input1"),this.addPort(this.inputPort[1],
this.width/2,0));null!==a&&null===this.outputPort[0]&&(this.outputPort[0]=new draw2d.bpmn.OutputPort,this.outputPort[0].setWorkflow(a),this.outputPort[0].setName("output"),this.addPort(this.outputPort[0],this.width,this.height/2));null!==a&&null===this.outputPort[1]&&(this.outputPort[1]=new draw2d.bpmn.OutputPort,this.outputPort[1].setWorkflow(a),this.outputPort[1].setName("output1"),this.addPort(this.outputPort[1],this.width/2,this.height))};
draw2d.bpmn.ConditionAND.prototype.getContentElement=function(){var a=TeamTime.jQuery;return a(".bpmn_event_content",this.html)};draw2d.bpmn.ConditionAND.prototype.getContextMenuItems=function(){return{"delete":{name:i18n.bpmn.delete_item,icon:"delete"}}};draw2d.bpmn.ConditionAND.prototype.onContextMenuCmd=function(a){"delete"==a.key&&(new draw2d.CommandDelete(a.figure)).execute();console.log("ConditionAND "+a.key)};
draw2d.bpmn.ConditionOR=function(){draw2d.bpmn.Figure.call(this);this.inputPort=[null,null];this.outputPort=[null,null]};draw2d.bpmn.ConditionOR.prototype=new draw2d.bpmn.Figure;draw2d.bpmn.ConditionOR.prototype.type="bpmn.ConditionOR";
draw2d.bpmn.ConditionOR.prototype.createHTMLElement=function(){var a=TeamTime.jQuery,b=draw2d.Figure.prototype.createHTMLElement.call(this);a(b).html("<div class='bpmn_condition_or'>\t\t\t<div class='bpmn_icon'></div>\t\t\t<div class='bpmn_event_content'>OR</div>\t\t</div>");a(".bpmn_icon",b).css("background-image",draw2d.bpmn.getCssImage("condition_or.gif"));return b};
draw2d.bpmn.ConditionOR.prototype.setWorkflow=function(a){draw2d.bpmn.Figure.prototype.setWorkflow.call(this,a);draw2d.bpmn.addConextMenu(this);null!==a&&null===this.inputPort[0]&&(this.inputPort[0]=new draw2d.bpmn.InputPort,this.inputPort[0].setWorkflow(a),this.inputPort[0].setName("input"),this.addPort(this.inputPort[0],0,this.height/2));null!==a&&null===this.inputPort[1]&&(this.inputPort[1]=new draw2d.bpmn.InputPort,this.inputPort[1].setWorkflow(a),this.inputPort[1].setName("input1"),this.addPort(this.inputPort[1],
this.width/2,0));null!==a&&null===this.outputPort[0]&&(this.outputPort[0]=new draw2d.bpmn.OutputPort,this.outputPort[0].setWorkflow(a),this.outputPort[0].setName("output"),this.addPort(this.outputPort[0],this.width,this.height/2));null!==a&&null===this.outputPort[1]&&(this.outputPort[1]=new draw2d.bpmn.OutputPort,this.outputPort[1].setWorkflow(a),this.outputPort[1].setName("output1"),this.addPort(this.outputPort[1],this.width/2,this.height))};
draw2d.bpmn.ConditionOR.prototype.getContentElement=function(){var a=TeamTime.jQuery;return a(".bpmn_event_content",this.html)};draw2d.bpmn.ConditionOR.prototype.getContextMenuItems=function(){return{"delete":{name:i18n.bpmn.delete_item,icon:"delete"}}};draw2d.bpmn.ConditionOR.prototype.onContextMenuCmd=function(a){"delete"==a.key&&(new draw2d.CommandDelete(a.figure)).execute();console.log("ConditionOR "+a.key)};
draw2d.bpmn.ConditionXOR=function(){draw2d.bpmn.Figure.call(this);this.inputPort=[null,null];this.outputPort=[null,null]};draw2d.bpmn.ConditionXOR.prototype=new draw2d.bpmn.Figure;draw2d.bpmn.ConditionXOR.prototype.type="bpmn.ConditionXOR";
draw2d.bpmn.ConditionXOR.prototype.createHTMLElement=function(){var a=TeamTime.jQuery,b=draw2d.Figure.prototype.createHTMLElement.call(this);a(b).html("<div class='bpmn_condition_xor'>\t\t\t<div class='bpmn_icon'></div>\t\t\t<div class='bpmn_event_content'>XOR</div>\t\t</div>");a(".bpmn_icon",b).css("background-image",draw2d.bpmn.getCssImage("condition_xor.gif"));return b};
draw2d.bpmn.ConditionXOR.prototype.setWorkflow=function(a){draw2d.bpmn.Figure.prototype.setWorkflow.call(this,a);draw2d.bpmn.addConextMenu(this);null!==a&&null===this.inputPort[0]&&(this.inputPort[0]=new draw2d.bpmn.InputPort,this.inputPort[0].setWorkflow(a),this.inputPort[0].setName("input"),this.addPort(this.inputPort[0],0,this.height/2));null!==a&&null===this.inputPort[1]&&(this.inputPort[1]=new draw2d.bpmn.InputPort,this.inputPort[1].setWorkflow(a),this.inputPort[1].setName("input1"),this.addPort(this.inputPort[1],
this.width/2,0));null!==a&&null===this.outputPort[0]&&(this.outputPort[0]=new draw2d.bpmn.OutputPort,this.outputPort[0].setWorkflow(a),this.outputPort[0].setName("output"),this.addPort(this.outputPort[0],this.width,this.height/2));null!==a&&null===this.outputPort[1]&&(this.outputPort[1]=new draw2d.bpmn.OutputPort,this.outputPort[1].setWorkflow(a),this.outputPort[1].setName("output1"),this.addPort(this.outputPort[1],this.width/2,this.height))};
draw2d.bpmn.ConditionXOR.prototype.getContentElement=function(){var a=TeamTime.jQuery;return a(".bpmn_event_content",this.html)};draw2d.bpmn.ConditionXOR.prototype.getContextMenuItems=function(){return{"delete":{name:i18n.bpmn.delete_item,icon:"delete"}}};draw2d.bpmn.ConditionXOR.prototype.onContextMenuCmd=function(a){"delete"==a.key&&(new draw2d.CommandDelete(a.figure)).execute();console.log("ConditionXOR "+a.key)};
draw2d.bpmn.End=function(){draw2d.bpmn.Figure.call(this);this.inputPort=[null,null,null];this.setDimension(40,40)};draw2d.bpmn.End.prototype=new draw2d.bpmn.Figure;draw2d.bpmn.End.prototype.type="bpmn.End";draw2d.bpmn.End.prototype.createHTMLElement=function(){var a=TeamTime.jQuery,b=draw2d.Figure.prototype.createHTMLElement.call(this);a(b).html('<div class="bpmn_end">\t\t\t<div class="bpmn_end_content">End</div>\t\t</div>');return b};
draw2d.bpmn.End.prototype.setWorkflow=function(a){draw2d.bpmn.Figure.prototype.setWorkflow.call(this,a);draw2d.bpmn.addConextMenu(this);null!==a&&null===this.inputPort[0]&&(this.inputPort[0]=new draw2d.bpmn.InputPort,this.inputPort[0].setWorkflow(a),this.inputPort[0].setName("input"),this.addPort(this.inputPort[0],0,this.height/2));null!==a&&null===this.inputPort[1]&&(this.inputPort[1]=new draw2d.bpmn.InputPort,this.inputPort[1].setWorkflow(a),this.inputPort[1].setName("input1"),this.addPort(this.inputPort[1],
this.width/2,0));null!==a&&null===this.inputPort[2]&&(this.inputPort[2]=new draw2d.bpmn.InputPort,this.inputPort[2].setWorkflow(a),this.inputPort[2].setName("input2"),this.addPort(this.inputPort[2],this.width/2,this.height))};draw2d.bpmn.End.prototype.getContextMenuItems=function(){return{"delete":{name:i18n.bpmn.delete_item,icon:"delete"}}};draw2d.bpmn.End.prototype.onContextMenuCmd=function(a){"delete"==a.key&&(new draw2d.CommandDelete(a.figure)).execute();console.log("end "+a.key)};
draw2d.bpmn.Exception=function(){draw2d.bpmn.Figure.call(this);this.inputPort=[null,null];this.outputPort=[null,null]};draw2d.bpmn.Exception.prototype=new draw2d.bpmn.Figure;draw2d.bpmn.Exception.prototype.type="bpmn.Exception";
draw2d.bpmn.Exception.prototype.createHTMLElement=function(){var a=TeamTime.jQuery,b=draw2d.Figure.prototype.createHTMLElement.call(this);a(b).html('<div class="bpmn_exception">\t\t\t<div class="bpmn_icon"></div>\t\t\t<div class="bpmn_event_content">Exception</div>\t\t</div>');a(".bpmn_icon",b).css("background-image",draw2d.bpmn.getCssImage("exception.png"));return b};
draw2d.bpmn.Exception.prototype.setWorkflow=function(a){draw2d.bpmn.Figure.prototype.setWorkflow.call(this,a);draw2d.bpmn.addConextMenu(this);null!==a&&null===this.inputPort[0]&&(this.inputPort[0]=new draw2d.bpmn.InputPort,this.inputPort[0].setWorkflow(a),this.inputPort[0].setName("input"),this.addPort(this.inputPort[0],0,this.height/2));null!==a&&null===this.inputPort[1]&&(this.inputPort[1]=new draw2d.bpmn.InputPort,this.inputPort[1].setWorkflow(a),this.inputPort[1].setName("input1"),this.addPort(this.inputPort[1],
this.width/2,0));null!==a&&null===this.outputPort[0]&&(this.outputPort[0]=new draw2d.bpmn.OutputPort,this.outputPort[0].setWorkflow(a),this.outputPort[0].setName("output"),this.addPort(this.outputPort[0],this.width,this.height/2));null!==a&&null===this.outputPort[1]&&(this.outputPort[1]=new draw2d.bpmn.OutputPort,this.outputPort[1].setWorkflow(a),this.outputPort[1].setName("output1"),this.addPort(this.outputPort[1],this.width/2,this.height))};
draw2d.bpmn.Exception.prototype.getContentElement=function(){var a=TeamTime.jQuery;return a(".bpmn_event_content",this.html)};draw2d.bpmn.Exception.prototype.getContextMenuItems=function(){return{"delete":{name:i18n.bpmn.delete_item,icon:"delete"}}};draw2d.bpmn.Exception.prototype.onContextMenuCmd=function(a){"delete"==a.key&&(new draw2d.CommandDelete(a.figure)).execute();console.log("Exception "+a.key)};
draw2d.bpmn.Message=function(){draw2d.bpmn.Figure.call(this);this.inputPort=[null,null];this.outputPort=[null,null]};draw2d.bpmn.Message.prototype=new draw2d.bpmn.Figure;draw2d.bpmn.Message.prototype.type="bpmn.Message";
draw2d.bpmn.Message.prototype.createHTMLElement=function(){var a=TeamTime.jQuery,b=draw2d.Figure.prototype.createHTMLElement.call(this);a(b).html('<div class="bpmn_message">\t\t\t<div class="bpmn_icon"></div>\t\t\t<div class="bpmn_event_content">Message</div>\t\t</div>');a(".bpmn_icon",b).css("background-image",draw2d.bpmn.getCssImage("message.png"));return b};
draw2d.bpmn.Message.prototype.setWorkflow=function(a){draw2d.bpmn.Figure.prototype.setWorkflow.call(this,a);draw2d.bpmn.addConextMenu(this);null!==a&&null===this.inputPort[0]&&(this.inputPort[0]=new draw2d.bpmn.InputPort,this.inputPort[0].setWorkflow(a),this.inputPort[0].setName("input"),this.addPort(this.inputPort[0],0,this.height/2));null!==a&&null===this.inputPort[1]&&(this.inputPort[1]=new draw2d.bpmn.InputPort,this.inputPort[1].setWorkflow(a),this.inputPort[1].setName("input1"),this.addPort(this.inputPort[1],
this.width/2,0));null!==a&&null===this.outputPort[0]&&(this.outputPort[0]=new draw2d.bpmn.OutputPort,this.outputPort[0].setWorkflow(a),this.outputPort[0].setName("output"),this.addPort(this.outputPort[0],this.width,this.height/2));null!==a&&null===this.outputPort[1]&&(this.outputPort[1]=new draw2d.bpmn.OutputPort,this.outputPort[1].setWorkflow(a),this.outputPort[1].setName("output1"),this.addPort(this.outputPort[1],this.width/2,this.height))};
draw2d.bpmn.Message.prototype.getContentElement=function(){var a=TeamTime.jQuery;return a(".bpmn_event_content",this.html)};draw2d.bpmn.Message.prototype.getContextMenuItems=function(){return{"delete":{name:i18n.bpmn.delete_item,icon:"delete"}}};draw2d.bpmn.Message.prototype.onContextMenuCmd=function(a){"delete"==a.key&&(new draw2d.CommandDelete(a.figure)).execute();console.log("Message "+a.key)};
draw2d.bpmn.Start=function(){draw2d.bpmn.Figure.call(this);this.outputPort=null;this.setDimension(40,40)};draw2d.bpmn.Start.prototype=new draw2d.bpmn.Figure;draw2d.bpmn.Start.prototype.type="bpmn.Start";draw2d.bpmn.Start.prototype.createHTMLElement=function(){var a=TeamTime.jQuery,b=draw2d.Figure.prototype.createHTMLElement.call(this);a(b).html('<div class="bpmn_start">\t\t\t<div class="bpmn_start_content">Start</div>\t\t</div>');return b};
draw2d.bpmn.Start.prototype.setWorkflow=function(a){draw2d.bpmn.Figure.prototype.setWorkflow.call(this,a);draw2d.bpmn.addConextMenu(this);null!==a&&null===this.outputPort&&(this.outputPort=new draw2d.bpmn.OutputPort,this.outputPort.setMaxFanOut(5),this.outputPort.setWorkflow(a),this.outputPort.setName("output"),this.addPort(this.outputPort,this.width,this.height/2))};draw2d.bpmn.Start.prototype.getContextMenuItems=function(){return{"delete":{name:i18n.bpmn.delete_item,icon:"delete"}}};
draw2d.bpmn.Start.prototype.onContextMenuCmd=function(a){"delete"==a.key&&(new draw2d.CommandDelete(a.figure)).execute();console.log("start "+a.key)};draw2d.bpmn.Timer=function(){draw2d.bpmn.Figure.call(this);this.inputPort=[null,null];this.outputPort=[null,null]};draw2d.bpmn.Timer.prototype=new draw2d.bpmn.Figure;draw2d.bpmn.Timer.prototype.type="bpmn.Timer";
draw2d.bpmn.Timer.prototype.createHTMLElement=function(){var a=TeamTime.jQuery,b=draw2d.Figure.prototype.createHTMLElement.call(this);a(b).html('<div class="bpmn_timer">\t\t\t<div class="bpmn_icon"></div>\t\t\t<div class="bpmn_event_content">Timer</div>\t\t</div>');a(".bpmn_icon",b).css("background-image",draw2d.bpmn.getCssImage("timer.png"));return b};
draw2d.bpmn.Timer.prototype.setWorkflow=function(a){draw2d.bpmn.Figure.prototype.setWorkflow.call(this,a);draw2d.bpmn.addConextMenu(this);null!==a&&null===this.inputPort[0]&&(this.inputPort[0]=new draw2d.bpmn.InputPort,this.inputPort[0].setWorkflow(a),this.inputPort[0].setName("input"),this.addPort(this.inputPort[0],0,this.height/2));null!==a&&null===this.inputPort[1]&&(this.inputPort[1]=new draw2d.bpmn.InputPort,this.inputPort[1].setWorkflow(a),this.inputPort[1].setName("input1"),this.addPort(this.inputPort[1],
this.width/2,0));null!==a&&null===this.outputPort[0]&&(this.outputPort[0]=new draw2d.bpmn.OutputPort,this.outputPort[0].setWorkflow(a),this.outputPort[0].setName("output"),this.addPort(this.outputPort[0],this.width,this.height/2));null!==a&&null===this.outputPort[1]&&(this.outputPort[1]=new draw2d.bpmn.OutputPort,this.outputPort[1].setWorkflow(a),this.outputPort[1].setName("output1"),this.addPort(this.outputPort[1],this.width/2,this.height))};
draw2d.bpmn.Timer.prototype.getContentElement=function(){var a=TeamTime.jQuery;return a(".bpmn_event_content",this.html)};draw2d.bpmn.Timer.prototype.getContextMenuItems=function(){return{"delete":{name:i18n.bpmn.delete_item,icon:"delete"}}};draw2d.bpmn.Timer.prototype.onContextMenuCmd=function(a){"delete"==a.key&&(new draw2d.CommandDelete(a.figure)).execute();console.log("Timer "+a.key)};
draw2d.Rectangle=function(a,b){this.bgColor=null;this.lineColor=new draw2d.Color(0,0,0);this.lineStroke=1;draw2d.Figure.call(this);a&&b&&this.setDimension(a,b)};draw2d.Rectangle.prototype=new draw2d.Figure;draw2d.Rectangle.prototype.type="draw2d.Rectangle";draw2d.Rectangle.prototype.dispose=function(){draw2d.Figure.prototype.dispose.call(this);this.lineColor=this.bgColor=null};
draw2d.Rectangle.prototype.createHTMLElement=function(){var a=draw2d.Figure.prototype.createHTMLElement.call(this);a.style.width="auto";a.style.height="auto";a.style.margin="0px";a.style.padding="0px";a.style.border=this.lineStroke+"px solid "+this.lineColor.getHTMLStyle();a.style.fontSize="1px";a.style.lineHeight="1px";a.innerHTML="&nbsp";null!==this.bgColor&&(a.style.backgroundColor=this.bgColor.getHTMLStyle());return a};
draw2d.Rectangle.prototype.setBackgroundColor=function(a){this.bgColor=a;this.html.style.backgroundColor=null!==this.bgColor?this.bgColor.getHTMLStyle():"transparent"};draw2d.Rectangle.prototype.getBackgroundColor=function(){return this.bgColor};draw2d.Rectangle.prototype.setColor=function(a){this.lineColor=a;this.html.style.border=null!==this.lineColor?this.lineStroke+"px solid "+this.lineColor.getHTMLStyle():this.lineStroke+"0px"};draw2d.Rectangle.prototype.getColor=function(){return this.lineColor};
draw2d.Rectangle.prototype.getWidth=function(){return draw2d.Figure.prototype.getWidth.call(this)+2*this.lineStroke};draw2d.Rectangle.prototype.getHeight=function(){return draw2d.Figure.prototype.getHeight.call(this)+2*this.lineStroke};draw2d.Rectangle.prototype.setDimension=function(a,b){draw2d.Figure.prototype.setDimension.call(this,a-2*this.lineStroke,b-2*this.lineStroke)};
draw2d.Rectangle.prototype.setLineWidth=function(a){var b=a-this.lineStroke;this.setDimension(this.getWidth()-2*b,this.getHeight()-2*b);this.lineStroke=a;a="transparent";null!==this.lineColor&&(a=this.lineColor.getHTMLStyle());this.html.style.border=this.lineStroke+"px solid "+a};draw2d.Rectangle.prototype.getLineWidth=function(){return this.lineStroke};
draw2d.Port=function(a,b){Corona=function(){};Corona.prototype=new draw2d.Circle;Corona.prototype.setAlpha=function(a){draw2d.Circle.prototype.setAlpha.call(this,Math.min(0.3,a));this.setDeleteable(!1);this.setCanDrag(!1);this.setResizeable(!1);this.setSelectable(!1)};this.currentUIRepresentation=null===a||void 0===a?new draw2d.Circle:a;null===b||void 0===b?(this.connectedUIRepresentation=new draw2d.Circle,this.connectedUIRepresentation.setColor(null)):this.connectedUIRepresentation=b;this.disconnectedUIRepresentation=
this.currentUIRepresentation;this.hideIfConnected=!1;this.uiRepresentationAdded=!0;this.parentNode=null;this.originY=this.originX=0;this.coronaWidth=10;this.corona=null;draw2d.Rectangle.call(this);this.setDimension(8,8);this.setBackgroundColor(new draw2d.Color(100,180,100));this.setColor(new draw2d.Color(90,150,90));draw2d.Rectangle.prototype.setColor.call(this,null);this.dropable=new draw2d.DropTarget(this.html);this.dropable.node=this;this.dropable.addEventListener("dragenter",function(a){a.target.node.onDragEnter(a.relatedTarget.node)});
this.dropable.addEventListener("dragleave",function(a){a.target.node.onDragLeave(a.relatedTarget.node)});this.dropable.addEventListener("drop",function(a){a.relatedTarget.node.onDrop(a.target.node)})};draw2d.Port.prototype=new draw2d.Rectangle;draw2d.Port.prototype.type="draw2d.Port";draw2d.Port.ZOrderBaseIndex=5E3;draw2d.Port.setZOrderBaseIndex=function(a){draw2d.Port.ZOrderBaseIndex=a};draw2d.Port.prototype.setHideIfConnected=function(a){this.hideIfConnected=a};
draw2d.Port.prototype.dispose=function(){for(var a=this.moveListener.getSize(),b=0;b<a;b++){var c=this.moveListener.get(b);this.parentNode.workflow.removeFigure(c);c.dispose()}draw2d.Rectangle.prototype.dispose.call(this);this.parentNode=null;this.dropable=this.dropable.node=null;this.disconnectedUIRepresentation.dispose();this.connectedUIRepresentation.dispose()};
draw2d.Port.prototype.createHTMLElement=function(){var a=draw2d.Rectangle.prototype.createHTMLElement.call(this);a.style.zIndex=draw2d.Port.ZOrderBaseIndex;this.currentUIRepresentation.html.zIndex=draw2d.Port.ZOrderBaseIndex;a.appendChild(this.currentUIRepresentation.html);this.uiRepresentationAdded=!0;return a};
draw2d.Port.prototype.setUiRepresentation=function(a){null===a&&(a=new draw2d.Figure);this.uiRepresentationAdded&&this.html.removeChild(this.currentUIRepresentation.getHTMLElement());this.html.appendChild(a.getHTMLElement());a.paint();this.currentUIRepresentation=a};draw2d.Port.prototype.onMouseEnter=function(){this.setLineWidth(2)};draw2d.Port.prototype.onMouseLeave=function(){this.setLineWidth(0)};
draw2d.Port.prototype.setDimension=function(a,b){draw2d.Rectangle.prototype.setDimension.call(this,a,b);this.connectedUIRepresentation.setDimension(a,b);this.disconnectedUIRepresentation.setDimension(a,b);this.setPosition(this.x,this.y)};draw2d.Port.prototype.setBackgroundColor=function(a){this.currentUIRepresentation.setBackgroundColor(a)};draw2d.Port.prototype.getBackgroundColor=function(){return this.currentUIRepresentation.getBackgroundColor()};
draw2d.Port.prototype.getConnections=function(){for(var a=new draw2d.ArrayList,b=this.moveListener.getSize(),c=0;c<b;c++){var d=this.moveListener.get(c);d instanceof draw2d.Connection&&a.add(d)}return a};draw2d.Port.prototype.setColor=function(a){this.currentUIRepresentation.setColor(a)};draw2d.Port.prototype.getColor=function(){return this.currentUIRepresentation.getColor()};draw2d.Port.prototype.setLineWidth=function(a){this.currentUIRepresentation.setLineWidth(a)};
draw2d.Port.prototype.getLineWidth=function(){return this.currentUIRepresentation.getLineWidth()};draw2d.Port.prototype.paint=function(){try{this.currentUIRepresentation.paint()}catch(a){pushErrorStack(a,"draw2d.Port.prototype.paint=function()")}};draw2d.Port.prototype.setPosition=function(a,b){this.originX=a;this.originY=b;draw2d.Rectangle.prototype.setPosition.call(this,a,b);null!==this.html&&(this.html.style.left=this.x-this.getWidth()/2+"px",this.html.style.top=this.y-this.getHeight()/2+"px")};
draw2d.Port.prototype.setParent=function(a){null!==this.parentNode&&this.parentNode.detachMoveListener(this);this.parentNode=a;null!==this.parentNode&&this.parentNode.attachMoveListener(this)};draw2d.Port.prototype.attachMoveListener=function(a){draw2d.Rectangle.prototype.attachMoveListener.call(this,a);!0==this.hideIfConnected&&this.setUiRepresentation(this.connectedUIRepresentation)};
draw2d.Port.prototype.detachMoveListener=function(a){draw2d.Rectangle.prototype.detachMoveListener.call(this,a);0==this.getConnections().getSize()&&this.setUiRepresentation(this.disconnectedUIRepresentation)};draw2d.Port.prototype.getParent=function(){return this.parentNode};
draw2d.Port.prototype.onDrag=function(){draw2d.Rectangle.prototype.onDrag.call(this);this.parentNode.workflow.showConnectionLine(this.parentNode.x+this.x,this.parentNode.y+this.y,this.parentNode.x+this.originX,this.parentNode.y+this.originY)};draw2d.Port.prototype.getCoronaWidth=function(){return this.coronaWidth};draw2d.Port.prototype.setCoronaWidth=function(a){this.coronaWidth=a};draw2d.Port.prototype.setOrigin=function(a,b){this.originX=a;this.originY=b};
draw2d.Port.prototype.onDragend=function(){this.setAlpha(1);this.setPosition(this.originX,this.originY);this.parentNode.workflow.hideConnectionLine();document.body.focus()};draw2d.Port.prototype.onDragEnter=function(a){var b=new draw2d.EditPolicy(draw2d.EditPolicy.CONNECT);b.canvas=this.parentNode.workflow;b.source=a;b.target=this;null!==this.createCommand(b)&&(this.parentNode.workflow.connectionLine.setColor(new draw2d.Color(0,150,0)),this.parentNode.workflow.connectionLine.setLineWidth(3),this.showCorona(!0))};
draw2d.Port.prototype.onDragLeave=function(){this.parentNode.workflow.connectionLine.setColor(new draw2d.Color(0,0,0));this.parentNode.workflow.connectionLine.setLineWidth(1);this.showCorona(!1)};draw2d.Port.prototype.onDrop=function(a){var b=new draw2d.EditPolicy(draw2d.EditPolicy.CONNECT);b.canvas=this.parentNode.workflow;b.source=a;b.target=this;a=this.createCommand(b);null!==a&&this.parentNode.workflow.getCommandStack().execute(a)};
draw2d.Port.prototype.getAbsolutePosition=function(){return new draw2d.Point(this.getAbsoluteX(),this.getAbsoluteY())};draw2d.Port.prototype.getAbsoluteBounds=function(){return new draw2d.Dimension(this.getAbsoluteX(),this.getAbsoluteY(),this.getWidth(),this.getHeight())};draw2d.Port.prototype.getAbsoluteY=function(){return this.originY+this.parentNode.getY()};draw2d.Port.prototype.getAbsoluteX=function(){return this.originX+this.parentNode.getX()};draw2d.Port.prototype.onOtherFigureMoved=function(){this.fireMoveEvent()};
draw2d.Port.prototype.getName=function(){return this.name};draw2d.Port.prototype.setName=function(a){this.name=a};draw2d.Port.prototype.isOver=function(a,b){var c=this.getAbsoluteX()-this.coronaWidth-this.getWidth()/2,d=this.getAbsoluteY()-this.coronaWidth-this.getHeight()/2,e=c+this.width+2*this.coronaWidth+this.getWidth()/2,f=d+this.height+2*this.coronaWidth+this.getHeight()/2;return a>=c&&a<=e&&b>=d&&b<=f};
draw2d.Port.prototype.showCorona=function(a){!0===a?(this.corona=new Corona,this.corona.setAlpha(0.3),this.corona.setBackgroundColor(new draw2d.Color(0,125,125)),this.corona.setColor(null),this.corona.setDimension(this.getWidth()+2*this.getCoronaWidth(),this.getWidth()+2*this.getCoronaWidth()),this.parentNode.getWorkflow().addFigure(this.corona,this.getAbsoluteX()-this.getCoronaWidth()-this.getWidth()/2,this.getAbsoluteY()-this.getCoronaWidth()-this.getHeight()/2)):!1===a&&null!==this.corona&&(this.parentNode.getWorkflow().removeFigure(this.corona),
this.corona=null)};draw2d.Port.prototype.createCommand=function(a){return a.getPolicy()===draw2d.EditPolicy.MOVE?!this.canDrag?null:new draw2d.CommandMovePort(this):a.getPolicy()===draw2d.EditPolicy.CONNECT&&a.source.parentNode.id!==a.target.parentNode.id?new draw2d.CommandConnect(a.canvas,a.source,a.target):null};draw2d.InputPort=function(a){draw2d.Port.call(this,a)};draw2d.InputPort.prototype=new draw2d.Port;draw2d.InputPort.prototype.type="draw2d.InputPort";
draw2d.InputPort.prototype.onDragstart=function(){return!this.canDrag?!1:!0};
draw2d.InputPort.prototype.onDragEnter=function(a){a instanceof draw2d.OutputPort?draw2d.Port.prototype.onDragEnter.call(this,a):a instanceof draw2d.LineStartResizeHandle?(a=this.workflow.currentSelection,a instanceof draw2d.Connection&&a.getSource()instanceof draw2d.InputPort&&draw2d.Port.prototype.onDragEnter.call(this,a.getTarget())):a instanceof draw2d.LineEndResizeHandle&&(a=this.workflow.currentSelection,a instanceof draw2d.Connection&&a.getTarget()instanceof draw2d.InputPort&&draw2d.Port.prototype.onDragEnter.call(this,
a.getSource()))};
draw2d.InputPort.prototype.onDragLeave=function(a){a instanceof draw2d.OutputPort?draw2d.Port.prototype.onDragLeave.call(this,a):a instanceof draw2d.LineStartResizeHandle?(a=this.workflow.currentSelection,a instanceof draw2d.Connection&&a.getSource()instanceof draw2d.InputPort&&draw2d.Port.prototype.onDragLeave.call(this,a.getTarget())):a instanceof draw2d.LineEndResizeHandle&&(a=this.workflow.currentSelection,a instanceof draw2d.Connection&&a.getTarget()instanceof draw2d.InputPort&&draw2d.Port.prototype.onDragLeave.call(this,
a.getSource()))};draw2d.InputPort.prototype.createCommand=function(a){return a.getPolicy()==draw2d.EditPolicy.CONNECT?a.source.parentNode.id==a.target.parentNode.id?null:a.source instanceof draw2d.OutputPort?new draw2d.CommandConnect(a.canvas,a.source,a.target):null:draw2d.Port.prototype.createCommand.call(this,a)};draw2d.bpmn.InputPort=function(a){draw2d.InputPort.call(this,a);this.setBackgroundColor(new draw2d.Color(115,115,245))};draw2d.bpmn.InputPort.prototype=new draw2d.InputPort;
draw2d.bpmn.InputPort.prototype.type="bpmn.InputPort";draw2d.bpmn.InputPort.prototype.onDrop=function(a){!(a.getMaxFanOut&&a.getMaxFanOut()<=a.getFanOut())&&(this.parentNode.id!=a.parentNode.id&&!(0<=a.getName().indexOf("input")))&&(a=new draw2d.CommandConnect(this.parentNode.workflow,a,this),a.setConnection(new draw2d.bpmn.Connection),this.parentNode.workflow.getCommandStack().execute(a))};draw2d.OutputPort=function(a){draw2d.Port.call(this,a);this.maxFanOut=100};draw2d.OutputPort.prototype=new draw2d.Port;
draw2d.OutputPort.prototype.type="draw2d.OutputPort";
draw2d.OutputPort.prototype.onDragEnter=function(a){this.getMaxFanOut()<=this.getFanOut()||(a instanceof draw2d.InputPort?draw2d.Port.prototype.onDragEnter.call(this,a):a instanceof draw2d.LineStartResizeHandle?(a=this.workflow.currentSelection,a instanceof draw2d.Connection&&a.getSource()instanceof draw2d.OutputPort&&draw2d.Port.prototype.onDragEnter.call(this,a.getTarget())):a instanceof draw2d.LineEndResizeHandle&&(a=this.workflow.currentSelection,a instanceof draw2d.Connection&&a.getTarget()instanceof
draw2d.OutputPort&&draw2d.Port.prototype.onDragEnter.call(this,a.getSource())))};
draw2d.OutputPort.prototype.onDragLeave=function(a){a instanceof draw2d.InputPort?draw2d.Port.prototype.onDragLeave.call(this,a):a instanceof draw2d.LineStartResizeHandle?(a=this.workflow.currentSelection,a instanceof draw2d.Connection&&a.getSource()instanceof draw2d.OutputPort&&draw2d.Port.prototype.onDragLeave.call(this,a.getTarget())):a instanceof draw2d.LineEndResizeHandle&&(a=this.workflow.currentSelection,a instanceof draw2d.Connection&&a.getTarget()instanceof draw2d.OutputPort&&draw2d.Port.prototype.onDragLeave.call(this,
a.getSource()))};draw2d.OutputPort.prototype.onDragstart=function(){return!this.canDrag?!1:-1===this.maxFanOut?!0:this.getMaxFanOut()<=this.getFanOut()?!1:!0};draw2d.OutputPort.prototype.setMaxFanOut=function(a){this.maxFanOut=a};draw2d.OutputPort.prototype.getMaxFanOut=function(){return this.maxFanOut};
draw2d.OutputPort.prototype.getFanOut=function(){if(null===this.getParent().workflow)return 0;for(var a=0,b=this.getParent().workflow.getLines(),c=b.getSize(),d=0;d<c;d++){var e=b.get(d);e instanceof draw2d.Connection&&(e.getSource()==this?a++:e.getTarget()==this&&a++)}return a};
draw2d.OutputPort.prototype.createCommand=function(a){return a.getPolicy()===draw2d.EditPolicy.CONNECT?a.source.parentNode.id===a.target.parentNode.id?null:a.source instanceof draw2d.InputPort?new draw2d.CommandConnect(a.canvas,a.target,a.source):null:draw2d.Port.prototype.createCommand.call(this,a)};draw2d.bpmn.OutputPort=function(a){draw2d.OutputPort.call(this,a);this.setBackgroundColor(new draw2d.Color(245,115,115))};draw2d.bpmn.OutputPort.prototype=new draw2d.OutputPort;
draw2d.bpmn.OutputPort.prototype.type="bpmn.OutputPort";draw2d.bpmn.OutputPort.prototype.onDrop=function(a){!(this.getMaxFanOut()<=this.getFanOut())&&(this.parentNode.id!=a.parentNode.id&&!(0<=a.getName().indexOf("output")))&&(a=new draw2d.CommandConnect(this.parentNode.workflow,this,a),a.setConnection(new draw2d.bpmn.Connection),this.parentNode.workflow.getCommandStack().execute(a))};
draw2d.ResizeHandle=function(a,b){draw2d.Rectangle.call(this,5,5);this.type=b;var c=this.getWidth(),d=c/2;switch(this.type){case 1:this.setSnapToGridAnchor(new draw2d.Point(c,c));break;case 2:this.setSnapToGridAnchor(new draw2d.Point(d,c));break;case 3:this.setSnapToGridAnchor(new draw2d.Point(0,c));break;case 4:this.setSnapToGridAnchor(new draw2d.Point(0,d));break;case 5:this.setSnapToGridAnchor(new draw2d.Point(0,0));break;case 6:this.setSnapToGridAnchor(new draw2d.Point(d,0));break;case 7:this.setSnapToGridAnchor(new draw2d.Point(c,
0));break;case 8:this.setSnapToGridAnchor(new draw2d.Point(c,d));case 9:this.setSnapToGridAnchor(new draw2d.Point(d,d))}this.setBackgroundColor(new draw2d.Color(0,255,0));this.setWorkflow(a);this.setZOrder(1E4)};draw2d.ResizeHandle.prototype=new draw2d.Rectangle;draw2d.ResizeHandle.prototype.type="draw2d.ResizeHandle";
draw2d.ResizeHandle.prototype.getSnapToDirection=function(){switch(this.type){case 1:return draw2d.SnapToHelper.NORTH_WEST;case 2:return draw2d.SnapToHelper.NORTH;case 3:return draw2d.SnapToHelper.NORTH_EAST;case 4:return draw2d.SnapToHelper.EAST;case 5:return draw2d.SnapToHelper.SOUTH_EAST;case 6:return draw2d.SnapToHelper.SOUTH;case 7:return draw2d.SnapToHelper.SOUTH_WEST;case 8:return draw2d.SnapToHelper.WEST;case 9:return draw2d.SnapToHelper.CENTER}};
draw2d.ResizeHandle.prototype.onDragend=function(){var a=this.workflow.currentSelection;null!==this.commandMove&&(this.commandMove.setPosition(a.getX(),a.getY()),this.workflow.getCommandStack().execute(this.commandMove),this.commandMove=null);null!==this.commandResize&&(this.commandResize.setDimension(a.getWidth(),a.getHeight()),this.workflow.getCommandStack().execute(this.commandResize),this.commandResize=null);this.workflow.hideSnapToHelperLines()};
draw2d.ResizeHandle.prototype.setPosition=function(a,b){this.x=a;this.y=b;null!==this.html&&(this.html.style.left=this.x+"px",this.html.style.top=this.y+"px")};draw2d.ResizeHandle.prototype.onDragstart=function(){if(!this.canDrag)return!1;var a=this.workflow.currentSelection;this.commandMove=a.createCommand(new draw2d.EditPolicy(draw2d.EditPolicy.MOVE));this.commandResize=a.createCommand(new draw2d.EditPolicy(draw2d.EditPolicy.RESIZE));return!0};
draw2d.ResizeHandle.prototype.onDrag=function(){var a=this.getX(),b=this.getY();draw2d.Rectangle.prototype.onDrag.call(this);var a=a-this.getX(),b=b-this.getY(),c=this.workflow.currentSelection.getX(),d=this.workflow.currentSelection.getY(),e=this.workflow.currentSelection.getWidth(),f=this.workflow.currentSelection.getHeight();switch(this.type){case 1:this.workflow.currentSelection.setPosition(c-a,d-b);this.workflow.currentSelection.setDimension(e+a,f+b);break;case 2:this.workflow.currentSelection.setPosition(c,
d-b);this.workflow.currentSelection.setDimension(e,f+b);break;case 3:this.workflow.currentSelection.setPosition(c,d-b);this.workflow.currentSelection.setDimension(e-a,f+b);break;case 4:this.workflow.currentSelection.setPosition(c,d);this.workflow.currentSelection.setDimension(e-a,f);break;case 5:this.workflow.currentSelection.setPosition(c,d);this.workflow.currentSelection.setDimension(e-a,f-b);break;case 6:this.workflow.currentSelection.setPosition(c,d);this.workflow.currentSelection.setDimension(e,
f-b);break;case 7:this.workflow.currentSelection.setPosition(c-a,d);this.workflow.currentSelection.setDimension(e+a,f-b);break;case 8:this.workflow.currentSelection.setPosition(c-a,d),this.workflow.currentSelection.setDimension(e+a,f)}this.workflow.moveResizeHandles(this.workflow.getCurrentSelection())};
draw2d.ResizeHandle.prototype.setCanDrag=function(a){draw2d.Rectangle.prototype.setCanDrag.call(this,a);if(null!==this.html)if(a)switch(this.type){case 1:this.html.style.cursor="nw-resize";break;case 2:this.html.style.cursor="s-resize";break;case 3:this.html.style.cursor="ne-resize";break;case 4:this.html.style.cursor="w-resize";break;case 5:this.html.style.cursor="se-resize";break;case 6:this.html.style.cursor="n-resize";break;case 7:this.html.style.cursor="sw-resize";break;case 8:this.html.style.cursor=
"e-resize";break;case 9:this.html.style.cursor="resize"}else this.html.style.cursor=""};draw2d.ResizeHandle.prototype.onKeyDown=function(a,b){this.workflow.onKeyDown(a,b)};draw2d.ResizeHandle.prototype.fireMoveEvent=function(){};draw2d.LineEndResizeHandle=function(a){draw2d.ResizeHandle.call(this,a,9);this.setDimension(10,10);this.setBackgroundColor(new draw2d.Color(0,255,0));this.setZOrder(1E4)};draw2d.LineEndResizeHandle.prototype=new draw2d.ResizeHandle;
draw2d.LineEndResizeHandle.prototype.type="draw2d.LineEndResizeHandle";draw2d.LineEndResizeHandle.prototype.onDragend=function(){this.workflow.currentSelection instanceof draw2d.Connection?null!==this.command&&this.command.cancel():null!==this.command&&this.workflow.getCommandStack().execute(this.command);this.command=null};
draw2d.LineEndResizeHandle.prototype.onDragstart=function(){if(!this.canDrag)return!1;this.command=this.workflow.currentSelection.createCommand(new draw2d.EditPolicy(draw2d.EditPolicy.MOVE));return null!==this.command};
draw2d.LineEndResizeHandle.prototype.onDrag=function(){var a=this.getX(),b=this.getY();draw2d.Rectangle.prototype.onDrag.call(this);var a=a-this.getX(),b=b-this.getY(),c=this.workflow.currentSelection.getEndPoint(),d=this.workflow.currentSelection;d.setEndPoint(c.x-a,c.y-b);d.isMoving=!0};
draw2d.LineEndResizeHandle.prototype.onDrop=function(a){var b=this.workflow.currentSelection;b.isMoving=!1;b instanceof draw2d.Connection&&(this.command.setNewPorts(b.getSource(),a),this.getWorkflow().getCommandStack().execute(this.command));this.command=null};draw2d.LineStartResizeHandle=function(a){draw2d.ResizeHandle.call(this,a,9);this.setDimension(10,10);this.setBackgroundColor(new draw2d.Color(100,255,0));this.setZOrder(1E4)};draw2d.LineStartResizeHandle.prototype=new draw2d.ResizeHandle;
draw2d.LineStartResizeHandle.prototype.type="draw2d.LineStartResizeHandle";draw2d.LineStartResizeHandle.prototype.onDragend=function(){this.workflow.currentSelection instanceof draw2d.Connection?null!==this.command&&this.command.cancel():null!==this.command&&this.getWorkflow().getCommandStack().execute(this.command);this.command=null};
draw2d.LineStartResizeHandle.prototype.onDragstart=function(){if(!this.canDrag)return!1;this.command=this.workflow.currentSelection.createCommand(new draw2d.EditPolicy(draw2d.EditPolicy.MOVE));return null!==this.command};
draw2d.LineStartResizeHandle.prototype.onDrag=function(){var a=this.getX(),b=this.getY();draw2d.Rectangle.prototype.onDrag.call(this);var a=a-this.getX(),b=b-this.getY(),c=this.workflow.currentSelection.getStartPoint(),d=this.workflow.currentSelection;d.setStartPoint(c.x-a,c.y-b);d.isMoving=!0};
draw2d.LineStartResizeHandle.prototype.onDrop=function(a){var b=this.workflow.currentSelection;b.isMoving=!1;b instanceof draw2d.Connection&&(this.command.setNewPorts(a,b.getTarget()),this.getWorkflow().getCommandStack().execute(this.command));this.command=null};draw2d.WindowFigure=function(a){this.title=a;this.titlebar=null;draw2d.Figure.call(this);this.dropShadow=5;this.setDeleteable(!1);this.setCanSnapToHelper(!1);this.setZOrder(draw2d.WindowFigure.ZOrderIndex)};draw2d.WindowFigure.prototype=new draw2d.Figure;
draw2d.WindowFigure.prototype.type=":draw2d.WindowFigure";draw2d.WindowFigure.ZOrderIndex=1E3;draw2d.WindowFigure.setZOrderBaseIndex=function(a){draw2d.WindowFigure.ZOrderBaseIndex=a};draw2d.WindowFigure.prototype.hasFixedPosition=function(){return!0};draw2d.WindowFigure.prototype.hasTitleBar=function(){return!0};
draw2d.WindowFigure.prototype.createHTMLElement=function(){var a=draw2d.Figure.prototype.createHTMLElement.call(this);a.style.margin="0px";a.style.padding="0px";a.style.border="1px solid black";a.style.backgroundImage="url(window_bg.png)";0<this.dropShadow&&(a.style.boxShadow=this.dropShadow+"px "+this.dropShadow+"px "+this.dropShadow+"px #ccc");a.style.borderRadius="2px";a.style.zIndex=draw2d.WindowFigure.ZOrderIndex;a.style.cursor=null;a.className="WindowFigure";this.hasTitleBar()&&(this.titlebar=
document.createElement("div"),this.titlebar.style.position="absolute",this.titlebar.style.left="0px",this.titlebar.style.top="0px",this.titlebar.style.width=this.getWidth()+"px",this.titlebar.style.height="15px",this.titlebar.style.margin="0px",this.titlebar.style.padding="0px",this.titlebar.style.font="normal 10px verdana",this.titlebar.style.backgroundColor="blue",this.titlebar.style.borderBottom="2px solid gray",this.titlebar.style.whiteSpace="nowrap",this.titlebar.style.textAlign="center",this.titlebar.style.backgroundImage=
"url(window_toolbar.png)",this.titlebar.className="WindowFigure_titlebar",this.textNode=document.createTextNode(this.title),this.titlebar.appendChild(this.textNode),this.disableTextSelection(this.titlebar),a.appendChild(this.titlebar));return a};draw2d.WindowFigure.prototype.setDocumentDirty=function(){};draw2d.WindowFigure.prototype.onDragend=function(){};
draw2d.WindowFigure.prototype.onDragstart=function(a,b){return null===this.titlebar?!1:!0===this.canDrag&&a<parseInt(this.titlebar.style.width)&&b<parseInt(this.titlebar.style.height)?!0:!1};draw2d.WindowFigure.prototype.isSelectable=function(){return!1};draw2d.WindowFigure.prototype.setCanDrag=function(a){draw2d.Figure.prototype.setCanDrag.call(this,a);this.html.style.cursor="";null!==this.titlebar&&(this.titlebar.style.cursor=a?"move":"")};
draw2d.WindowFigure.prototype.setWorkflow=function(a){var b=this.workflow;draw2d.Figure.prototype.setWorkflow.call(this,a);null!==b&&b.removeSelectionListener(this);null!==this.workflow&&this.workflow.addSelectionListener(this)};draw2d.WindowFigure.prototype.setDropShadow=function(a){this.dropShadow=a;null!==this.html&&(this.html.style.boxShadow=0<this.dropShadow?a+"px "+a+"px "+a+"px #ccc":"")};
draw2d.WindowFigure.prototype.setDimension=function(a,b){draw2d.Figure.prototype.setDimension.call(this,a,b);null!==this.titlebar&&(this.titlebar.style.width=this.getWidth()+"px")};draw2d.WindowFigure.prototype.setTitle=function(a){this.title=a};draw2d.WindowFigure.prototype.getMinWidth=function(){return 50};draw2d.WindowFigure.prototype.getMinHeight=function(){return 50};draw2d.WindowFigure.prototype.isResizeable=function(){return!1};draw2d.WindowFigure.prototype.setAlpha=function(){};
draw2d.WindowFigure.prototype.setBackgroundColor=function(a){this.bgColor=a;null!==this.bgColor?this.html.style.backgroundColor=this.bgColor.getHTMLStyle():(this.html.style.backgroundColor="transparent",this.html.style.backgroundImage="")};draw2d.WindowFigure.prototype.setColor=function(a){this.lineColor=a;this.html.style.border=null!==this.lineColor?this.lineStroke+"px solid "+this.lineColor.getHTMLStyle():"0px"};
draw2d.WindowFigure.prototype.setLineWidth=function(a){this.lineStroke=a;this.html.style.border=this.lineStroke+"px solid black"};draw2d.WindowFigure.prototype.onSelectionChanged=function(){};draw2d.Dialog=function(a){this.buttonbar=null;a?draw2d.WindowFigure.call(this,a):draw2d.WindowFigure.call(this,"Dialog");this.setDimension(400,300)};draw2d.Dialog.prototype=new draw2d.WindowFigure;draw2d.Dialog.prototype.type="draw2d.Dialog";
draw2d.Dialog.prototype.createHTMLElement=function(){var a=draw2d.WindowFigure.prototype.createHTMLElement.call(this),b=this;this.buttonbar=document.createElement("div");this.buttonbar.style.position="absolute";this.buttonbar.style.left="0px";this.buttonbar.style.bottom="0px";this.buttonbar.style.width=this.getWidth()+"px";this.buttonbar.style.height="30px";this.buttonbar.style.margin="0px";this.buttonbar.style.padding="0px";this.buttonbar.style.font="normal 10px verdana";this.buttonbar.style.backgroundColor=
"#c0c0c0";this.buttonbar.style.borderBottom="2px solid gray";this.buttonbar.style.whiteSpace="nowrap";this.buttonbar.style.textAlign="center";this.buttonbar.className="Dialog_buttonbar";this.okbutton=document.createElement("button");this.okbutton.style.border="1px solid gray";this.okbutton.style.font="normal 10px verdana";this.okbutton.style.width="80px";this.okbutton.style.margin="5px";this.okbutton.className="Dialog_okbutton";this.okbutton.innerHTML="Ok";this.okbutton.onclick=function(){var a=null;
try{b.onOk()}catch(d){a=d}b.workflow.removeFigure(b);if(null!==a)throw a;};this.buttonbar.appendChild(this.okbutton);this.cancelbutton=document.createElement("button");this.cancelbutton.innerHTML="Cancel";this.cancelbutton.style.font="normal 10px verdana";this.cancelbutton.style.border="1px solid gray";this.cancelbutton.style.width="80px";this.cancelbutton.style.margin="5px";this.cancelbutton.className="Dialog_cancelbutton";this.cancelbutton.onclick=function(){var a=null;try{b.onCancel()}catch(d){a=
d}b.workflow.removeFigure(b);if(null!==a)throw a;};this.buttonbar.appendChild(this.cancelbutton);a.appendChild(this.buttonbar);return a};draw2d.Dialog.prototype.onOk=function(){};draw2d.Dialog.prototype.onCancel=function(){};draw2d.Dialog.prototype.setDimension=function(a,b){draw2d.WindowFigure.prototype.setDimension.call(this,a,b);null!==this.buttonbar&&(this.buttonbar.style.width=this.getWidth()+"px")};
draw2d.Dialog.prototype.setWorkflow=function(a){draw2d.WindowFigure.prototype.setWorkflow.call(this,a);this.setFocus()};draw2d.Dialog.prototype.setFocus=function(){};draw2d.Dialog.prototype.onSetDocumentDirty=function(){};draw2d.AnnotationDialog=function(a){this.figure=a;draw2d.Dialog.call(this);this.setDimension(400,100)};draw2d.AnnotationDialog.prototype=new draw2d.Dialog;draw2d.AnnotationDialog.prototype.type="draw2d.AnnotationDialog";
draw2d.AnnotationDialog.prototype.createHTMLElement=function(){var a=draw2d.Dialog.prototype.createHTMLElement.call(this),b=document.createElement("form");b.style.position="absolute";b.style.left="10px";b.style.top="30px";b.style.width="375px";b.style.font="normal 10px verdana";a.appendChild(b);this.label=document.createTextNode("Text");b.appendChild(this.label);this.input=document.createElement("input");this.input.style.border="1px solid gray";this.input.style.font="normal 10px verdana";this.input.type=
"text";var c=this.figure.getText();this.input.value=c?c:"";this.input.style.width="100%";b.appendChild(this.input);this.input.focus();return a};draw2d.AnnotationDialog.prototype.onOk=function(){this.workflow.getCommandStack().execute(new draw2d.CommandSetText(this.figure,this.input.value));this.workflow.removeFigure(this)};
draw2d.ColorDialog=function(){this.maxValue={h:"359",s:"100",v:"100"};this.HSV={"0":359,1:100,2:100};this.slideHSV={"0":359,1:100,2:100};this.SVHeight=165;this.wH=this.wSV=162;draw2d.Dialog.call(this,"Color Chooser");this.loadSV();this.setColor(new draw2d.Color(255,0,0));this.setDimension(219,244)};draw2d.ColorDialog.prototype=new draw2d.Dialog;draw2d.ColorDialog.prototype.type="draw2d.ColorDialog";
draw2d.ColorDialog.prototype.createHTMLElement=function(){var a=this,b=draw2d.Dialog.prototype.createHTMLElement.call(this);this.outerDiv=document.createElement("div");this.outerDiv.id="plugin";this.outerDiv.style.top="15px";this.outerDiv.style.left="0px";this.outerDiv.style.width="201px";this.outerDiv.style.position="absolute";this.outerDiv.style.padding="9px";this.outerDiv.display="block";this.outerDiv.style.background="#0d0d0d";this.plugHEX=document.createElement("div");this.plugHEX.id="plugHEX";
this.plugHEX.innerHTML="F1FFCC";this.plugHEX.style.color="white";this.plugHEX.style.font="normal 10px verdana";this.outerDiv.appendChild(this.plugHEX);this.SV=document.createElement("div");this.SV.onmousedown=function(b){a.mouseDownSV(a.SVslide,b)};this.SV.id="SV";this.SV.style.cursor="crosshair";this.SV.style.background="#FF0000 url(SatVal.png)";this.SV.style.position="absolute";this.SV.style.height="166px";this.SV.style.width="167px";this.SV.style.marginRight="10px";this.SV.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='SatVal.png', sizingMethod='scale')";
this.SV.style["float"]="left";this.outerDiv.appendChild(this.SV);this.SVslide=document.createElement("div");this.SVslide.onmousedown=function(b){a.mouseDownSV(b)};this.SVslide.style.top="40px";this.SVslide.style.left="40px";this.SVslide.style.position="absolute";this.SVslide.style.cursor="crosshair";this.SVslide.style.background="url(slide.gif)";this.SVslide.style.height="9px";this.SVslide.style.width="9px";this.SVslide.style.lineHeight="1px";this.outerDiv.appendChild(this.SVslide);this.H=document.createElement("form");
this.H.id="H";this.H.onmousedown=function(b){a.mouseDownH(b)};this.H.style.border="1px solid #000000";this.H.style.cursor="crosshair";this.H.style.position="absolute";this.H.style.width="19px";this.H.style.top="28px";this.H.style.left="191px";this.outerDiv.appendChild(this.H);this.Hslide=document.createElement("div");this.Hslide.style.top="-7px";this.Hslide.style.left="-8px";this.Hslide.style.background="url(slideHue.gif)";this.Hslide.style.height="5px";this.Hslide.style.width="33px";this.Hslide.style.position=
"absolute";this.Hslide.style.lineHeight="1px";this.H.appendChild(this.Hslide);this.Hmodel=document.createElement("div");this.Hmodel.style.height="1px";this.Hmodel.style.width="19px";this.Hmodel.style.lineHeight="1px";this.Hmodel.style.margin="0px";this.Hmodel.style.padding="0px";this.Hmodel.style.fontSize="1px";this.H.appendChild(this.Hmodel);b.appendChild(this.outerDiv);return b};draw2d.ColorDialog.prototype.onOk=function(){draw2d.Dialog.prototype.onOk.call(this)};
draw2d.browser=function(a){return Math.max(navigator.userAgent.toLowerCase().indexOf(a),0)};draw2d.ColorDialog.prototype.showColor=function(a){this.plugHEX.style.background="#"+a;this.plugHEX.innerHTML=a};draw2d.ColorDialog.prototype.getSelectedColor=function(){var a=this.hex2rgb(this.plugHEX.innerHTML);return new draw2d.Color(a[0],a[1],a[2])};draw2d.ColorDialog.prototype.setColor=function(a){null===a&&(a=new draw2d.Color(100,100,100));this.updateH(this.rgb2hex([a.getRed(),a.getGreen(),a.getBlue()]))};
draw2d.ColorDialog.prototype.XY=function(a,b){return(draw2d.browser("msie")?[event.clientX+document.body.scrollLeft,event.clientY+document.body.scrollTop]:[a.pageX,a.pageY])[b]};draw2d.ColorDialog.prototype.mkHSV=function(a,b,c){return Math.min(a,Math.max(0,Math.ceil(parseInt(c)/b*a)))};draw2d.ColorDialog.prototype.ckHSV=function(a,b){if(0<=a&&a<=b)return a;if(a>b)return b;if(0>a)return"-"+oo};
draw2d.ColorDialog.prototype.mouseDownH=function(a){this.slideHSV[0]=this.HSV[0];var b=this;this.H.onmousemove=function(a){b.dragH(a)};this.H.onmouseup=function(){b.H.onmousemove="";b.H.onmouseup=""};this.dragH(a)};
draw2d.ColorDialog.prototype.dragH=function(a){this.Hslide.style.top=this.ckHSV(this.XY(a,1)-this.getY()-40,this.wH)-5+"px";this.slideHSV[0]=this.mkHSV(359,this.wH,this.Hslide.style.top);this.updateSV();this.showColor(this.commit());this.SV.style.backgroundColor="#"+this.hsv2hex([this.HSV[0],100,100])};
draw2d.ColorDialog.prototype.mouseDownSV=function(a,b){function c(){d.SV.onmousemove="";d.SV.onmouseup="";d.SVslide.onmousemove="";d.SVslide.onmouseup=""}this.slideHSV[0]=this.HSV[0];var d=this;this.SV.onmousemove=function(a){d.dragSV(a)};this.SV.onmouseup=c;this.SVslide.onmousemove=function(a){d.dragSV(a)};this.SVslide.onmouseup=c;this.dragSV(b)};
draw2d.ColorDialog.prototype.dragSV=function(a){var b=this.XY(a,0)-this.getX()-1,a=this.XY(a,1)-this.getY()-20;this.SVslide.style.left=this.ckHSV(b,this.wSV)+"px";this.SVslide.style.top=this.ckHSV(a,this.wSV)+"px";this.slideHSV[1]=this.mkHSV(100,this.wSV,this.SVslide.style.left);this.slideHSV[2]=100-this.mkHSV(100,this.wSV,this.SVslide.style.top);this.updateSV()};
draw2d.ColorDialog.prototype.commit=function(){for(var a={},b="",c=0;2>=c;c++)b="hsv".substr(c,1),a[c]="h"==b?this.maxValue[b]-this.mkHSV(this.maxValue[b],this.wH,this.Hslide.style.top):this.HSV[c];return this.updateSV(this.hsv2hex(a))};draw2d.ColorDialog.prototype.updateSV=function(a){this.HSV=a?this.hex2hsv(a):[this.slideHSV[0],this.slideHSV[1],this.slideHSV[2]];a||(a=this.hsv2hex([this.slideHSV[0],this.slideHSV[1],this.slideHSV[2]]));this.showColor(a);return a};
draw2d.ColorDialog.prototype.loadSV=function(){for(var a="",b=this.SVHeight;0<=b;b--)a+='<div style="background:#'+this.hsv2hex([Math.round(359/this.SVHeight*b),100,100])+';"><br/></div>';this.Hmodel.innerHTML=a};
draw2d.ColorDialog.prototype.updateH=function(a){this.plugHEX.innerHTML=a;this.HSV=this.hex2hsv(a);this.SV.style.backgroundColor="#"+this.hsv2hex([this.HSV[0],100,100]);this.SVslide.style.top=parseInt(this.wSV-this.wSV*(this.HSV[1]/100))+20+"px";this.SVslide.style.left=parseInt(this.wSV*(this.HSV[1]/100))+5+"px";this.Hslide.style.top=parseInt(this.wH*((this.maxValue.h-this.HSV[0])/this.maxValue.h))-7+"px"};
draw2d.ColorDialog.prototype.toHex=function(a){a=Math.round(Math.min(Math.max(0,a),255));return"0123456789ABCDEF".charAt((a-a%16)/16)+"0123456789ABCDEF".charAt(a%16)};draw2d.ColorDialog.prototype.hex2rgb=function(a){return{"0":parseInt(a.substr(0,2),16),1:parseInt(a.substr(2,2),16),2:parseInt(a.substr(4,2),16)}};draw2d.ColorDialog.prototype.rgb2hex=function(a){return this.toHex(a[0])+this.toHex(a[1])+this.toHex(a[2])};draw2d.ColorDialog.prototype.hsv2hex=function(a){return this.rgb2hex(this.hsv2rgb(a))};
draw2d.ColorDialog.prototype.hex2hsv=function(a){return this.rgb2hsv(this.hex2rgb(a))};draw2d.ColorDialog.prototype.rgb2hsv=function(a){var b=Math.max(a[0],a[1],a[2]),c=b-Math.min(a[0],a[1],a[2]),d,e;0!=b&&(e=Math.round(100*(c/b)),a[0]==b?d=(a[1]-a[2])/c:a[1]==b?d=2+(a[2]-a[0])/c:a[2]==b&&(d=4+(a[0]-a[1])/c),d=Math.min(Math.round(60*d),360),0>d&&(d+=360));return{"0":d?d:0,1:e?e:0,2:Math.round(100*(b/255))}};
draw2d.ColorDialog.prototype.hsv2rgb=function(a){var b,c,d=a[1]/100,e=a[2]/100,f=a[0]/360;if(0<d){1<=f&&(f=0);f*=6;F=f-Math.floor(f);A=Math.round(255*e*(1-d));a=Math.round(255*e*(1-d*F));C=Math.round(255*e*(1-d*(1-F)));e=Math.round(255*e);switch(Math.floor(f)){case 0:b=e;c=C;a=A;break;case 1:b=a;c=e;a=A;break;case 2:b=A;c=e;a=C;break;case 3:b=A;c=a;a=e;break;case 4:b=C;c=A;a=e;break;case 5:b=e,c=A}return{"0":b?b:0,1:c?c:0,2:a?a:0}}return{"0":e=Math.round(255*e),1:e,2:e}};
draw2d.BackgroundColorDialog=function(a){draw2d.ColorDialog.call(this);this.figure=a;a=a.getBackgroundColor();null!==a&&this.updateH(this.rgb2hex(a.getRed(),a.getGreen(),a.getBlue()))};draw2d.BackgroundColorDialog.prototype=new draw2d.ColorDialog;draw2d.BackgroundColorDialog.prototype.type="draw2d.BackgroundColorDialog";
draw2d.BackgroundColorDialog.prototype.onOk=function(){var a=this.workflow;draw2d.ColorDialog.prototype.onOk.call(this);"function"==typeof this.figure.setBackgroundColor&&(a.getCommandStack().execute(new draw2d.CommandSetBackgroundColor(this.figure,this.getSelectedColor())),a.getCurrentSelection()==this.figure&&a.setCurrentSelection(this.figure))};draw2d.LineColorDialog=function(a){draw2d.ColorDialog.call(this);this.figure=a;a=a.getColor();this.updateH(this.rgb2hex(a.getRed(),a.getGreen(),a.getBlue()))};
draw2d.LineColorDialog.prototype=new draw2d.ColorDialog;draw2d.LineColorDialog.prototype.type="draw2d.LineColorDialog";draw2d.LineColorDialog.prototype.onOk=function(){var a=this.workflow;draw2d.ColorDialog.prototype.onOk.call(this);"function"==typeof this.figure.setColor&&(a.getCommandStack().execute(new draw2d.CommandSetColor(this.figure,this.getSelectedColor())),a.getCurrentSelection()==this.figure&&a.setCurrentSelection(this.figure))};
draw2d.InputDialog=function(){draw2d.Dialog.call(this);this.setDimension(400,100)};draw2d.InputDialog.prototype=new draw2d.Dialog;draw2d.InputDialog.prototype.type="draw2d.InputDialog";draw2d.InputDialog.prototype.createHTMLElement=function(){return draw2d.Dialog.prototype.createHTMLElement.call(this)};draw2d.InputDialog.prototype.onOk=function(){this.workflow.removeFigure(this)};draw2d.InputDialog.prototype.onCancel=function(){this.workflow.removeFigure(this)};
draw2d.PropertyDialog=function(a,b,c){this.figure=a;this.propertyName=b;this.label=c;draw2d.Dialog.call(this);this.setDimension(400,120)};draw2d.PropertyDialog.prototype=new draw2d.Dialog;draw2d.PropertyDialog.prototype.type="draw2d.PropertyDialog";
draw2d.PropertyDialog.prototype.createHTMLElement=function(){var a=draw2d.Dialog.prototype.createHTMLElement.call(this),b=document.createElement("form");b.style.position="absolute";b.style.left="10px";b.style.top="30px";b.style.width="375px";b.style.font="normal 10px verdana";a.appendChild(b);this.labelDiv=document.createElement("div");this.labelDiv.innerHTML=this.label;this.disableTextSelection(this.labelDiv);b.appendChild(this.labelDiv);this.input=document.createElement("input");this.input.style.border=
"1px solid gray";this.input.style.font="normal 10px verdana";this.input.type="text";var c=this.figure.getProperty(this.propertyName);this.input.value=c?c:"";this.input.style.width="100%";b.appendChild(this.input);this.input.focus();return a};draw2d.PropertyDialog.prototype.onOk=function(){draw2d.Dialog.prototype.onOk.call(this);this.figure.setProperty(this.propertyName,this.input.value)};
draw2d.PropertyWindow=function(){this.currentSelection=null;draw2d.WindowFigure.call(this,"Property Window");this.setDimension(200,100)};draw2d.PropertyWindow.prototype=new draw2d.WindowFigure;draw2d.PropertyWindow.prototype.type="draw2d.PropertyWindow";draw2d.PropertyWindow.prototype.dispose=function(){draw2d.WindowFigure.prototype.dispose.call(this)};
draw2d.PropertyWindow.prototype.createHTMLElement=function(){var a=draw2d.WindowFigure.prototype.createHTMLElement.call(this);a.appendChild(this.createLabel("Type:",15,25));a.appendChild(this.createLabel("X :",15,50));a.appendChild(this.createLabel("Y :",15,70));a.appendChild(this.createLabel("Width :",85,50));a.appendChild(this.createLabel("Height :",85,70));this.labelType=this.createLabel("",50,25);this.labelX=this.createLabel("",40,50);this.labelY=this.createLabel("",40,70);this.labelWidth=this.createLabel("",
135,50);this.labelHeight=this.createLabel("",135,70);this.labelType.style.fontWeight="normal";this.labelX.style.fontWeight="normal";this.labelY.style.fontWeight="normal";this.labelWidth.style.fontWeight="normal";this.labelHeight.style.fontWeight="normal";a.appendChild(this.labelType);a.appendChild(this.labelX);a.appendChild(this.labelY);a.appendChild(this.labelWidth);a.appendChild(this.labelHeight);return a};
draw2d.PropertyWindow.prototype.onSelectionChanged=function(a){draw2d.WindowFigure.prototype.onSelectionChanged.call(this,a);null!==this.currentSelection&&this.currentSelection.detachMoveListener(this);this.currentSelection=a;null!==a&&a!=this?(this.labelType.innerHTML=a.type,a.getX?(this.labelX.innerHTML=a.getX(),this.labelY.innerHTML=a.getY(),this.labelWidth.innerHTML=a.getWidth(),this.labelHeight.innerHTML=a.getHeight(),this.currentSelection=a,this.currentSelection.attachMoveListener(this)):(this.labelX.innerHTML=
"",this.labelY.innerHTML="",this.labelWidth.innerHTML="",this.labelHeight.innerHTML="")):(this.labelType.innerHTML="&lt;none&gt;",this.labelX.innerHTML="",this.labelY.innerHTML="",this.labelWidth.innerHTML="",this.labelHeight.innerHTML="")};draw2d.PropertyWindow.prototype.getCurrentSelection=function(){return this.currentSelection};draw2d.PropertyWindow.prototype.onOtherFigureMoved=function(a){if(a==this.currentSelection)this.onSelectionChanged(a)};
draw2d.PropertyWindow.prototype.createLabel=function(a,b,c){var d=document.createElement("div");d.style.position="absolute";d.style.left=b+"px";d.style.top=c+"px";d.style.font="normal 10px verdana";d.style.whiteSpace="nowrap";d.style.fontWeight="bold";d.innerHTML=a;this.disableTextSelection(d);return d};draw2d.ToolPalette=function(a){draw2d.WindowFigure.call(this,a);this.setDimension(75,400);this.activeTool=null;this.children={}};draw2d.ToolPalette.prototype=new draw2d.WindowFigure;
draw2d.ToolPalette.prototype.type="draw2d.ToolPalette";draw2d.ToolPalette.prototype.dispose=function(){draw2d.WindowFigure.prototype.dispose.call(this)};
draw2d.ToolPalette.prototype.createHTMLElement=function(){var a=draw2d.WindowFigure.prototype.createHTMLElement.call(this);this.scrollarea=document.createElement("div");this.scrollarea.style.position="absolute";this.scrollarea.style.left="0px";this.scrollarea.style.top=this.hasTitleBar()?"15px":"0px";this.scrollarea.style.width=this.getWidth()+"px";this.scrollarea.style.height="15px";this.scrollarea.style.margin="0px";this.scrollarea.style.padding="0px";this.scrollarea.style.font="normal 10px verdana";
this.scrollarea.style.borderBottom="2px solid gray";this.scrollarea.style.whiteSpace="nowrap";this.scrollarea.style.textAlign="center";this.scrollarea.style.overflowX="auto";this.scrollarea.style.overflowY="auto";this.scrollarea.style.overflow="auto";a.appendChild(this.scrollarea);return a};
draw2d.ToolPalette.prototype.setDimension=function(a,b){draw2d.WindowFigure.prototype.setDimension.call(this,a,b);null!==this.scrollarea&&(this.scrollarea.style.width=this.getWidth()+"px",this.scrollarea.style.height=this.hasTitleBar()?this.getHeight()-15+"px":this.getHeight()+"px")};draw2d.ToolPalette.prototype.addChild=function(a){this.children[a.id]=a;this.scrollarea.appendChild(a.getHTMLElement())};draw2d.ToolPalette.prototype.getChild=function(a){return this.children[a]};
draw2d.ToolPalette.prototype.getActiveTool=function(){return this.activeTool};draw2d.ToolPalette.prototype.setActiveTool=function(a){this.activeTool!=a&&null!==this.activeTool&&this.activeTool.setActive(!1);null!==a&&a.setActive(!0);this.activeTool=a};
draw2d.bpmn.FlowMenu=function(a){this.actionShowBlocksMenu=new draw2d.bpmn.ButtonShowBlocksMenu(this);draw2d.ToolPalette.call(this);this.setDropShadow(0);this.setDimension(16,16);this.currentFigure=null;this.myworkflow=a;this.added=!1;this.setDeleteable(!1);this.setCanDrag(!1);this.setResizeable(!1);this.setSelectable(!1);this.setBackgroundColor(null);this.setColor(null);this.scrollarea.style.borderBottom="0px";this.actionShowBlocksMenu.setPosition(0,0);this.addChild(this.actionShowBlocksMenu)};
draw2d.bpmn.FlowMenu.prototype=new draw2d.ToolPalette;draw2d.bpmn.FlowMenu.prototype.setAlpha=function(a){draw2d.Figure.prototype.setAlpha.call(this,a)};draw2d.bpmn.FlowMenu.prototype.hasTitleBar=function(){return!1};
draw2d.bpmn.FlowMenu.prototype.onSelectionChanged=function(a){if(a!=this.currentFigure&&!(a instanceof draw2d.Line||a instanceof draw2d.bpmn.End))if(!0==this.added&&(this.myworkflow.removeFigure(this),this.added=!1,draw2d.bpmn.getBlocksMenu().hide()),null!==a&&!1==this.added&&(!0==this.myworkflow.getEnableSmoothFigureHandling()&&this.setAlpha(0.01),this.myworkflow.addFigure(this,100,100),this.added=!0),null!==this.currentFigure&&this.currentFigure.detachMoveListener(this),this.currentFigure=a,null!==
this.currentFigure)this.currentFigure.attachMoveListener(this),this.onOtherFigureMoved(this.currentFigure)};draw2d.bpmn.FlowMenu.prototype.setWorkflow=function(a){draw2d.Figure.prototype.setWorkflow.call(this,a)};draw2d.bpmn.FlowMenu.prototype.onOtherFigureMoved=function(a){var b=a.getPosition(),c=8;a.type&&0>a.type.toString().indexOf("bpmn.Activity")&&(c=-2);this.setPosition(b.x+a.getWidth()+c,b.y+a.getHeight()/2-18)};draw2d.bpmn.FlowMenu.prototype.getMinWidth=function(){return 18};
draw2d.bpmn.FlowMenu.prototype.getMinHeight=function(){return 18};draw2d.Line=function(){this.lineColor=new draw2d.Color(0,0,0);this.stroke=1;this.graphics=this.html=this.workflow=this.parent=this.canvas=null;this.id=draw2d.UUID.create();this.startY=this.startX=30;this.endY=this.endX=100;this.alpha=1;this.isMoving=!1;this.model=null;this.zOrder=draw2d.Line.ZOrderBaseIndex;this.corona=draw2d.Line.CoronaWidth;this.properties={};this.moveListener=new draw2d.ArrayList;this.setSelectable(!0);this.setDeleteable(!0)};
draw2d.Line.prototype.type="draw2d.Line";draw2d.Line.ZOrderBaseIndex=200;draw2d.Line.CoronaWidth=5;draw2d.Line.setZOrderBaseIndex=function(a){draw2d.Line.ZOrderBaseIndex=a};draw2d.Line.setDefaultCoronaWidth=function(a){draw2d.Line.CoronaWidth=a};draw2d.Line.prototype.dispose=function(){this.workflow=this.canvas=null;null!==this.graphics&&this.graphics.clear();this.graphics=null};draw2d.Line.prototype.getZOrder=function(){return this.zOrder};
draw2d.Line.prototype.setZOrder=function(a){null!==this.html&&(this.html.style.zIndex=a);this.zOrder=a};draw2d.Line.prototype.setCoronaWidth=function(a){this.corona=a};draw2d.Line.prototype.createHTMLElement=function(){var a=document.createElement("div");a.id=this.id;a.style.position="absolute";a.style.left="0px";a.style.top="0px";a.style.height="0px";a.style.width="0px";a.style.zIndex=this.zOrder;return a};draw2d.Line.prototype.setId=function(a){this.id=a;null!==this.html&&(this.html.id=a)};
draw2d.Line.prototype.getId=function(){return this.id};draw2d.Line.prototype.getProperties=function(){return this.properties};draw2d.Line.prototype.getProperty=function(a){return this.properties[a]};draw2d.Line.prototype.setProperty=function(a,b){this.properties[a]=b;this.setDocumentDirty()};draw2d.Line.prototype.getHTMLElement=function(){null===this.html&&(this.html=this.createHTMLElement());return this.html};draw2d.Line.prototype.getWorkflow=function(){return this.workflow};
draw2d.Line.prototype.isResizeable=function(){return!0};draw2d.Line.prototype.setCanvas=function(a){this.canvas=a;null!==this.graphics&&this.graphics.clear();this.graphics=null};draw2d.Line.prototype.setWorkflow=function(a){this.workflow=a;null!==this.graphics&&this.graphics.clear();this.graphics=null};
draw2d.Line.prototype.paint=function(){if(null!==this.html)try{null===this.graphics?this.graphics=new jsGraphics(this.html):this.graphics.clear(),this.graphics.setStroke(this.stroke),this.graphics.setColor(this.lineColor.getHTMLStyle()),this.graphics.drawLine(this.startX,this.startY,this.endX,this.endY),this.graphics.paint()}catch(a){pushErrorStack(a,"draw2d.Line.prototype.paint=function()")}};draw2d.Line.prototype.attachMoveListener=function(a){this.moveListener.add(a)};
draw2d.Line.prototype.detachMoveListener=function(a){this.moveListener.remove(a)};draw2d.Line.prototype.fireMoveEvent=function(){for(var a=this.moveListener.getSize(),b=0;b<a;b++)this.moveListener.get(b).onOtherFigureMoved(this)};draw2d.Line.prototype.onOtherFigureMoved=function(){};draw2d.Line.prototype.setLineWidth=function(a){this.stroke=a;null!==this.graphics&&this.paint();this.setDocumentDirty()};draw2d.Line.prototype.setColor=function(a){this.lineColor=a;null!==this.graphics&&this.paint();this.setDocumentDirty()};
draw2d.Line.prototype.getColor=function(){return this.lineColor};draw2d.Line.prototype.setAlpha=function(a){if(a!=this.alpha){try{this.html.style.MozOpacity=a}catch(b){}try{this.html.style.opacity=a}catch(c){}try{var d=Math.round(100*a);this.html.style.filter=99<=d?"":"alpha(opacity="+d+")"}catch(e){}this.alpha=a}};draw2d.Line.prototype.setStartPoint=function(a,b){this.startX=a;this.startY=b;null!==this.graphics&&this.paint();this.setDocumentDirty()};
draw2d.Line.prototype.setEndPoint=function(a,b){this.endX=a;this.endY=b;null!==this.graphics&&this.paint();this.setDocumentDirty()};draw2d.Line.prototype.getStartX=function(){return this.startX};draw2d.Line.prototype.getStartY=function(){return this.startY};draw2d.Line.prototype.getStartPoint=function(){return new draw2d.Point(this.startX,this.startY)};draw2d.Line.prototype.getEndX=function(){return this.endX};draw2d.Line.prototype.getEndY=function(){return this.endY};
draw2d.Line.prototype.getEndPoint=function(){return new draw2d.Point(this.endX,this.endY)};draw2d.Line.prototype.isSelectable=function(){return this.selectable};draw2d.Line.prototype.setSelectable=function(a){this.selectable=a};draw2d.Line.prototype.isDeleteable=function(){return this.deleteable};draw2d.Line.prototype.setDeleteable=function(a){this.deleteable=a};
draw2d.Line.prototype.getLength=function(){return Math.sqrt((this.startX-this.endX)*(this.startX-this.endX)+(this.startY-this.endY)*(this.startY-this.endY))};draw2d.Line.prototype.getAngle=function(){var a=this.getLength(),a=-(180/Math.PI)*Math.asin((this.startY-this.endY)/a);0>a?a=this.endX<this.startX?Math.abs(a)+180:360-Math.abs(a):this.endX<this.startX&&(a=180-a);return a};
draw2d.Line.prototype.createCommand=function(a){if(a.getPolicy()==draw2d.EditPolicy.MOVE){var a=this.getStartX(),b=this.getStartY(),c=this.getEndX(),d=this.getEndY();return new draw2d.CommandMoveLine(this,a,b,c,d)}return a.getPolicy()==draw2d.EditPolicy.DELETE?!1==this.isDeleteable()?null:new draw2d.CommandDelete(this):null};draw2d.Line.prototype.setModel=function(a){null!==this.model&&this.model.removePropertyChangeListener(this);this.model=a;null!==this.model&&this.model.addPropertyChangeListener(this)};
draw2d.Line.prototype.getModel=function(){return this.model};draw2d.Line.prototype.onRemove=function(){};draw2d.Line.prototype.onContextMenu=function(a,b){var c=this.getContextMenu();null!==c&&this.workflow.showMenu(c,a,b)};draw2d.Line.prototype.getContextMenu=function(){return null};draw2d.Line.prototype.onDoubleClick=function(){};draw2d.Line.prototype.setDocumentDirty=function(){null!==this.workflow&&this.workflow.setDocumentDirty()};
draw2d.Line.prototype.containsPoint=function(a,b){return draw2d.Line.hit(this.corona,this.startX,this.startY,this.endX,this.endY,a,b)};draw2d.Line.hit=function(a,b,c,d,e,f,g){d-=b;e-=c;f-=b;g-=c;0>=f*d+g*e?d=0:(f=d-f,g=e-g,b=f*d+g*e,d=0>=b?0:b*b/(d*d+e*e));f=f*f+g*g-d;0>f&&(f=0);return Math.sqrt(f)<a};
draw2d.Connection=function(){draw2d.Line.call(this);this.targetPort=this.sourcePort=null;this.canDrag=!0;this.targetDecorator=this.sourceDecorator=null;this.sourceAnchor=new draw2d.ConnectionAnchor;this.targetAnchor=new draw2d.ConnectionAnchor;this.router=draw2d.Connection.defaultRouter;this.lineSegments=new draw2d.ArrayList;this.children=new draw2d.ArrayList;this.setColor(new draw2d.Color(0,0,115));this.setLineWidth(1)};draw2d.Connection.prototype=new draw2d.Line;
draw2d.Connection.prototype.type="draw2d.Connection";draw2d.Connection.defaultRouter=new draw2d.ManhattanConnectionRouter;draw2d.Connection.setDefaultRouter=function(a){draw2d.Connection.defaultRouter=a};draw2d.Connection.prototype.disconnect=function(){null!==this.sourcePort&&(this.sourcePort.detachMoveListener(this),this.fireSourcePortRouteEvent());null!==this.targetPort&&(this.targetPort.detachMoveListener(this),this.fireTargetPortRouteEvent())};
draw2d.Connection.prototype.reconnect=function(){null!==this.sourcePort&&(this.sourcePort.attachMoveListener(this),this.fireSourcePortRouteEvent());null!==this.targetPort&&(this.targetPort.attachMoveListener(this),this.fireTargetPortRouteEvent())};draw2d.Connection.prototype.isResizeable=function(){return this.getCanDrag()};draw2d.Connection.prototype.setCanDrag=function(a){this.canDrag=a};draw2d.Connection.prototype.getCanDrag=function(){return this.canDrag};
draw2d.Connection.prototype.addFigure=function(a,b){var c={};c.figure=a;c.locator=b;this.children.add(c);null!==this.graphics&&this.paint();var d=this,c=function(a){(a||window.event).returnValue=!1;d.getWorkflow().setCurrentSelection(d);d.getWorkflow().showLineResizeHandles(d)};a.getHTMLElement().addEventListener?a.getHTMLElement().addEventListener("mousedown",c,!1):a.getHTMLElement().attachEvent&&a.getHTMLElement().attachEvent("onmousedown",c)};
draw2d.Connection.prototype.setSourceDecorator=function(a){this.sourceDecorator=a;null!==this.graphics&&this.paint()};draw2d.Connection.prototype.getSourceDecorator=function(){return this.sourceDecorator};draw2d.Connection.prototype.setTargetDecorator=function(a){this.targetDecorator=a;null!==this.graphics&&this.paint()};draw2d.Connection.prototype.getTargetDecorator=function(){return this.targetDecorator};
draw2d.Connection.prototype.setSourceAnchor=function(a){this.sourceAnchor=a;this.sourceAnchor.setOwner(this.sourcePort);null!==this.graphics&&this.paint()};draw2d.Connection.prototype.setTargetAnchor=function(a){this.targetAnchor=a;this.targetAnchor.setOwner(this.targetPort);null!==this.graphics&&this.paint()};draw2d.Connection.prototype.setRouter=function(a){this.router=null!==a?a:new draw2d.NullConnectionRouter;null!==this.graphics&&this.paint()};draw2d.Connection.prototype.getRouter=function(){return this.router};
draw2d.Connection.prototype.setWorkflow=function(a){draw2d.Line.prototype.setWorkflow.call(this,a);for(a=0;a<this.children.getSize();a++)this.children.get(a).isAppended=!1};
draw2d.Connection.prototype.paint=function(){if(null!==this.html)try{for(var a=0;a<this.children.getSize();a++){var b=this.children.get(a);!0==b.isAppended&&this.html.removeChild(b.figure.getHTMLElement());b.isAppended=!1}null===this.graphics?this.graphics=new jsGraphics(this.html):this.graphics.clear();this.graphics.setStroke(this.stroke);this.graphics.setColor(this.lineColor.getHTMLStyle());this.startStroke();this.router.route(this);!1==this.getSource().getParent().isMoving&&!1==this.getTarget().getParent().isMoving&&
(null!==this.targetDecorator&&this.targetDecorator.paint(new draw2d.Graphics(this.graphics,this.getEndAngle(),this.getEndPoint())),null!==this.sourceDecorator&&this.sourceDecorator.paint(new draw2d.Graphics(this.graphics,this.getStartAngle(),this.getStartPoint())));this.finishStroke();for(a=0;a<this.children.getSize();a++)b=this.children.get(a),this.html.appendChild(b.figure.getHTMLElement()),b.isAppended=!0,b.locator.relocate(b.figure)}catch(c){pushErrorStack(c,"draw2d.Connection.prototype.paint=function()")}};
draw2d.Connection.prototype.getStartPoint=function(){return!1==this.isMoving?this.sourceAnchor.getLocation(this.targetAnchor.getReferencePoint()):draw2d.Line.prototype.getStartPoint.call(this)};draw2d.Connection.prototype.getEndPoint=function(){return!1==this.isMoving?this.targetAnchor.getLocation(this.sourceAnchor.getReferencePoint()):draw2d.Line.prototype.getEndPoint.call(this)};draw2d.Connection.prototype.startStroke=function(){this.oldPoint=null;this.lineSegments=new draw2d.ArrayList};
draw2d.Connection.prototype.finishStroke=function(){this.graphics.paint();this.oldPoint=null};draw2d.Connection.prototype.getPoints=function(){for(var a=new draw2d.ArrayList,b=null,c=0;c<this.lineSegments.getSize();c++)b=this.lineSegments.get(c),a.add(b.start);null!==b&&a.add(b.end);return a};
draw2d.Connection.prototype.addPoint=function(a){a=new draw2d.Point(parseInt(a.x),parseInt(a.y));if(null!==this.oldPoint){this.graphics.drawLine(this.oldPoint.x,this.oldPoint.y,a.x,a.y);var b={};b.start=this.oldPoint;b.end=a;this.lineSegments.add(b)}this.oldPoint={};this.oldPoint.x=a.x;this.oldPoint.y=a.y};
draw2d.Connection.prototype.refreshSourcePort=function(){for(var a=this.getModel().getSourceModel(),b=this.getModel().getSourcePortName(),c=this.getWorkflow().getDocument().getFigures(),d=c.getSize(),e=0;e<d;e++){var f=c.get(e);f.getModel()==a&&this.setSource(f.getOutputPort(b))}this.setRouter(this.getRouter())};
draw2d.Connection.prototype.refreshTargetPort=function(){for(var a=this.getModel().getTargetModel(),b=this.getModel().getTargetPortName(),c=this.getWorkflow().getDocument().getFigures(),d=c.getSize(),e=0;e<d;e++){var f=c.get(e);f.getModel()==a&&this.setTarget(f.getInputPort(b))}this.setRouter(this.getRouter())};
draw2d.Connection.prototype.setSource=function(a){null!==this.sourcePort&&this.sourcePort.detachMoveListener(this);this.sourcePort=a;null!==this.sourcePort&&(this.sourceAnchor.setOwner(this.sourcePort),this.fireSourcePortRouteEvent(),this.sourcePort.attachMoveListener(this),this.setStartPoint(a.getAbsoluteX(),a.getAbsoluteY()))};draw2d.Connection.prototype.getSource=function(){return this.sourcePort};
draw2d.Connection.prototype.setTarget=function(a){null!==this.targetPort&&this.targetPort.detachMoveListener(this);this.targetPort=a;null!==this.targetPort&&(this.targetAnchor.setOwner(this.targetPort),this.fireTargetPortRouteEvent(),this.targetPort.attachMoveListener(this),this.setEndPoint(a.getAbsoluteX(),a.getAbsoluteY()))};draw2d.Connection.prototype.getTarget=function(){return this.targetPort};
draw2d.Connection.prototype.onOtherFigureMoved=function(a){a==this.sourcePort?this.setStartPoint(this.sourcePort.getAbsoluteX(),this.sourcePort.getAbsoluteY()):this.setEndPoint(this.targetPort.getAbsoluteX(),this.targetPort.getAbsoluteY())};draw2d.Connection.prototype.containsPoint=function(a,b){for(var c=0;c<this.lineSegments.getSize();c++){var d=this.lineSegments.get(c);if(draw2d.Line.hit(this.corona,d.start.x,d.start.y,d.end.x,d.end.y,a,b))return!0}return!1};
draw2d.Connection.prototype.getStartAngle=function(){var a=this.lineSegments.get(0).start,b=this.lineSegments.get(0).end;this.router instanceof draw2d.BezierConnectionRouter&&(b=this.lineSegments.get(5).end);var c=Math.sqrt((a.x-b.x)*(a.x-b.x)+(a.y-b.y)*(a.y-b.y)),c=-(180/Math.PI)*Math.asin((a.y-b.y)/c);0>c?c=b.x<a.x?Math.abs(c)+180:360-Math.abs(c):b.x<a.x&&(c=180-c);return c};
draw2d.Connection.prototype.getEndAngle=function(){if(0===this.lineSegments.getSize())return 90;var a=this.lineSegments.get(this.lineSegments.getSize()-1).end,b=this.lineSegments.get(this.lineSegments.getSize()-1).start;this.router instanceof draw2d.BezierConnectionRouter&&(b=this.lineSegments.get(this.lineSegments.getSize()-5).end);var c=Math.sqrt((a.x-b.x)*(a.x-b.x)+(a.y-b.y)*(a.y-b.y)),c=-(180/Math.PI)*Math.asin((a.y-b.y)/c);0>c?c=b.x<a.x?Math.abs(c)+180:360-Math.abs(c):b.x<a.x&&(c=180-c);return c};
draw2d.Connection.prototype.fireSourcePortRouteEvent=function(){for(var a=this.sourcePort.getConnections(),b=0;b<a.getSize();b++)a.get(b).paint()};draw2d.Connection.prototype.fireTargetPortRouteEvent=function(){for(var a=this.targetPort.getConnections(),b=0;b<a.getSize();b++)a.get(b).paint()};
draw2d.Connection.prototype.createCommand=function(a){return a.getPolicy()==draw2d.EditPolicy.MOVE?new draw2d.CommandReconnect(this):a.getPolicy()==draw2d.EditPolicy.DELETE&&!0==this.isDeleteable()?new draw2d.CommandDelete(this):null};
draw2d.bpmn.Connection=function(){draw2d.Connection.call(this);this.targetPort=this.sourcePort=null;this.lineSegments=[];this.setTargetDecorator(new draw2d.bpmn.ArrowConnectionDecorator);this.setColor(new draw2d.Color("#0076aa"));this.setLineWidth(2);this.label=new draw2d.Label("");this.label.setBackgroundColor(new draw2d.Color(230,230,250));this.label.setBorder(new draw2d.LineBorder(1));draw2d.bpmn.setVisibility(this.label,!1);var a=TeamTime.jQuery,b=this;a(b.label.html).showBalloon({contents:'<input class="editable_label p'+
b.label.id+'" type="text" size="15" />'}).hideBalloon().on("bpmn.Label.hideballoon",function(){a(this).hideBalloon()}).on("bpmn.Label.showballoon",function(){draw2d.bpmn.setVisibility(b.label,!0);var c=this;a(c).showBalloon();a("input.editable_label.p"+b.label.id).val(b.label.getText()).focus().change(function(){b.label.setText(a(this).val());a(c).hideBalloon()}).blur(function(){a(c).hideBalloon()})});this.addFigure(this.label,new draw2d.ManhattanMidpointLocator(this));draw2d.bpmn.addConextMenu(this)};
draw2d.bpmn.Connection.prototype=new draw2d.Connection;draw2d.bpmn.Connection.prototype.setWorkflow=function(a){draw2d.Connection.prototype.setWorkflow.call(this,a);this.targetPort&&(a=this.targetPort.getParent(),this.setZOrder(parseInt(a.getZOrder())-1));draw2d.bpmn.addConnectionConextMenu(this)};
draw2d.bpmn.Connection.prototype.getContextMenuItems=function(){return{"delete":{name:i18n.bpmn.delete_item,icon:"delete"},set_label:{name:i18n.bpmn.add_label,icon:"paste"},remove_label:{name:i18n.bpmn.remove_label,icon:"delete"}}};
draw2d.bpmn.Connection.prototype.onContextMenuCmd=function(a){var b=TeamTime.jQuery;"delete"==a.key?(new draw2d.CommandDelete(a.figure)).execute():"set_label"==a.key?b(a.figure.label.html).trigger("bpmn.Label.showballoon"):"remove_label"==a.key&&draw2d.bpmn.setVisibility(a.figure.label,!1);console.log("Connection "+a.key)};draw2d.Locator=function(){};draw2d.Locator.prototype.type="draw2d.Locator";draw2d.Locator.prototype.relocate=function(){};
draw2d.ConnectionLocator=function(a){draw2d.Locator.call(this);this.connection=a};draw2d.ConnectionLocator.prototype=new draw2d.Locator;draw2d.ConnectionLocator.prototype.type="draw2d.ConnectionLocator";draw2d.ConnectionLocator.prototype.getConnection=function(){return this.connection};draw2d.BezierMidpointLocator=function(a){draw2d.ConnectionLocator.call(this,a)};draw2d.BezierMidpointLocator.prototype=new draw2d.ConnectionLocator;draw2d.BezierMidpointLocator.prototype.type="draw2d.BezierMidpointLocator";
draw2d.BezierMidpointLocator.prototype.relocate=function(a){var b=this.getConnection(),c=new draw2d.Point,d=b.getPoints(),e=Math.floor((d.getSize()-2)/2);d.getSize()<=e+1||(b=d.get(e),d=d.get(e+1),c.x=(d.x-b.x)/2+b.x+5,c.y=(d.y-b.y)/2+b.y+5,a.setPosition(c.x,c.y))};draw2d.ManhattanMidpointLocator=function(a){draw2d.ConnectionLocator.call(this,a)};draw2d.ManhattanMidpointLocator.prototype=new draw2d.ConnectionLocator;draw2d.ManhattanMidpointLocator.prototype.type="draw2d.ManhattanMidpointLocator";
draw2d.ManhattanMidpointLocator.prototype.relocate=function(a){var b=this.getConnection(),c=new draw2d.Point,d=b.getPoints(),e=Math.floor((d.getSize()-2)/2);d.getSize()<=e+1||(b=d.get(e),d=d.get(e+1),c.x=(d.x-b.x)/2+b.x+5,c.y=(d.y-b.y)/2+b.y+5,a.setPosition(c.x,c.y))};draw2d.Dimension=function(a,b,c,d){draw2d.Point.call(this,a,b);this.w=c;this.h=d};draw2d.Dimension.prototype=new draw2d.Point;draw2d.Dimension.prototype.type="draw2d.Dimension";
draw2d.Dimension.prototype.translate=function(a,b){this.x+=a;this.y+=b;return this};draw2d.Dimension.prototype.resize=function(a,b){this.w+=a;this.h+=b;return this};draw2d.Dimension.prototype.setBounds=function(a){this.x=a.x;this.y=a.y;this.w=a.w;this.h=a.h;return this};draw2d.Dimension.prototype.isEmpty=function(){return 0>=this.w||0>=this.h};draw2d.Dimension.prototype.getWidth=function(){return this.w};draw2d.Dimension.prototype.getHeight=function(){return this.h};
draw2d.Dimension.prototype.getRight=function(){return this.x+this.w};draw2d.Dimension.prototype.getBottom=function(){return this.y+this.h};draw2d.Dimension.prototype.getTopLeft=function(){return new draw2d.Point(this.x,this.y)};draw2d.Dimension.prototype.getCenter=function(){return new draw2d.Point(this.x+this.w/2,this.y+this.h/2)};draw2d.Dimension.prototype.getBottomRight=function(){return new draw2d.Point(this.x+this.w,this.y+this.h)};
draw2d.Dimension.prototype.equals=function(a){return this.x==a.x&&this.y==a.y&&this.w==a.w&&this.h==a.h};draw2d.SnapToHelper=function(a){this.workflow=a};draw2d.SnapToHelper.NORTH=1;draw2d.SnapToHelper.SOUTH=4;draw2d.SnapToHelper.WEST=8;draw2d.SnapToHelper.EAST=16;draw2d.SnapToHelper.CENTER=32;draw2d.SnapToHelper.NORTH_EAST=draw2d.SnapToHelper.NORTH|draw2d.SnapToHelper.EAST;draw2d.SnapToHelper.NORTH_WEST=draw2d.SnapToHelper.NORTH|draw2d.SnapToHelper.WEST;
draw2d.SnapToHelper.SOUTH_EAST=draw2d.SnapToHelper.SOUTH|draw2d.SnapToHelper.EAST;draw2d.SnapToHelper.SOUTH_WEST=draw2d.SnapToHelper.SOUTH|draw2d.SnapToHelper.WEST;draw2d.SnapToHelper.NORTH_SOUTH=draw2d.SnapToHelper.NORTH|draw2d.SnapToHelper.SOUTH;draw2d.SnapToHelper.EAST_WEST=draw2d.SnapToHelper.EAST|draw2d.SnapToHelper.WEST;draw2d.SnapToHelper.NSEW=draw2d.SnapToHelper.NORTH_SOUTH|draw2d.SnapToHelper.EAST_WEST;draw2d.SnapToHelper.prototype.snapPoint=function(a,b){return b};
draw2d.SnapToHelper.prototype.snapRectangle=function(a){return a};draw2d.SnapToHelper.prototype.onSetDocumentDirty=function(){};draw2d.SnapToGeometry=function(a){draw2d.SnapToHelper.call(this,a);this.cols=this.rows=null};draw2d.SnapToGeometry.prototype=new draw2d.SnapToHelper;draw2d.SnapToGeometry.THRESHOLD=5;
draw2d.SnapToGeometry.prototype.snapPoint=function(a,b,c){(null===this.rows||null===this.cols)&&this.populateRowsAndCols();if(0!==(a&draw2d.SnapToHelper.EAST)){var d=this.getCorrectionFor(this.cols,b.getX()-1,1);d!==draw2d.SnapToGeometry.THRESHOLD&&(a&=~draw2d.SnapToHelper.EAST,c.x+=d)}0!==(a&draw2d.SnapToHelper.WEST)&&(d=this.getCorrectionFor(this.cols,b.getX(),-1),d!==draw2d.SnapToGeometry.THRESHOLD&&(a&=~draw2d.SnapToHelper.WEST,c.x+=d));0!==(a&draw2d.SnapToHelper.SOUTH)&&(d=this.getCorrectionFor(this.rows,
b.getY()-1,1),d!==draw2d.SnapToGeometry.THRESHOLD&&(a&=~draw2d.SnapToHelper.SOUTH,c.y+=d));0!==(a&draw2d.SnapToHelper.NORTH)&&(b=this.getCorrectionFor(this.rows,b.getY(),-1),b!==draw2d.SnapToGeometry.THRESHOLD&&(a&=~draw2d.SnapToHelper.NORTH,c.y+=b));return a};
draw2d.SnapToGeometry.prototype.snapRectangle=function(a,b){var c=a.getTopLeft(),d=a.getBottomRight(),e=this.snapPoint(draw2d.SnapToHelper.NORTH_WEST,a.getTopLeft(),c);b.x=c.x;b.y=c.y;c=this.snapPoint(draw2d.SnapToHelper.SOUTH_EAST,a.getBottomRight(),d);e&draw2d.SnapToHelper.WEST&&(b.x=d.x-a.getWidth());e&draw2d.SnapToHelper.NORTH&&(b.y=d.y-a.getHeight());return e|c};
draw2d.SnapToGeometry.prototype.populateRowsAndCols=function(){this.rows=[];this.cols=[];for(var a=this.workflow.getDocument().getFigures(),b=0,c=0;c<a.getSize();c++){var d=a.get(c);d!=this.workflow.getCurrentSelection()&&(d=d.getBounds(),this.cols[3*b]=new draw2d.SnapToGeometryEntry(-1,d.getX()),this.rows[3*b]=new draw2d.SnapToGeometryEntry(-1,d.getY()),this.cols[3*b+1]=new draw2d.SnapToGeometryEntry(0,d.x+(d.getWidth()-1)/2),this.rows[3*b+1]=new draw2d.SnapToGeometryEntry(0,d.y+(d.getHeight()-1)/
2),this.cols[3*b+2]=new draw2d.SnapToGeometryEntry(1,d.getRight()-1),this.rows[3*b+2]=new draw2d.SnapToGeometryEntry(1,d.getBottom()-1),b++)}};
draw2d.SnapToGeometry.prototype.getCorrectionFor=function(a,b,c){for(var d=draw2d.SnapToGeometry.THRESHOLD,e=draw2d.SnapToGeometry.THRESHOLD,f=0;f<a.length;f++){var g=a[f],h;-1===g.type&&0!==c?(h=Math.abs(b-g.location),h<d&&(d=h,e=g.location-b)):0===g.type&&0===c?(h=Math.abs(b-g.location),h<d&&(d=h,e=g.location-b)):1===g.type&&0!==c&&(h=Math.abs(b-g.location),h<d&&(d=h,e=g.location-b))}return e};draw2d.SnapToGeometry.prototype.onSetDocumentDirty=function(){this.cols=this.rows=null};
draw2d.SnapToGrid=function(a){draw2d.SnapToHelper.call(this,a)};draw2d.SnapToGrid.prototype=new draw2d.SnapToHelper;draw2d.SnapToGrid.prototype.type="draw2d.SnapToGrid";draw2d.SnapToGrid.prototype.snapPoint=function(a,b,c){c.x=this.workflow.gridWidthX*Math.floor((b.x+this.workflow.gridWidthX/2)/this.workflow.gridWidthX);c.y=this.workflow.gridWidthY*Math.floor((b.y+this.workflow.gridWidthY/2)/this.workflow.gridWidthY);return 0};
draw2d.SnapToGrid.prototype.snapRectangle=function(a,b){b.x=a.x;b.y=a.y;b.w=a.w;b.h=a.h;return 0};
var SwimlanePanelBlocksMenu={currentObject:null,init:function(){var a=TeamTime.jQuery;this.coords=this.currentObject=null;var b=this,c=function(a,b){if(!a)return null;a.setPosition(a.getX()+b,a.getY());if(!a.getPort("output"))return a;var d=a.getPort("output").getConnections();return 0<d.getSize()?c(d.get(0).targetPort.getParent(),b):a},d=function(a,d){var g=draw2d.bpmn.getSwimlanePanel(),h=draw2d.bpmn.getWorkflow(),i=new draw2d.bpmn[a],k;if(!b.currentObject)return h.addFigure(i,b.coords.x,b.coords.y),
"End"==a?(i.setPosition(i.getX()+i.getWidth()+80,i.getY()),k={x:i.getX(),y:i.getY()},i.parentCol=g.getColumn(k),i.parentRow=g.getRow(k),i=new draw2d.bpmn.Start,h.addFigure(i,b.coords.x,b.coords.y)):"subprocess"==d&&(i.makeSubProcess(null),i.toggle(i)),k={x:i.getX(),y:i.getY()},i.parentCol=g.getColumn(k),i.parentRow=g.getRow(k),g.blocksMenu.hide(),i;g=b.currentObject.palette.currentFigure;h.addFigure(i,g.getX()+g.getWidth()+40,g.getY()+(g.getHeight()-i.getHeight())/2);i.parentCol=g.getParentCol();
i.parentRow=g.getParentRow();"subprocess"==d&&(i.makeSubProcess(null),i.toggle(i));if(k=g.getParent())k.addChild(i),k.setDimension(k.getWidth()+i.getWidth()+40,Math.max(k.getHeight(),i.getHeight()+60));k=null;var j=g.getPort("output").getConnections();0<j.getSize()?(k=j.get(0).targetPort.getParent(),h.removeFigure(j.get(0)),j=c(k,i.getWidth()+40),draw2d.bpmn.getSwimlanePanel().setWidthForColumn(i.getParentCol(),j)):draw2d.bpmn.getSwimlanePanel().setWidthForColumn(i.getParentCol(),i);j=new draw2d.bpmn.Connection;
j.setSource(g.getPort("output"));j.setTarget(i.getPort("input"));h.addFigure(j);k&&(j=new draw2d.bpmn.Connection,j.setSource(i.getPort("output")),j.setTarget(k.getPort("input")),h.addFigure(j));return i};a("#SwimlanePanel-blocksmenu td.bpmn_insert_menu_item").mouseover(function(){a("#SwimlanePanel-blocksmenu-insert_block").text(a(this).attr("data-title"))}).mouseout(function(){a("#SwimlanePanel-blocksmenu-insert_block").text("Insert")});a("#SwimlanePanel-blocksmenu td.cmdMoreBlocks").click(function(){a(this).hasClass("expanded")?
(a(this).removeClass("expanded"),a("#SwimlanePanel-blocksmenu tr.bpmn_insert_menu_hidden").hide()):(a(this).addClass("expanded"),a("#SwimlanePanel-blocksmenu tr.bpmn_insert_menu_hidden").show())});a("#SwimlanePanel-blocksmenu td.cmdInsertActivity").click(function(){d("Activity")}).attr("data-title","Insert an Activity");a("#SwimlanePanel-blocksmenu td.cmdInsertConditionXOR").click(function(){d("ConditionXOR")}).attr("data-title","Insert a Decision");a("#SwimlanePanel-blocksmenu td.cmdInsertSubprocess").click(function(){d("Activity",
"subprocess")}).attr("data-title","Insert a Sub-process");a("#SwimlanePanel-blocksmenu td.cmdInsertMessage").click(function(){d("Message")}).attr("data-title","Insert a Message Event");a("#SwimlanePanel-blocksmenu td.cmdInsertConditionAND").click(function(){d("ConditionAND")}).attr("data-title","Insert a Simple Split");a("#SwimlanePanel-blocksmenu td.cmdInsertConditionOR").click(function(){d("ConditionOR")}).attr("data-title","Insert a Conditional Split");a("#SwimlanePanel-blocksmenu td.cmdInsertLinkedSubprocess").click(function(){d("Activity").setViewState("linked")}).attr("data-title",
"Insert a Linked Sub-process");a("#SwimlanePanel-blocksmenu td.cmdInsertTimer").click(function(){d("Timer")}).attr("data-title","Insert a Timer Event");a("#SwimlanePanel-blocksmenu td.cmdInsertException").click(function(){d("Exception")}).attr("data-title","Insert an Exception Event");a("#SwimlanePanel-blocksmenu td.cmdInsertEnd").click(function(){d("End")}).attr("data-title","Insert an End Event")},show:function(a,b){var c=TeamTime.jQuery;this.currentObject=a;this.coords=b;var d=draw2d.bpmn.getSwimlanePanel().getOffset(),
e=d.left,d=d.top;this.currentObject?(e+=this.currentObject.palette.getX()+24,d+=this.currentObject.palette.getY()+16):(e=this.coords.x+6,d=this.coords.y+6);c("#SwimlanePanel-blocksmenu td.cmdMoreBlocks").removeClass("expanded");c("#SwimlanePanel-blocksmenu tr.bpmn_insert_menu_hidden").hide();c("#SwimlanePanel-blocksmenu").css("left",e).css("top",d).show()},hide:function(){var a=TeamTime.jQuery;a("#SwimlanePanel-blocksmenu").hide()}},SwimlanePanelToolbar={init:function(){var a=TeamTime.jQuery,b=parent.SwimlanePanelButtons,
c=draw2d.bpmn.getSwimlanePanel(),d=draw2d.bpmn.getWorkflow(),e=new draw2d.bpmn.JsonSerializer,f=function(){var f=e.serialize(c);if(c.checkMaxSizeDiagram(f)){console.log(c.changedFigures.getItems());var h=function(a){for(var b=0,c=a.length;b<c;b++)if(a[b].paramsData&&a[b].paramsData._id){var e=d.getFigure(a[b].id);e.paramsData||(e.paramsData={});e.paramsData._id=a[b].paramsData._id;e.paramsData.name=a[b].paramsData.name;console.log(e.paramsData.name);console.log(e.paramsData._id);a[b].children&&0<
a[b].children.length&&(a[b].children=h(a[b].children))}},i=TeamTime.getUrlForTask("saveDiagram");b.isTemplate&&(i=TeamTime.getUrlForController("template")+"&task=saveDiagram");a.post(i,{id:purl().param("id"),data:f},function(a){try{var b=JSON.parse(a);b.figures=h(b.figures);c.changedFigures.clear();alert(i18n.SwimlanePanel.diagram_saved)}catch(d){alert(d)}})}};a(b.buttonGrid).button().click(function(){d.setGridWidth(10,10);a(this).attr("checked")?(d.setBackgroundImage(draw2d.bpmn.assetsUrl+"js/draw2d/bpmn/resources/grid_10.png",
!0),d.setSnapToGrid(!0)):(d.setBackgroundImage(null,!1),d.setSnapToGrid(!1))});parent.submitbutton=function(a){switch(a){case "playprocess":a=TeamTime.getUrlForController()+"&tmpl=component&view=processplay&id="+purl().param("id");parent.TeamTime.jQuery.fancybox({href:a,type:"iframe",width:800,height:Math.max(parent.TeamTime.jQuery("body").height(),650),autoSize:!1,padding:0,scrolling:"no",openEffect:"none",closeEffect:"none",helpers:{overlay:{css:{background:"rgba(0, 0, 0, 0.4)"}}}});break;case "saveprocess":case "savetemplate":f();
break;case "exittemplate":case "exitprocess":a=TeamTime.getUrlForController(),b.isTemplate&&(a=TeamTime.getUrlForController("template")),parent.location.href=a}return!1};a(b.selectorShowInfo).change(function(){c.showInfo(a(b.selectorShowInfo).val())})}},SwimlaneChangedFigures=function(){var a={};this.setItem=function(b,c){a[b]=c};this.getItem=function(b){return a[b]};this.removeItem=function(b){delete a[b]};this.getItems=function(){return a};this.clear=function(){a={}}},SwimlanePanel=function(){this.name=
"";this.columns=this.rows=this.workflow=this.changedFigures=null;var a=TeamTime.jQuery,b=this,c=function(b,c){var d="";return d="row"==c?a(b).children("span.rowTitle").text():a(b).text()},d=function(b,c,d){if("row"==d){a(b).children("span.rowTitle").text(c);d=a(b).data("verticalTextObj");null!=d&&d.paper.remove();var d=a(b).parent().width(),e=a(b).parent().height(),d=Raphael(b[0]).text(10,e/2-10,c).attr({font:"12px normal",fill:a(b).css("color"),"clip-rect":[0,0,d,e-20].join()}).rotate(270);a(b).data("verticalTextObj",
d)}else a(b).text(c)},e=function(b,c,d){for(var e={src:[],dest:[]},b=a(b).attr("id"),f=0;f<c.length;f++)c[f]!=d[f]&&(b==d[f]?e.src=[c[f],d[f]]:e.dest.push([c[f],d[f]]));return e},f=function(){var c,d;a(b.rows).sortable({start:function(b,d){c=a(this).sortable("toArray");m(d.item,this)},update:function(f,g){d=a(this).sortable("toArray");b.moveRows(e(g.item,c,d))}});a(b.rows).disableSelection()},g=function(){var c,d;a(b.columns).sortable({start:function(b,d){c=a(this).sortable("toArray");j(d.item,this)},
update:function(f,g){d=a(this).sortable("toArray");b.moveColumns(e(g.item,c,d))}});a(b.columns).disableSelection()},h=function(e,f){var g;g="row"==f?"right":"bottom";a(e).showBalloon({position:g,contents:'<input class="editable_title p'+a(e).attr("id")+'" type="text" size="15" />'}).hideBalloon().on("SwimlinePanel.hideballoon",function(){a(this).hideBalloon()}).click(function(){b.hideBalloons()}).dblclick(function(){b.hideBalloons();var g=this;a(g).showBalloon();a("input.editable_title.p"+a(e).attr("id")).val(c(a(g).children(".title"),
f)).change(function(){d(a(g).children(".title"),a(this).val(),f);a(g).hideBalloon()})})},i=function(e,f){a(f).height(Math.max(a(f).height(),120));var g=a(f).children(".title");a(g).addClass("vertical_text");d(g,c(g,"row"),"row");a(f).resizable({handles:"s",minHeight:120,stop:function(e,h){b.moveItemsAfter(a(f).attr("id"),{dx:0,dy:h.size.height-h.originalSize.height},"row");var i=a(f).height();a(f).children("div.bottom_line").css("top",i+1+"px");d(g,c(g,"row"),"row")}});var i=a(f).width(),j=a(f).height(),
k=document.createElement("div");a(k).addClass("horizontal_line").addClass("bottom_line").css("left",i+"px").css("top",j+1+"px");a(f).append(k);k=document.createElement("div");a(k).addClass("horizontal_line").addClass("top_line").css("left",i+"px").css("top","-1px");a(f).append(k);h(f,"row")},k=function(c,d){a(d).width(Math.max(a(d).width(),120));a(d).resizable({handles:"e",minWidth:120,stop:function(c,e){b.moveItemsAfter(a(d).attr("id"),{dx:e.size.width-e.originalSize.width,dy:0},"column");a(d).children("div.right_line").css("left",
a(d).width()+1+"px")}});var e=a(d).width(),f=a(d).height(),g=document.createElement("div");a(g).addClass("vertical_line").addClass("right_line").css("left",e+1+"px").css("top",f+"px");a(d).append(g);g=document.createElement("div");a(g).addClass("vertical_line").addClass("left_line").css("left","-1px").css("top",f+"px");a(d).append(g);h(d,"column")},j=function(b,c){var d=0,e=0,f=null;a(c).children("li").each(function(c,g){a(b).attr("id")==a(g).attr("id")?f=g:null==f&&(d=a(g).position().left,e=a(g).width())});
null!=f&&a(f).data("oldPositionX",d+e)},m=function(b,c){var d=0,e=0,f=null;a(c).children("li").each(function(c,g){a(b).attr("id")==a(g).attr("id")?f=g:null==f&&(d=a(g).position().top,e=a(g).height())});null!=f&&a(f).data("oldPositionY",d+e)},l=function(){var b=document.createElement("div");a(b).addClass("active_cell").css("display","none");a(document.body).append(b)},n=function(){var e=function(e){var f={add:{name:i18n.SwimlanePanel.add_row,icon:"paste"},"delete":{name:i18n.SwimlanePanel.remove_row,
icon:"delete"},separator1:"-----"};_.each(e,function(a){f["role"+a.id]={name:a.name}});a.contextMenu({zIndex:1E3,selector:".parent_row",items:f,events:{show:function(){draw2d.bpmn.getSwimlanePanel().blocksMenu.hide()}},callback:function(e,g){var h=a(g.$trigger).attr("id");if("add"==e){var s=b.getNewRow();a("#"+h).after(s[0]);h=s[1];i(0,a("#"+h)[0]);s=a("#"+h).height();b.moveItemsAfter(h,{dx:0,dy:s},"row")}else if("delete"==e)a:{var j=c(a("#"+h).children(".title"),"row"),s=b.getItems(h,"row"),k=s.length;
if(0<k){if(!confirm(draw2d.bpmn.strReplaceNamed(i18n.SwimlanePanel.prompt_remove_row,{name:j})))break a;for(j=0;j<k;j++)(new draw2d.CommandDelete(s[j])).execute()}s=a("#"+h).height();b.moveItemsAfter(h,{dx:0,dy:-s},"row");a("#"+h).remove();0==a(b.rows).children("li").length&&(a(b.rows).append(b.getNewRow()[0]),a(b.rows).children("li").each(i))}else 0==e.indexOf("role")&&(h=a(g.$trigger).children(".title"),d(a(h),f[e].name,"row"))}})};a.get(TeamTime.getUrlForTask("loadRoles"),function(a){e(JSON.parse(a))})},
r=function(){a.contextMenu({zIndex:1E3,selector:".parent_column",items:{add:{name:i18n.SwimlanePanel.add_column,icon:"paste"},"delete":{name:i18n.SwimlanePanel.remove_column,icon:"delete"}},events:{show:function(){draw2d.bpmn.getSwimlanePanel().blocksMenu.hide()}},callback:function(d,e){var f=a(e.$trigger).attr("id");if("add"==d){var g=b.getNewColumn();a("#"+f).after(g[0]);f=g[1];k(0,a("#"+f)[0]);g=a("#"+f).width();b.moveItemsAfter(f,{dx:g,dy:0},"column")}else if("delete"==d)a:{var h=c(a("#"+f).children(".title"),
"column"),g=b.getItems(f,"column"),i=g.length;if(0<i){if(!confirm(draw2d.bpmn.strReplaceNamed(i18n.SwimlanePanel.prompt_remove_column,{name:h})))break a;for(h=0;h<i;h++)(new draw2d.CommandDelete(g[h])).execute()}g=a("#"+f).width();b.moveItemsAfter(f,{dx:-g,dy:0},"column");a("#"+f).remove();0==a(b.columns).children("li").length&&(a(b.columns).append(b.getNewColumn()[0]),a(b.columns).children("li").each(k))}}})},p=function(c){for(var d=1,c="#"+b.name+"-"+("row"==c?"row":"col");0<a(c+d).length;)d++;
return d},o=function(){return{date:"",plan:"0",fact:"0",price:"0",state:"",part:"0",userName:""}},q=function(c){var d=o(),d=_.clone(d);c.parentRow&&(d.userName=b.getTitle(a(c.parentRow),"row"));c.paramsData&&(d.plan=parseFloat(c.paramsData.hoursPlan/60).toFixed(2).toString().replace(".",","),d.price=parseFloat(c.paramsData.hourlyRate*(c.paramsData.hoursPlan/60)).toFixed(2).toString().replace(".",","),c.paramsData.userName&&(d.userName=c.paramsData.userName));return d};this.getNewColumn=function(a,
b){if(!b)var c=p("column"),b=this.name+"-col"+c;return['<li class="ui-state-default parent_column" id="'+b+'"><span class="ui-icon ui-icon-arrowthick-2-e-w"></span><div class="title">'+(a||"new milestone "+c)+"</div></li>",b]};this.getNewRow=function(a,b){if(!b)var c=p("row"),b=this.name+"-row"+c;return['<li class="ui-state-default parent_row" id="'+b+'"><span class="ui-icon ui-icon-arrowthick-2-n-s"></span><div class="title"><span class="rowTitle">'+(a||"new participant "+c)+"</span></div></li>",
b]};this.getTitle=function(b,d){return c(a(b).children(".title"),d)};this.init=function(b){this.name=b||"SwimlanePanel";this.changedFigures=new SwimlaneChangedFigures;this.workflow=new draw2d.Workflow(this.name+"-paintarea");this.workflow.setBackgroundImage(null,!1);this.workflow.getCommandStack().addCommandStackEventListener(new draw2d.bpmn.CommandListener);draw2d.bpmn.addWorkflowConextMenu(this.workflow);this.workflow.addSelectionListener(new draw2d.bpmn.FlowMenu(this.workflow));this.workflow.addSelectionListener(new draw2d.bpmn.SelectionChangeListener);
this.rows=a("#"+this.name+"-rows");this.columns=a("#"+this.name+"-cols");this.blocksMenu=SwimlanePanelBlocksMenu;this.createPanel()};this.createPanel=function(){f();g();var c;for(c=0;4>c;c++)a(this.columns).append(this.getNewColumn()[0]);a(this.columns).children("li").each(k);for(c=0;4>c;c++)a(this.rows).append(this.getNewRow()[0]);a(this.rows).children("li").each(i);l();SwimlanePanelToolbar.init();this.blocksMenu.init();n();r();a(document).keyup(function(a){27==a.which&&b.hideBalloons()})};this.getColumn=
function(b){var c=null,d=a(this.columns).position().left;a(this.columns).children("li").each(function(e,f){var g=a(f).position().left-d;b.x>=g&&b.x<=g+a(f).width()&&(c=f)});return c};this.getRow=function(b){var c=null,d=a(this.rows).position().top;a(this.rows).children("li").each(function(e,f){var g=a(f).position().top-d;b.y>=g&&b.y<=g+a(f).height()&&(c=f)});return c};this.getMaxX=function(a){for(var b=0,a=this.getItems(a,"column"),c=a.length,d=0;d<c;d++){var e=a[d].getX()+a[d].getWidth();e>b&&(b=
e)}return b};this.getMaxY=function(a){for(var b=0,a=this.getItems(a,"row"),c=a.length,d=0;d<c;d++){var e=a[d].getY()+a[d].getHeight();e>b&&(b=e)}return b};this.setColumnMinWidth=function(b){if(null!=b){console.log("set column width"+a(b).attr("id"));var c=a(this.columns).position().top,c=a(b).position().left-c,c=this.getMaxX(a(b).attr("id"))+10-c;a(b).resizable("option","minWidth",Math.max(c,120))}};this.setRowMinHeight=function(b){if(null!=b){console.log("set row height"+a(b).attr("id"));var c=a(this.rows).position().top,
c=a(b).position().top-c,c=this.getMaxY(a(b).attr("id"))+10-c;a(b).resizable("option","minHeight",Math.max(c,120))}};this.setMinBounds=function(b){if(!(null==b.parentCol||null==b.parentRow)){var c=a(this.rows).position().top,c=a(b.parentRow).position().top-c,d=b.getY()+b.getHeight()+10-c,e=a(b.parentRow).resizable("option","minHeight");d>e||(d=this.getMaxY(a(b.parentRow).attr("id"))+10-c);a(b.parentRow).resizable("option","minHeight",Math.max(d,120));c=a(this.columns).position().top;c=a(b.parentCol).position().left-
c;d=b.getX()+b.getWidth()+10-c;e=a(b.parentCol).resizable("option","minWidth");d>e||(d=this.getMaxX(a(b.parentCol).attr("id"))+10-c);a(b.parentCol).resizable("option","minWidth",Math.max(d,120))}};this.getItems=function(b,c,d){for(var c="row"==c?"parentRow":"parentCol",d=d||!0,b=a("#"+b),e=[],f=this.workflow.getFigures(),g=f.getSize(),h=0;h<g;h++){var i=f.get(h);d&&null!=i.getParent()||a(i[c]).attr("id")==a(b).attr("id")&&e.push(i)}return e};this.moveRows=function(b){var c=b.dest.length,d,e,f,g,h;
d=a("#"+b.src[0]).position().top-a("#"+b.src[1]).position().top;h=a("#"+b.src[1]).height();0>d&&(h=-h);for(d=0;d<c;d++){g=this.getItems(b.dest[d][1],"row");f=g.length;for(e=0;e<f;e++)g[e].setPosition(g[e].getX(),g[e].getY()+h)}d=a("#"+b.src[1]).position().top-a("#"+b.src[1]).data("oldPositionY");g=this.getItems(b.src[1],"row");f=g.length;for(e=0;e<f;e++)g[e].setPosition(g[e].getX(),g[e].getY()+d)};this.moveColumns=function(b){var c=b.dest.length,d,e,f,g,h;d=a("#"+b.src[0]).position().left-a("#"+b.src[1]).position().left;
h=a("#"+b.src[1]).width();0>d&&(h=-h);for(d=0;d<c;d++){g=this.getItems(b.dest[d][1],"column");f=g.length;for(e=0;e<f;e++)g[e].setPosition(g[e].getX()+h,g[e].getY())}d=a("#"+b.src[1]).position().left-a("#"+b.src[1]).data("oldPositionX");g=this.getItems(b.src[1],"column");f=g.length;for(e=0;e<f;e++)g[e].setPosition(g[e].getX()+d,g[e].getY())};this.moveItemsAfter=function(c,d,e){var f=!1,g,h=0,i;"row"==e?a(this.rows).children("li").each(function(j,k){if(a(k).attr("id")==c)f=!0;else if(f){g=b.getItems(a(k).attr("id"),
e);h=g.length;for(i=0;i<h;i++)g[i].setPosition(g[i].getX(),g[i].getY()+d.dy)}}):"column"==e&&a(this.columns).children("li").each(function(j,k){if(a(k).attr("id")==c)f=!0;else if(f){g=b.getItems(a(k).attr("id"),e);h=g.length;for(i=0;i<h;i++)g[i].setPosition(g[i].getX()+d.dx,g[i].getY())}})};this.getOffset=function(){return{left:a(this.columns).offset().left,top:a(this.rows).offset().top}};this.hideActiveCell=function(){a("div.active_cell").css("display","none")};this.showActiveCell=function(b){if(!(null==
b.parentCol||null==b.parentRow)){var c=a(b.parentCol).position().left+a(this.columns).offset().left,d=a(b.parentRow).position().top+a(this.rows).offset().top;a("div.active_cell").css("top",d).css("left",c).css("width",a(b.parentCol).width()+2).css("height",a(b.parentRow).height()+2).css("display","")}};this.hideBalloons=function(){a(this.rows).children("li").each(function(b,c){a(c).trigger("SwimlinePanel.hideballoon")});a(this.columns).children("li").each(function(b,c){a(c).trigger("SwimlinePanel.hideballoon")})};
this.clear=function(){a(this.rows).children("li").each(function(b,c){a(c).children("div.horizontal_line").remove();a(c).remove()});a(this.columns).children("li").each(function(b,c){a(c).children("div.vertical_line").remove();a(c).remove()})};this.appendRow=function(b,c,d){a(this.rows).append(this.getNewRow(b,c)[0]);a(this.rows).children("li#"+c).css("height",d);a(this.rows).children("li").each(i)};this.appendColumn=function(b,c,d){a(this.columns).append(this.getNewColumn(b,c)[0]);a(this.columns).children("li#"+
c).css("width",d);a(this.columns).children("li").each(k)};this.setWidthForColumn=function(b,c){var d=c.getX()+c.getWidth(),e=a(b).position().left-a(this.columns).position().left+a(b).width(),d=d-e;0>=d||(a(b).width(a(b).width()+d+10),this.moveItemsAfter(a(b).attr("id"),{dx:d+10,dy:0},"column"),a(b).resizable("option","minWidth",a(b).width()),a(b).children("div.right_line").css("left",a(b).width()+1+"px"))};this.getWidth=function(){return a("#SwimlanePanel-cols-container").width()};this.getHeight=
function(){return a("#SwimlanePanel-rows-container").height()};this.showInfo=function(c){var d=this.workflow.getFigures().asArray(),e=[],f=[];_.each(d,function(a){a instanceof draw2d.bpmn.Activity&&(a.paramsData&&(a.paramsData._id||a.paramsData.linkedId)?f.push({id:a.id,_id:a.paramsData._id,linkedId:a.paramsData.linkedId}):e.push({id:a.id,params:q(a)}))});var g=o(),h=function(d){var e=b.workflow.getFigure(d.id),d=_.extend(g,d.params);e.parentRow&&!d.userName&&(d.userName=b.getTitle(a(e.parentRow),
"row"));e.showInfo(c,d)};a.post(TeamTime.getUrlForTask("loadInfo"),{info:c,figures:JSON.stringify(f)},function(a){_.each(JSON.parse(a),h)});_.each(e,h)};this.checkMaxSizeDiagram=function(a){a=a.length;console.log("Current size: "+a);return 65535<=a?(alert(i18n.SwimlanePanel.diagram_is_too_big),!1):!0}};
TeamTime.jQuery(window).load(function(){var a=TeamTime.jQuery,b=parent.SwimlanePanelButtons;draw2d.bpmn.assetsUrl=TeamTime.getMediaAssetsUrl();var c=new SwimlanePanel;draw2d.bpmn.setSwimlanePanel(c);c.init();(function(d){var e=TeamTime.getUrlForTask("loadDiagram");b.isTemplate&&(e=TeamTime.getUrlForController("template")+"&task=loadDiagram");a.get(e,{id:d},function(d){if(""!=d){var e=new draw2d.bpmn.JsonSerializer,h=draw2d.bpmn.getSwimlanePanel();h.clear();e.unserialize(h,d);console.log("diagram loaded");
c.showInfo(a(b.selectorShowInfo).val())}})})(purl().param("id"))});
